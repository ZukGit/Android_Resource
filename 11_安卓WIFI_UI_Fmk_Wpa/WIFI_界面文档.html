<!DOCTYPE html>
<html>
<head>
<title>WIFI_界面文档</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
/* GitHub stylesheet for MarkdownPad (http://markdownpad.com) */
/* Author: Nicolas Hery - http://nicolashery.com */
/* Version: b13fe65ca28d2e568c6ed5d7f06581183df8f2ff */
/* Source: https://github.com/nicolahery/markdownpad-github */

/* RESET
=============================================================================*/

html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
}

/* BODY
=============================================================================*/

body {
  font-family: Helvetica, arial, freesans, clean, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  color: #333;
  background-color: #fff;
  padding: 20px;
  max-width: 960px;
  margin: 0 auto;
}

body>*:first-child {
  margin-top: 0 !important;
}

body>*:last-child {
  margin-bottom: 0 !important;
}

/* BLOCKS
=============================================================================*/

p, blockquote, ul, ol, dl, table, pre {
  margin: 15px 0;
}

/* HEADERS
=============================================================================*/

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
}

h1 tt, h1 code, h2 tt, h2 code, h3 tt, h3 code, h4 tt, h4 code, h5 tt, h5 code, h6 tt, h6 code {
  font-size: inherit;
}

h1 {
  font-size: 28px;
  color: #000;
}

h2 {
  font-size: 24px;
  border-bottom: 1px solid #ccc;
  color: #000;
}

h3 {
  font-size: 18px;
}

h4 {
  font-size: 16px;
}

h5 {
  font-size: 14px;
}

h6 {
  color: #777;
  font-size: 14px;
}

body>h2:first-child, body>h1:first-child, body>h1:first-child+h2, body>h3:first-child, body>h4:first-child, body>h5:first-child, body>h6:first-child {
  margin-top: 0;
  padding-top: 0;
}

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0;
}

h1+p, h2+p, h3+p, h4+p, h5+p, h6+p {
  margin-top: 10px;
}

/* LINKS
=============================================================================*/

a {
  color: #4183C4;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

/* LISTS
=============================================================================*/

ul, ol {
  padding-left: 30px;
}

ul li > :first-child, 
ol li > :first-child, 
ul li ul:first-of-type, 
ol li ol:first-of-type, 
ul li ol:first-of-type, 
ol li ul:first-of-type {
  margin-top: 0px;
}

ul ul, ul ol, ol ol, ol ul {
  margin-bottom: 0;
}

dl {
  padding: 0;
}

dl dt {
  font-size: 14px;
  font-weight: bold;
  font-style: italic;
  padding: 0;
  margin: 15px 0 5px;
}

dl dt:first-child {
  padding: 0;
}

dl dt>:first-child {
  margin-top: 0px;
}

dl dt>:last-child {
  margin-bottom: 0px;
}

dl dd {
  margin: 0 0 15px;
  padding: 0 15px;
}

dl dd>:first-child {
  margin-top: 0px;
}

dl dd>:last-child {
  margin-bottom: 0px;
}

/* CODE
=============================================================================*/

pre, code, tt {
  font-size: 12px;
  font-family: Consolas, "Liberation Mono", Courier, monospace;
}

code, tt {
  margin: 0 0px;
  padding: 0px 0px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px;
}

pre>code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent;
}

pre {
  background-color: #f8f8f8;
  border: 1px solid #ccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px;
}

pre code, pre tt {
  background-color: transparent;
  border: none;
}

kbd {
    -moz-border-bottom-colors: none;
    -moz-border-left-colors: none;
    -moz-border-right-colors: none;
    -moz-border-top-colors: none;
    background-color: #DDDDDD;
    background-image: linear-gradient(#F1F1F1, #DDDDDD);
    background-repeat: repeat-x;
    border-color: #DDDDDD #CCCCCC #CCCCCC #DDDDDD;
    border-image: none;
    border-radius: 2px 2px 2px 2px;
    border-style: solid;
    border-width: 1px;
    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
    line-height: 10px;
    padding: 1px 4px;
}

/* QUOTES
=============================================================================*/

blockquote {
  border-left: 4px solid #DDD;
  padding: 0 15px;
  color: #777;
}

blockquote>:first-child {
  margin-top: 0px;
}

blockquote>:last-child {
  margin-bottom: 0px;
}

/* HORIZONTAL RULES
=============================================================================*/

hr {
  clear: both;
  margin: 15px 0;
  height: 0px;
  overflow: hidden;
  border: none;
  background: transparent;
  border-bottom: 4px solid #ddd;
  padding: 0;
}

/* TABLES
=============================================================================*/

table th {
  font-weight: bold;
}

table th, table td {
  border: 1px solid #ccc;
  padding: 6px 13px;
}

table tr {
  border-top: 1px solid #ccc;
  background-color: #fff;
}

table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

/* IMAGES
=============================================================================*/

img {
  max-width: 100%
}
</style>
<style type="text/css">
.highlight  { background: #ffffff; }
.highlight .c { color: #999988; font-style: italic } /* Comment */
.highlight .err { color: #a61717; background-color: #e3d2d2 } /* Error */
.highlight .k { font-weight: bold } /* Keyword */
.highlight .o { font-weight: bold } /* Operator */
.highlight .cm { color: #999988; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #999999; font-weight: bold } /* Comment.Preproc */
.highlight .c1 { color: #999988; font-style: italic } /* Comment.Single */
.highlight .cs { color: #999999; font-weight: bold; font-style: italic } /* Comment.Special */
.highlight .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.highlight .gd .x { color: #000000; background-color: #ffaaaa } /* Generic.Deleted.Specific */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #aa0000 } /* Generic.Error */
.highlight .gh { color: #999999 } /* Generic.Heading */
.highlight .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.highlight .gi .x { color: #000000; background-color: #aaffaa } /* Generic.Inserted.Specific */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #555555 } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #aaaaaa } /* Generic.Subheading */
.highlight .gt { color: #aa0000 } /* Generic.Traceback */
.highlight .kc { font-weight: bold } /* Keyword.Constant */
.highlight .kd { font-weight: bold } /* Keyword.Declaration */
.highlight .kp { font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #445588; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #009999 } /* Literal.Number */
.highlight .s { color: #d14 } /* Literal.String */
.highlight .na { color: #008080 } /* Name.Attribute */
.highlight .nb { color: #0086B3 } /* Name.Builtin */
.highlight .nc { color: #445588; font-weight: bold } /* Name.Class */
.highlight .no { color: #008080 } /* Name.Constant */
.highlight .ni { color: #800080 } /* Name.Entity */
.highlight .ne { color: #990000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #990000; font-weight: bold } /* Name.Function */
.highlight .nn { color: #555555 } /* Name.Namespace */
.highlight .nt { color: #000080 } /* Name.Tag */
.highlight .nv { color: #008080 } /* Name.Variable */
.highlight .ow { font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #009999 } /* Literal.Number.Float */
.highlight .mh { color: #009999 } /* Literal.Number.Hex */
.highlight .mi { color: #009999 } /* Literal.Number.Integer */
.highlight .mo { color: #009999 } /* Literal.Number.Oct */
.highlight .sb { color: #d14 } /* Literal.String.Backtick */
.highlight .sc { color: #d14 } /* Literal.String.Char */
.highlight .sd { color: #d14 } /* Literal.String.Doc */
.highlight .s2 { color: #d14 } /* Literal.String.Double */
.highlight .se { color: #d14 } /* Literal.String.Escape */
.highlight .sh { color: #d14 } /* Literal.String.Heredoc */
.highlight .si { color: #d14 } /* Literal.String.Interpol */
.highlight .sx { color: #d14 } /* Literal.String.Other */
.highlight .sr { color: #009926 } /* Literal.String.Regex */
.highlight .s1 { color: #d14 } /* Literal.String.Single */
.highlight .ss { color: #990073 } /* Literal.String.Symbol */
.highlight .bp { color: #999999 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #008080 } /* Name.Variable.Class */
.highlight .vg { color: #008080 } /* Name.Variable.Global */
.highlight .vi { color: #008080 } /* Name.Variable.Instance */
.highlight .il { color: #009999 } /* Literal.Number.Integer.Long */
.pl-c {
    color: #969896;
}

.pl-c1,.pl-mdh,.pl-mm,.pl-mp,.pl-mr,.pl-s1 .pl-v,.pl-s3,.pl-sc,.pl-sv {
    color: #0086b3;
}

.pl-e,.pl-en {
    color: #795da3;
}

.pl-s1 .pl-s2,.pl-smi,.pl-smp,.pl-stj,.pl-vo,.pl-vpf {
    color: #333;
}

.pl-ent {
    color: #63a35c;
}

.pl-k,.pl-s,.pl-st {
    color: #a71d5d;
}

.pl-pds,.pl-s1,.pl-s1 .pl-pse .pl-s2,.pl-sr,.pl-sr .pl-cce,.pl-sr .pl-sra,.pl-sr .pl-sre,.pl-src,.pl-v {
    color: #df5000;
}

.pl-id {
    color: #b52a1d;
}

.pl-ii {
    background-color: #b52a1d;
    color: #f8f8f8;
}

.pl-sr .pl-cce {
    color: #63a35c;
    font-weight: bold;
}

.pl-ml {
    color: #693a17;
}

.pl-mh,.pl-mh .pl-en,.pl-ms {
    color: #1d3e81;
    font-weight: bold;
}

.pl-mq {
    color: #008080;
}

.pl-mi {
    color: #333;
    font-style: italic;
}

.pl-mb {
    color: #333;
    font-weight: bold;
}

.pl-md,.pl-mdhf {
    background-color: #ffecec;
    color: #bd2c00;
}

.pl-mdht,.pl-mi1 {
    background-color: #eaffea;
    color: #55a532;
}

.pl-mdr {
    color: #795da3;
    font-weight: bold;
}

.pl-mo {
    color: #1d3e81;
}
.task-list {
padding-left:10px;
margin-bottom:0;
}

.task-list li {
    margin-left: 20px;
}

.task-list-item {
list-style-type:none;
padding-left:10px;
}

.task-list-item label {
font-weight:400;
}

.task-list-item.enabled label {
cursor:pointer;
}

.task-list-item+.task-list-item {
margin-top:3px;
}

.task-list-item-checkbox {
display:inline-block;
margin-left:-20px;
margin-right:3px;
vertical-align:1px;
}
</style>
<script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
<script type="text/javascript">
 //是否显示导航栏
 var showNavBar = true;
 //是否展开导航栏
 var expandNavBar = true;
 var currentIndex = 0;
 var currentScrollHigh = 0;
 var currentContentScrollHigh = 0;
 function sleep(numberMillis) {  
    var now = new Date();  
    var exitTime = now.getTime() + numberMillis;  
    while (true) {  
        now = new Date();  
        if (now.getTime() > exitTime)  
        return;  
        }  
}


$(window).onbeforeunload = function(){ 
currentIndex = 0;
} 


 $(window).load(function(){
    var h1s = $("body").find("h1");
    var h2s = $("body").find("h2");
    var h3s = $("body").find("h3");
    var h4s = $("body").find("h4");
    var h5s = $("body").find("h5");
    var h6s = $("body").find("h6");

    var headCounts = [h1s.length, h2s.length, h3s.length, h4s.length, h5s.length, h6s.length];
    var vH1Tag = null;  // 显示的最高层级
    var vH2Tag = null;   // 显示的最低层级
var sum = 0;


    for(var i = 0; i < headCounts.length; i++){
          if(headCounts[i] > 0){
		  for( var y = 0; y < headCounts[i]; y++)
		         sum = sum + 1;
		  }
    }
    for(var i = 0; i < headCounts.length; i++){
        if(headCounts[i] > 0){
            if(vH1Tag == null){
                vH1Tag = 'h' + (i + 1);
            }else{
                vH2Tag = 'h' + (i + 1);
            }
        }
    }
    if(vH1Tag == null){
        return;
    }

    $("body").prepend('<div class="BlogAnchor">' + 
        '<span style="color:red;position:absolute;top:-6px;left:0px;cursor:pointer;" onclick="$(\'.BlogAnchor\').hide();">×</span>' +
        '<p>' + 
            '<b id="AnchorContentToggle" title="收起" style="cursor:pointer;">目录▲</b>' + 
        '</p>' + 
        '<div class="AnchorContent" id="AnchorContent"> </div>' + 
    '</div>' );

    var vH1Index = 0;
    var vH2Index = 0;
	
	
    var vIndexH1 = 0;
    var vIndexH2 = 0;
    var vIndexH3 = 0;
    var vIndexH4 = 0;
    var vIndexH5 = 0;
    var vIndexH6 = 0;
	var headerALL = [];
	var headerIDALL = [];
	var headerHightALL = [];
    $("body").find("h1,h2,h3,h4,h5,h6").each(function(i,item){

        var id = '';
        var name = '';
        var tag = $(item).get(0).tagName.toLowerCase();
		var className = '';
		// i=0 tag=h1          i=1 tag=h2     i=2 tag=h2

        if(tag == "h1"){
            id = name = ++vIndexH1;
    vIndexH2 = 0;
    vIndexH3 = 0;
    vIndexH4 = 0;
    vIndexH5 = 0;
    vIndexH6 = 0;
    className = 'item_h1';
			
//alert("tag ="+ tag +"----   i = "+ i + " name ="+ name +"    className= "+ className);
//tag =h1----   i = 0 name =1    className= item_h1
        }else if(tag == "h2"){
		
            id = vIndexH1 + '_' + ++vIndexH2;
            name = vIndexH1 + '.' + vIndexH2;
            className = 'item_h2'; 
    vIndexH3 = 0;
    vIndexH4 = 0;
    vIndexH5 = 0;
    vIndexH6 = 0;
	
       }else if(tag == "h3"){
            id = vIndexH1 + '_' + vIndexH2+ '_' + ++vIndexH3;
            name = vIndexH1 + '.' + vIndexH2+ '.' + +vIndexH3;
            className = 'item_h3'; 
    vIndexH4 = 0;
    vIndexH5 = 0;
    vIndexH6 = 0;
	   
	   }
	   
	   else if(tag == "h4"){
            id = vIndexH1 + '_' + vIndexH2+ '_'  +vIndexH3 +'_'+ ++vIndexH4 ;
            name =  vIndexH1 + '.' + vIndexH2+ '.'  +vIndexH3 +'.'+  vIndexH4 ;
            className = 'item_h4';
    vIndexH5 = 0;
    vIndexH6 = 0; 
	   }
	   
	   else if(tag == "h5"){
            id = vIndexH1 + '_' + vIndexH2+ '_'  +vIndexH3 +'_' +vIndexH4+'_'+ ++vIndexH5;
            name = vIndexH1 + '.' + vIndexH2+ '.'  +vIndexH3 +'.' +vIndexH4+'.'+ vIndexH5;
            className = 'item_h5'; 
            vIndexH6 = 0; 
	   }
	   
	   else if(tag == "h6"){
            id = vIndexH1 + '_' + vIndexH2+ '_'  +vIndexH3 +'_' +vIndexH4+'_' +vIndexH5+'_'+ ++vIndexH6;
            name = vIndexH1 + '.' + vIndexH2+ '.'  +vIndexH3 +'.' +vIndexH4+'.' +vIndexH5+'.'+ vIndexH6;
            className = 'item_h6'; 
	   
	   }
	    if(name.length > 2){
		
		var mFirstName = name.substring(0,2);
		while(mFirstName == "0."){
		name = name.substring(2,name.length);
		mFirstName = name.substring(0,2);
         }
		 
		}
        $(item).attr("id","wow"+id+"_index_"+i);
        $(item).addClass("wow_head");
		var itemHeight = $(item).offset().top
        $("#AnchorContent").css('max-height', ($(document).height()) + 'px');
		$("#AnchorContent").css('height', ($(window).height()) + 'px');
		$("#AnchorContent").css('overflow','auto');
        $("#AnchorContent").append('<li><a class="nav_item '+className+' anchor-link"  href="#wow'+id+'_index_'+i+'" link="#wow'+id+'" index="'+i+'">'+name+"✶"+$(this).text()+" "+'</a></li>');
    	var str = "#wow"+id+"_index_"+i;
		headerALL.push($(item));
		headerIDALL.push(str);
		console.log("  i = "+ i +"   id =" + id +"  itemHeight = "+ itemHeight);
	});

	// 1
	// 1.1
	// 1.1.1
	// 1.1.1.1
	// 1.1.1.1.1
	// 1.1.1.1.1.1
    $("#AnchorContentToggle").click(function(){
        var text = $(this).html();
        if(text=="目录▲"){
            $(this).html("目录▼");
            $(this).attr({"title":"展开"});
        }else{
            $(this).html("目录▲");
            $(this).attr({"title":"收起"});
        }
        $("#AnchorContent").toggle();
    });
   
   
$(".anchor-link").click(function(){

        //$("html,body").animate({scrollTop: $($(this).attr("link")).offset().top}, 10);
		var index  = $(this).attr("index");
                $(".BlogAnchor li .nav_item.current").removeClass('current');
                $(headerNavs[index]).addClass('current');
					  var scrollTop = $(window).scrollTop(); // 获得将要到达的点离顶距离
					  currentScrollHigh = scrollTop;
					  currentContentScrollHigh = headerHightALL[index];
	  var value = headerTops[index];
	  currentIndex = value;
	  console.log("index = "+ index+ "  headerTops["+index+"] ="+ value + "scrollTop="+ scrollTop);
    });

	



    var headerNavs = $(".BlogAnchor li .nav_item");
    var headerTops = [];
	var mHeight = 0;
    $(".wow_head").each(function(i, n){
	var value = $(n).offset().top;

        headerTops.push($(n).offset().top);
		 console.log("i = "+ i+ "  offset().top ="+ value);
    });
	headerTops.push($(document).height());

window.onresize = function(){

headerTops = [];
$.each(headerNavs, function(i, n){
$(n).trigger("click"); 
document.querySelector(headerIDALL[i]).scrollIntoView(true);
//var high = $(n).offset().top;
var scrollTop = $(window).scrollTop();
headerTops.push(scrollTop);
console.log("headerNavs_index="+i +"   scrollTop="+scrollTop +"  headerTops="+headerTops[i]);
}
);
headerTops.push($(document).height());

//$("#AnchorContent").height($(window).height());
$("#AnchorContent").css('height', ($(window).height()) + 'px');
var xcontentWidth =  $("#AnchorContent").width();
var xWidth = $(window).width();
var xlength = xWidth - xcontentWidth;
$("body").css("marginLeft",xcontentWidth+'px');
$("body").css("max-width",xlength);

$(headerNavs[currentIndex]).trigger("click"); 
document.querySelector(headerIDALL[i]).scrollIntoView(true);


}





	
	


$(window).scroll(function(){
        var scrollTop = $(window).scrollTop(); // 获得将要到达的点离顶距离

		$.each(headerTops, function(i, n){
            if( (scrollTop >= (headerTops[i])  && scrollTop < (headerTops[i+1] -1))  ){
                console.log("headerTops[i-1]"+headerTops[i-1]+"headerTops[i]"+headerTops[i]+"  scrollTop ="+ scrollTop+"  headerTops[i+1]= "+headerTops[i+1] +"  i ="+i);
                $(".BlogAnchor li .nav_item.current").removeClass('current');
                $(headerNavs[i]).addClass('current');
				currentScrollHigh = scrollTop;
				currentContentScrollHigh = headerHightALL[i];
				currentIndex = i;
				var mxxHeight = $("#AnchorContent").height()
				var mscrollTop1 = $("#AnchorContent").scrollTop();  // 当前标签的高度
			console.log("zukgit2 currentIndex="+ currentIndex );
				console.log("zukgit2 windows.scrollTop="+ scrollTop );
				console.log("zukgit2 $(window).height()="+ $(window).height() );
				console.log("zukgit2 currentContentScrollHigh="+ currentContentScrollHigh );
				console.log("zukgit2 AnchorContent.mscrollTop="+ mscrollTop1 );
				console.log("zukgit2 AnchorContent.high="+ mxxHeight );
				if((currentContentScrollHigh - mscrollTop1)>  ($(window).height()/2)){ //↓ // 如果当前index超出  界面的高度
				//var sum =   Math.floor(headerHightALL(i) / $(window).height());
				var dif = currentContentScrollHigh - mscrollTop1;
				$("#AnchorContent").animate({scrollTop: (currentContentScrollHigh)}, 50);
				console.log("  i(zukgit3) = "+ i +"   currentContentScrollHigh =" + currentContentScrollHigh +"  mscrollTop1 = "+ mscrollTop1);
				console.log(" $(window).height()="+ $(window).height() );
				
				} else if( ( mscrollTop1 - currentContentScrollHigh )>  0 ){  //↑
				$("#AnchorContent").animate({scrollTop: currentContentScrollHigh-($("#AnchorContent").height()/3)}, 50);
				console.log("  i(zukgit4) = "+ i +"   currentContentScrollHigh =" + currentContentScrollHigh +"  mscrollTop1 = "+ mscrollTop1);
				console.log(" $(window).height()="+ $(window).height() +"   $(#AnchorContent).height()="+mxxHeight);
				}

                return false;
            }
        }
		);
		if(scrollTop == 0){
        $("#AnchorContent").animate({scrollTop: 0}, 50);
		}
		if(scrollTop == $(document).height()){
        $("#AnchorContent").animate({scrollTop: headerHightALL[headerHightALL.length-1]}, 50);
		}
    });

	
$.each(headerNavs, function(i, n){
var high = $(n).offset().top;
headerHightALL.push(high);
console.log("high"+high);
}
);


headerTops = [];
$.each(headerNavs, function(i, n){

$(n).trigger("click"); 
document.querySelector(headerIDALL[i]).scrollIntoView(true);

var scrollTop = $(window).scrollTop();

headerTops.push(scrollTop);
console.log("headerNavs_index="+i +"   scrollTop="+scrollTop +"  headerTops="+headerTops[i]);

}
);



headerTops.push($(document).height());
$(headerNavs[0]).trigger("click"); 
document.querySelector(headerIDALL[0]).scrollIntoView(true);




var xcontentWidth =  $("#AnchorContent").width();
var xWidth = $(window).width();
var xlength = xWidth - xcontentWidth;
$("body").css("marginLeft",xcontentWidth+'px');
$("body").css("max-width",xlength);

    if(!showNavBar){
        $('.BlogAnchor').hide();
    }
    if(!expandNavBar){
        $(this).html("目录▼");
        $(this).attr({"title":"展开"});
        $("#AnchorContent").hide();
    }
 });
 
 
 
</script>
<style>
    /*导航*/
    .BlogAnchor {
        //background: #f1f1f1;
		background: #ffffff;
        //padding: 10px;
        line-height: 180%;
        position: fixed;
        left: 0px;   // right: 48px;  
        top: 0px;
        border: 1px solid #aaaaaa;
		width: 20%;
	    height:100%;
    }
    .BlogAnchor p {
        font-size: 18px;
        color: #15a230;
        margin: 0 0 0.3rem 0;
        text-align: right;
    }
    .BlogAnchor .AnchorContent {
        //padding: 5px 0px;
        overflow: auto;

    }
    .BlogAnchor li{
        text-indent: 0.5rem;
        font-size: 14px;
        list-style: none;
    }
    .BlogAnchor li .nav_item{
        padding: 3px;
    }
    .BlogAnchor li .item_h1{
        margin-left: 0rem;
    }
    .BlogAnchor li .item_h2{
        margin-left: 2rem;
        font-size: 0.8rem;
    }
	
    .BlogAnchor li .item_h3{
        margin-left: 4rem;
        font-size: 0.8rem;
    }
	
	.BlogAnchor li .item_h4{
        margin-left: 5rem;
        font-size: 0.8rem;
    }
	
	.BlogAnchor li .item_h5{
        margin-left: 6rem;
        font-size: 0.8rem;
    }
	
	
	.BlogAnchor li .item_h6{
        margin-left: 7rem;
        font-size: 0.8rem;
    }
	
    .BlogAnchor li .nav_item.current{
        color: white;
        background-color: #5cc26f;
    }
    #AnchorContentToggle {
        font-size: 13px;
        font-weight: normal;
        color: #FFF;
        display: inline-block;
        line-height: 20px;
        background: #5cc26f;
        font-style: normal;
        padding: 1px 8px;
    }
    .BlogAnchor a:hover {
        color: #5cc26f;
    }
    .BlogAnchor a {
        text-decoration: none;
    }
</style>
</head>
<body>
<h1 id="wifi-ui-useraction-ua-">WIFI的UI界面显示以及对应的UserAction(UA)</h1>
<h2 id="wifi-ui-ua-">WIFI UI界面以及对应的UA位置</h2>
<p><img src="img/1.png" width = "25%" height="25%"/>   <img src="img/2.png" width = "25%" height="25%"/>   <img src="img/3.png" width = "25%" height="25%"/> </p>
<p><img src="img/4.png" width = "25%" height="25%"/>   <img src="img/5.png" width = "25%" height="25%"/>   <img src="img/6.png" width = "25%" height="25%"/> </p>
<p><img src="img/7.png" width = "25%" height="25%"/>   <img src="img/8.png" width = "25%" height="25%"/>   <img src="img/9.png" width = "25%" height="25%"/> </p>
<p><img src="img/10.png" width = "25%" height="25%"/>   <img src="img/11.png" width = "25%" height="25%"/>   <img src="img/12.png" width = "25%" height="25%"/> </p>
<p><img src="img/13.png" width = "25%" height="25%"/>   <img src="img/14.png" width = "25%" height="25%"/>   <img src="img/15.png" width = "25%" height="25%"/> </p>
<p><img src="img/16.png" width = "25%" height="25%"/>   <img src="img/17.png" width = "25%" height="25%"/>   <img src="img/18.png" width = "25%" height="25%"/> </p>
<h2 id="wifi-ua1-">WIFI UA1分析</h2>
<h3 id="wifi-ua1-">WIFI UA1 操作列</h3>
<ol>
<li><strong>UA编号</strong>   UA1</li><li><strong>UA说明</strong>  <strong> WIFI设置界面入口</strong></li><li><strong>UA触发函数</strong>  <strong>在network_and_internet.xml布局文件的Preference指定了targetClass和Action的Intent</strong> 在DashboardFeatureProviderImpl.java的openTileIntent函数<br>activity.startActivityForResult(intent, 0) 函数被执行</li><li><strong>UA字符可选值</strong>    Summary简要字符可选:     1.关闭 2.未连接 3.连接热点名字 </li><li><strong>UA布局及ID</strong>     NetworkDashboardFragment的布局文件network_and_internet.xml中 android:key=&quot;toggle_wifi&quot;</li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong> </li><li><strong>数据库可选值 </strong> </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>  WifiSettingsActivity   (static) extends SettingsActivity<br> <code>&lt;meta-data android:name=&quot;com.android.settings.FRAGMENT_CLASS&quot; android:value=&quot;com.android.settings.wifi.WifiSettings&quot; /&gt;</code></li><li><strong>UA触发函数所在类</strong>   NetworkDashboardActivity(static) extends SettingsActivity 依据<a href="file/AndroidManifest.xml">Manifest</a>【加载 NetworkDashboardFragment 页面】<br>  <code>&lt;meta-data android:name=&quot;com.android.settings.FRAGMENT_CLASS&quot;  android:value=&quot;com.android.settings.network.NetworkDashboardFragment&quot;/&gt;</code></li></ol>
<hr>
<h3 id="wifi-ua1-">WIFI-UA1代码分析</h3>
<p> <img src="img/19.png" width = "25%" height="25%"/><img src="img/20.png" width = "25%" height="25%"/><img src="img/21.png" width = "25%" height="25%"/><img src="img/22.png" width = "25%" height="25%"/> </p>
<p> <a href="http://blog.sina.com.cn/s/blog_c5db74db0102wu0k.html">http://blog.sina.com.cn/s/blog_c5db74db0102wu0k.html</a>    为安卓8.0设置添加一级菜单的操作<br> <a href="https://blog.csdn.net/qq_31012033/article/details/79522813">https://blog.csdn.net/qq_31012033/article/details/79522813</a>  Android 8.0 Settings流程分析与变动</p>
<pre><code> /packages/apps/Settings/src/com/android/settings/core/gateway/SettingsGateway.java
public class SettingsGateway {

//该数组定义了设置界面所有的Activity以及对应显示Activity的顺序
public static final String[] SETTINGS_FOR_RESTRICTED = { 
// New IA
// Home page
Settings.NetworkDashboardActivity.class.getName(), // &lt;string name=&quot;network_dashboard_title&quot;&gt;&quot;网络和互联网&quot;&lt;/string&gt;
Settings.ConnectedDeviceDashboardActivity.class.getName(), //&lt;string name=&quot;connected_devices_dashboard_title&quot;&gt;&quot;已关联的设备&quot;&lt;/string&gt;
Settings.AppAndNotificationDashboardActivity.class.getName(),// &lt;string name=&quot;app_and_notification_dashboard_title&quot;&gt;&quot;应用和通知&quot;&lt;/string&gt;
Settings.DisplaySettingsActivity.class.getName(),// &lt;string name=&quot;display_settings_title&quot;&gt;&quot;显示&quot;&lt;/string&gt;
Settings.SoundSettingsActivity.class.getName(), //&lt;string name=&quot;notification_channel_sound_title&quot;&gt;&quot;提示音&quot;&lt;/string&gt;
Settings.StorageDashboardActivity.class.getName(), //&lt;string name=&quot;storage_settings&quot;&gt;&quot;存储&quot;&lt;/string&gt;
Settings.PowerUsageSummaryActivity.class.getName(), // &lt;string name=&quot;power_usage_summary_title&quot;&gt;&quot;电池&quot;&lt;/string&gt;
Settings.UserAndAccountDashboardActivity.class.getName(),  // &lt;string name=&quot;account_dashboard_title&quot;&gt;&quot;用户和帐号&quot;&lt;/string&gt;
Settings.SecuritySettingsActivity.class.getName(),  //  &lt;string name=&quot;security_settings_title&quot;&gt;&quot;安全性与位置信息&quot;&lt;/string&gt;
Settings.AccessibilitySettingsActivity.class.getName(), // &lt;string name=&quot;accessibility_settings&quot;&gt;&quot;无障碍&quot;&lt;/string&gt;
Settings.SystemDashboardActivity.class.getName(), //&lt;string name=&quot;header_category_system&quot;&gt;&quot;系统&quot;&lt;/string&gt;
Settings.SupportDashboardActivity.class.getName(), //&lt;string name=&quot;system_update_settings_list_item_title&quot;&gt;&quot;系统更新&quot;&lt;/string&gt;
// Home page &gt; Network &amp; Internet  // 网络与互联网 点击进入后会显示到的Activity
Settings.WifiSettingsActivity.class.getName(), // &lt;string name=&quot;wifi_settings_title&quot;&gt;&quot;WLAN&quot;&lt;/string&gt;
Settings.DataUsageSummaryActivity.class.getName(),//&lt;string name=&quot;network_settings_title&quot;&gt;&quot;移动网络&quot;&lt;/string&gt;
Settings.SimSettingsActivity.class.getName(), // &lt;string name=&quot;sim_settings_title&quot;&gt;&quot;SIM 卡&quot;&lt;/string&gt;
// Home page &gt; Connected devices
Settings.BluetoothSettingsActivity.class.getName(), // &lt;string name=&quot;bluetooth_settings_title&quot;&gt;&quot;蓝牙&quot;&lt;/string&gt;
Settings.WifiDisplaySettingsActivity.class.getName(), //&lt;string name=&quot;wifi_display_settings_title&quot;&gt;&quot;投射&quot;&lt;/string&gt;
Settings.PrintSettingsActivity.class.getName(),  //&lt;string name=&quot;print_settings&quot;&gt;&quot;打印&quot;&lt;/string&gt;
// Home page &gt; Apps &amp; Notifications
Settings.UserSettingsActivity.class.getName(),
Settings.ConfigureNotificationSettingsActivity.class.getName(),
Settings.ManageApplicationsActivity.class.getName(),
Settings.PaymentSettingsActivity.class.getName(),
// Home page &gt; Security &amp; screen lock
Settings.LocationSettingsActivity.class.getName(),
// Home page &gt; System
Settings.LanguageAndInputSettingsActivity.class.getName(), // &lt;string name=&quot;language_keyboard_settings_title&quot;&gt;&quot;语言和输入法&quot;&lt;/string&gt;
Settings.DateTimeSettingsActivity.class.getName(), // &lt;string name=&quot;date_and_time_settings_title&quot; &gt;&quot;日期和时间&quot;&lt;/string&gt;
Settings.DeviceInfoSettingsActivity.class.getName(), // &lt;string name=&quot;about_settings&quot;&gt;&quot;关于手机&quot;&lt;/string&gt;
Settings.EnterprisePrivacySettingsActivity.class.getName(),
    };



// 保存各种包含设置Fragment的设置类的集合
public static final String[] ENTRY_FRAGMENTS = {
WifiSettings.class.getName(),  // 
ConfigureWifiSettings.class.getName(),
SavedAccessPointsWifiSettings.class.getName(),
TetherSettings.class.getName(),
WifiP2pSettings.class.getName(),
WifiCallingSettings.class.getName(),
WifiDisplaySettings.class.getName(),
WifiAPITest.class.getName(),
WifiInfo.class.getName(),

.......
};


}
</code></pre><p>  <img src="img/24.png" width = "75%" height="75%"/></p>
<pre><code>AndroidmaniFest.xml 文件
一级菜单是完全动态的加载，二级菜单则是动态加载和静态xml布局文件

  在AndroidmaniFest.xml 文件中 定义的Activity 存在 &lt;meta-data&gt;子标签  在该标签内定义了 &quot;com.android.settings.category&quot; 所属类别  

   &lt;activity android:name=&quot;Settings$NetworkDashboardActivity&quot;  【一级菜单】    //【网络和互联网设置界面Activity AndroidManifest的定义  属于homepage的一级菜单】
       android:label=&quot;@string/wifi_settings&quot;
       android:icon=&quot;@drable/ic_settings_wireless&quot;&gt;
  &lt;meta-data  android:name=&quot;com.android.settings.category&quot;
  android:value=&quot;com.android.settings.category.ia.homepage&quot; // &quot;com.android.settings.category.ia.homepage&quot;  说明它是设置应用的一级菜单
  android:value=&quot;com.android.settings.category.ia.system&quot; // &quot;com.android.settings.category.ia.system&quot;  说明它是设置应用homepage的一级菜单System系统 下的二级菜单
  android:value=&quot;com.android.settings.category.ia.development&quot;  // &quot;com.android.settings.category.ia.development&quot;  说明它是设置应用homepage的一级菜单开发者选项下的二级菜单
  android:value=&quot;com.android.settings.category.ia.device&quot;  // 二级菜单
  android:value=&quot;com.android.settings.category.ia.wireless&quot;   // 二级菜单
  android:value=&quot;com.android.settings.category.ia.account&quot;   // 二级菜单
  android:value=&quot;com.android.settings.category.ia.app&quot;    // 二级菜单
  android:value=&quot;com.android.settings.category.ia.notifications&quot;   // 二级菜单
  /&gt; 

&lt;meta-data android:name=&quot;com.android.settings.FRAGMENT_CLASS&quot;  该 标签表示 该 Activity 启动时 使用的Fragment的类进行界面的加载
android:value=&quot;com.android.settings.network.NetworkDashboardFragment&quot;/&gt;
&lt;/activity&gt;



 &lt;activity android:name=&quot;Settings$WifiSettingsActivity&quot;   【可以认为是三级菜单了】
                android:taskAffinity=&quot;&quot;
                android:label=&quot;@string/wifi_settings&quot;
                android:configChanges=&quot;orientation|keyboardHidden|screenSize&quot;&gt;
            &lt;intent-filter&gt;
                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;
                &lt;action android:name=&quot;android.settings.WIFI_SETTINGS&quot; /&gt;
                &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;
                &lt;category android:name=&quot;android.intent.category.VOICE_LAUNCH&quot; /&gt;
                &lt;category android:name=&quot;com.android.settings.SHORTCUT&quot; /&gt;
            &lt;/intent-filter&gt;
            &lt;meta-data android:name=&quot;com.android.settings.FRAGMENT_CLASS&quot;
                android:value=&quot;com.android.settings.wifi.WifiSettings&quot; /&gt;  // 指定了加载该Activity显示的Fragment &quot;com.android.settings.wifi.WifiSettings&quot; Fragment
            &lt;meta-data android:name=&quot;com.android.settings.TOP_LEVEL_HEADER_ID&quot;
                android:resource=&quot;@id/wifi_settings&quot; /&gt;
        &lt;/activity&gt;


&lt;activity-alias android:name=&quot;Settings&quot;              【应用入口】
                android:taskAffinity=&quot;com.android.settings&quot;  
                android:label=&quot;@string/settings_label_launcher&quot;  
                android:launchMode=&quot;singleTask&quot;  
                android:targetActivity=&quot;Settings&quot;&gt;  
            &lt;intent-filter&gt;  
                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;  
                &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;  
                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;   // Settings是启动的主页面
            &lt;/intent-filter&gt;  
            &lt;meta-data android:name=&quot;android.app.shortcuts&quot; android:resource=&quot;@xml/shortcuts&quot;/&gt;  
&lt;/activity-alias&gt;  

Settings.java类 除了大量静态类继承SettingsActivity，就没什么东西了。那再去父类SettingsActivity.java找找

packages\apps\Settings\src\com\android\settings\SettingsActivity.java

  protected void onCreate(Bundle savedState) {  
  .........




   final String initialFragmentName = intent.getStringExtra(EXTRA_SHOW_FRAGMENT);  // 获取 &lt;meta-data &quot;com.android.settings.FRAGMENT_CLASS&quot; 对应的显示Fragment的名字 &gt;

   mIsShowingDashboard = className.equals(Settings.class.getName());   //当前类是否为Settings.class，即进入方式为点击launcher上的图标进入的主设置界面  
   setContentView(mIsShowingDashboard ?  R.layout.settings_main_dashboard : R.layout.settings_main_prefs);  // 加载布局文件包含两个Framgment 一个search_bar_container 另一个是 main_content Fragment

   launchSettingFragment(initialFragmentName, isSubSettings, intent); // 加载界面
  }



 void launchSettingFragment(String initialFragmentName, boolean isSubSettings, Intent intent) {  
.......
    //进入主页走的这里，替换目标 往 R.layout.settings_main_dashboard  中的 Fragment 中的main_content这个Fragment 填充指定DashboardSummary.class.getName() 名字的 Fragment
     switchToFragment(DashboardSummary.class.getName(), null /* args */, false, false,   mInitialTitleResId, mInitialTitle, false);   // 通过FramentTransaction 完成跳转
.......
    }  



packages\apps\Settings\src\com\android\settings\dashboard\DashboardSummary.java
DashboardSummary.java，对于它我们主要是想知道它的数据加载，它是怎么加载自己的子项的。
对子项的数据获取在updateCategoryAndSuggestion(）中得到实现



public void onViewCreated(View view，Bundle bundle) {  
  FocusReclerView mDashboard = findViewbyId(R.id.dashboard_container);
  mAdapter = new DashboardAdapter(xxx);

  rebuildUI(){ updateCategoryAndSuggestion();}
 }



 void updateCategoryAndSuggestion(List&lt;Tile&gt; suggestions) {  
        final Activity activity = getActivity();  
        if (activity == null) {  
            return;  
        }  
        /*根据&quot;com.android.settings.category&quot;的值查询子项数据，这里的值为&quot;com.android.settings.category.ia.homepage&quot;。 
        具体获取办法追踪到frameworks\base\packages\SettingsLib\src\com\android\settingslib\drawer\TileUtils.java中。 
        通过PackageManager查询所有在AndroidManifest.xml中定义&lt;meta-data/&gt;中含有该值的类。注意：会过滤掉非系统级应用的数据！ 
        CategoryKey.CATEGORY_HOMEPAGE = &quot;com.android.settings.category.ia.homepage&quot;*/  

        final DashboardCategory category = mDashboardFeatureProvider.getTilesForCategory(CategoryKey.CATEGORY_HOMEPAGE);  
        if (category == null) {  
            return;  
        }  
        mSummaryLoader.updateSummaryToCache(category);  
        if (suggestions != null) {  
            mAdapter.setCategoriesAndSuggestions(category, suggestions);  
        } else {  
            //数据的绑定在适配器中,-&gt;packages\apps\Settings\src\com\android\settings\dashboard\DashboardAdapter.java  
            mAdapter.setCategory(category);   // 往适配器 填充 Category
        }  
    }  

*************************追踪mDashboardFeatureProvider.getTilesForCategory******************************
思路:
1. 遍历Androidmanifest.xml 所有的组件  每一个组件都是 Tilt 那么就成为  List&lt;Tile&gt; 这个集合(和组件一样长度)
2. 遍历Androidmanifest.xml 所有的组件  每一个组件 取得metaData 得到Key为   Pair&lt;String, String&gt; key = new Pair&lt;String, String&gt;(activityInfo.packageName,activityInfo.name);  
   Value为 Tile的 Map&lt;Pair&lt;String,String&gt;,Tile&gt;  这个集合(和组件一样长度)
3. 依次遍历Tile ， Tile 中包含 tile.category  ，  从categoryMap 取得key 为 tile.category 的 DashboardCategory ， 并把 自身Tile 添加到该DashboardCategory 中 category.addTile(tile);
   HashMap&lt;String, DashboardCategory&gt; categoryMap = new HashMap&lt;&gt;();
  category中的List&lt;Tile&gt; tiles 用于保存  Tile





    @Override  DashboardFeatureProviderImpl.java
    public DashboardCategory getTilesForCategory(String key) {
        return mCategoryManager.getTilesByCategory(mContext, key);
    }





    CategoryManager.java   TileUtils.SETTING_PKG = &quot;com.android.settings&quot;    categoryKey=&quot;com.android.settings.category.ia.homepage&quot;
    public synchronized DashboardCategory getTilesByCategory(Context context, String categoryKey) {
        return getTilesByCategory(context, categoryKey, TileUtils.SETTING_PKG);
    }

    CategoryManager.java
    public synchronized DashboardCategory getTilesByCategory(Context context, String categoryKey,
            String settingPkg) {
        tryInitCategories(context, settingPkg);

        return mCategoryByKeyMap.get(categoryKey); // private final Map&lt;String, DashboardCategory&gt; mCategoryByKeyMap;
    }



    CategoryManager.java
    private synchronized void tryInitCategories(Context context, boolean forceClearCache,
            String settingPkg) {
        if (mCategories == null) {
            if (forceClearCache) {
                mTileByComponentCache.clear();
            }
            mCategoryByKeyMap.clear();
    // Tile cache (key: &lt;packageName, activityName&gt;, value: tile) private final Map&lt;Pair&lt;String, String&gt;, Tile&gt; mTileByComponentCache;
    // Tile cache (key: category key, value: category) private final Map&lt;String, DashboardCategory&gt; mCategoryByKeyMap;

// 从AndroidManiest.xml获得DashboardCategory集合 List&lt;DashboardCategory&gt; mCategories;  private String mExtraAction;
            mCategories = TileUtils.getCategories(context, mTileByComponentCache,  
                    false /* categoryDefinedInManifest */, mExtraAction, settingPkg);  //  private List&lt;DashboardCategory&gt; mCategories;
            for (DashboardCategory category : mCategories) {
                mCategoryByKeyMap.put(category.key, category);
            }
            backwardCompatCleanupForCategory(mTileByComponentCache, mCategoryByKeyMap);
            sortCategories(context, mCategoryByKeyMap);
            filterDuplicateTiles(mCategoryByKeyMap);
        }
    }



TileUtils.java
    public static List&lt;DashboardCategory&gt; getCategories(Context context,
            Map&lt;Pair&lt;String, String&gt;, Tile&gt; cache, boolean categoryDefinedInManifest,
            String extraAction, String settingPkg) {
        final long startTime = System.currentTimeMillis();
        boolean setup = Global.getInt(context.getContentResolver(), Global.DEVICE_PROVISIONED, 0)
                != 0;
        ArrayList&lt;Tile&gt; tiles = new ArrayList&lt;&gt;();
        UserManager userManager = (UserManager) context.getSystemService(Context.USER_SERVICE);
        for (UserHandle user : userManager.getUserProfiles()) {
            // TODO: Needs much optimization, too many PM queries going on here.
            if (user.getIdentifier() == ActivityManager.getCurrentUser()) {
                // Only add Settings for this user.
                getTilesForAction(context, user, SETTINGS_ACTION, cache, null, tiles, true,
                        settingPkg);
                getTilesForAction(context, user, OPERATOR_SETTINGS, cache,
                        OPERATOR_DEFAULT_CATEGORY, tiles, false, true, settingPkg);
                getTilesForAction(context, user, MANUFACTURER_SETTINGS, cache,
                        MANUFACTURER_DEFAULT_CATEGORY, tiles, false, true, settingPkg);
            }
            if (setup) {
                getTilesForAction(context, user, EXTRA_SETTINGS_ACTION, cache, null, tiles, false,
                        settingPkg);
                if (!categoryDefinedInManifest) {  // run Here  IA_SETTINGS_ACTION=&quot;com.android.settings.action.IA_SETTINGS&quot;
                    getTilesForAction(context, user, IA_SETTINGS_ACTION, cache, null, tiles, false,settingPkg);
                    if (extraAction != null) {
                        getTilesForAction(context, user, extraAction, cache, null, tiles, false,settingPkg);
                    }
                }
            }
        }

        HashMap&lt;String, DashboardCategory&gt; categoryMap = new HashMap&lt;&gt;();
        for (Tile tile : tiles) { // 遍历所有的Title
            DashboardCategory category = categoryMap.get(tile.category); // 通过Tile的 category 拿到 对应的 category
            if (category == null) {
                category = createCategory(context, tile.category, categoryDefinedInManifest);
                if (category == null) {
                    Log.w(LOG_TAG, &quot;Couldn&#39;t find category &quot; + tile.category);
                    continue;
                }
                categoryMap.put(category.key, category);
            }
            category.addTile(tile); // 往Category 增加 Tile
        }
        ArrayList&lt;DashboardCategory&gt; categories = new ArrayList&lt;&gt;(categoryMap.values());
        for (DashboardCategory category : categories) {
            Collections.sort(category.tiles, TILE_COMPARATOR);
        }
        Collections.sort(categories, CATEGORY_COMPARATOR);
        if (DEBUG_TIMING) Log.d(LOG_TAG, &quot;getCategories took &quot;
                + (System.currentTimeMillis() - startTime) + &quot; ms&quot;);
        return categories;
    }


TileUtils.java    // 创建DashboardCategory
    private static DashboardCategory createCategory(Context context, String categoryKey,
            boolean categoryDefinedInManifest) {
        DashboardCategory category = new DashboardCategory();
        category.key = categoryKey;
        if (!categoryDefinedInManifest) {
            return category;
        }
        PackageManager pm = context.getPackageManager();
        List&lt;ResolveInfo&gt; results = pm.queryIntentActivities(new Intent(categoryKey), 0);
        if (results.size() == 0) {
            return null;
        }
        for (ResolveInfo resolved : results) { // 过滤掉所有非系统设置的ResolveInfo  
            if (!resolved.system) {
                // Do not allow any app to add to settings, only system ones.
                continue;
            }
            category.title = resolved.activityInfo.loadLabel(pm);
            category.priority = SETTING_PKG.equals(
                    resolved.activityInfo.applicationInfo.packageName) ? resolved.priority : 0;
            if (DEBUG) Log.d(LOG_TAG, &quot;Adding category &quot; + category.title);
        }

        return category;
    }


TileUtils.java
    private static void getTilesForAction(Context context,
            UserHandle user, String action, Map&lt;Pair&lt;String, String&gt;, Tile&gt; addedCache,
            String defaultCategory, ArrayList&lt;Tile&gt; outTiles, boolean requireSettings,
            boolean usePriority, String settingPkg) {
        Intent intent = new Intent(action);
        if (requireSettings) {
            intent.setPackage(settingPkg);
        }
        getTilesForIntent(context, user, intent, addedCache, defaultCategory, outTiles,usePriority, true, true);
    }


TileUtils.java
    public static void getTilesForIntent(
            Context context, UserHandle user, Intent intent,
            Map&lt;Pair&lt;String, String&gt;, Tile&gt; addedCache, String defaultCategory, List&lt;Tile&gt; outTiles,
            boolean usePriority, boolean checkCategory, boolean forceTintExternalIcon,
            boolean shouldUpdateTiles) {
        PackageManager pm = context.getPackageManager();

       List&lt;ResolveInfo&gt; results = pm.queryIntentActivitiesAsUser(intent,PackageManager.GET_META_DATA, user.getIdentifier()); // 每一个AndroidmaniFest组件都是一个Tile
       Map&lt;String, IContentProvider&gt; providerMap = new HashMap&lt;&gt;();
        for (ResolveInfo resolved : results) { // 查看当前AndroidManifest.xml 中定义的四大组件
            ActivityInfo activityInfo = resolved.activityInfo; // 获得ActivityInfo信息
            Bundle metaData = activityInfo.metaData;
            String categoryKey = metaData.getString(EXTRA_CATEGORY_KEY); // EXTRA_CATEGORY_KEY =&quot;com.android.settings.category&quot; 获得 该key对应的值

// 创建Map&lt;Pair&lt;String, String&gt;, Tile&gt; mTileByComponentCache; 对应的 key ---Pair&lt;String, String&gt; key 
            Pair&lt;String, String&gt; key = new Pair&lt;String, String&gt;(activityInfo.packageName,activityInfo.name);  
            Tile tile = addedCache.get(key);
            if (tile == null) {
                tile = new Tile();  // 创建Tile类
                tile.intent = new Intent().setClassName(activityInfo.packageName, activityInfo.name); // 设置Tile类的Intent 
                tile.category = categoryKey;
                tile.priority = usePriority ? resolved.priority : 0;
                tile.metaData = activityInfo.metaData;
                updateTileData(context, tile, activityInfo, activityInfo.applicationInfo,pm, providerMap, forceTintExternalIcon);
                addedCache.put(key, tile);  //  往  Map&lt;Pair&lt;String, String&gt;, Tile&gt; mTileByComponentCache;   填充数据
            } else if (shouldUpdateTiles) {
                updateSummaryAndTitle(context, providerMap, tile);
            }

}


TileUtils.java // 更新 Tile的数据
    private static boolean updateTileData(Context context, Tile tile,
            ActivityInfo activityInfo, ApplicationInfo applicationInfo, PackageManager pm,
            Map&lt;String, IContentProvider&gt; providerMap, boolean forceTintExternalIcon) {
        if (applicationInfo.isSystemApp()) {
            boolean forceTintIcon = false;
            int icon = 0;
            Pair&lt;String, Integer&gt; iconFromUri = null;
            CharSequence title = null;
            String summary = null;
            String keyHint = null;
            boolean isIconTintable = false;

            // Get the activity&#39;s meta-data
            try {
                Resources res = pm.getResourcesForApplication(applicationInfo.packageName);
                Bundle metaData = activityInfo.metaData;

                if (forceTintExternalIcon
                        &amp;&amp; !context.getPackageName().equals(applicationInfo.packageName)) {
                    isIconTintable = true;
                    forceTintIcon = true;
                }

                if (res != null &amp;&amp; metaData != null) {
                    if (metaData.containsKey(META_DATA_PREFERENCE_ICON)) {
                        icon = metaData.getInt(META_DATA_PREFERENCE_ICON);
                    }
                    if (metaData.containsKey(META_DATA_PREFERENCE_ICON_TINTABLE)) {
                        if (forceTintIcon) {
                            Log.w(LOG_TAG, &quot;Ignoring icon tintable for &quot; + activityInfo);
                        } else {
                            isIconTintable =
                                    metaData.getBoolean(META_DATA_PREFERENCE_ICON_TINTABLE);
                        }
                    }
                    int resId = 0;
                    if (metaData.containsKey(META_DATA_PREFERENCE_TITLE_RES_ID)) {
                        resId = metaData.getInt(META_DATA_PREFERENCE_TITLE_RES_ID);
                        if (resId != 0) {
                            title = res.getString(resId);
                        }
                    }
                    if ((resId == 0) &amp;&amp; metaData.containsKey(META_DATA_PREFERENCE_TITLE)) {
                        if (metaData.get(META_DATA_PREFERENCE_TITLE) instanceof Integer) {
                            title = res.getString(metaData.getInt(META_DATA_PREFERENCE_TITLE));
                        } else {
                            title = metaData.getString(META_DATA_PREFERENCE_TITLE);
                        }
                    }
                    if (metaData.containsKey(META_DATA_PREFERENCE_SUMMARY)) {
                        if (metaData.get(META_DATA_PREFERENCE_SUMMARY) instanceof Integer) {
                            summary = res.getString(metaData.getInt(META_DATA_PREFERENCE_SUMMARY));
                        } else {
                            summary = metaData.getString(META_DATA_PREFERENCE_SUMMARY);
                        }
                    }
                    if (metaData.containsKey(META_DATA_PREFERENCE_KEYHINT)) {
                        if (metaData.get(META_DATA_PREFERENCE_KEYHINT) instanceof Integer) {
                            keyHint = res.getString(metaData.getInt(META_DATA_PREFERENCE_KEYHINT));
                        } else {
                            keyHint = metaData.getString(META_DATA_PREFERENCE_KEYHINT);
                        }
                    }
                    if (metaData.containsKey(META_DATA_PREFERENCE_CUSTOM_VIEW)) {
                        int layoutId = metaData.getInt(META_DATA_PREFERENCE_CUSTOM_VIEW);
                        tile.remoteViews = new RemoteViews(applicationInfo.packageName, layoutId);
                        updateSummaryAndTitle(context, providerMap, tile);
                    }
                }
            } catch (PackageManager.NameNotFoundException | Resources.NotFoundException e) {
                if (DEBUG) Log.d(LOG_TAG, &quot;Couldn&#39;t find info&quot;, e);
            }

            // Set the preference title to the activity&#39;s label if no
            // meta-data is found
            if (TextUtils.isEmpty(title)) {
                title = activityInfo.loadLabel(pm).toString();
            }

            // Set the icon 设置 Tile的图标资源
            if (iconFromUri != null) {
                tile.icon = Icon.createWithResource(iconFromUri.first, iconFromUri.second);
            } else {
                if (icon == 0) {
                    icon = activityInfo.icon;
                }
                tile.icon = Icon.createWithResource(activityInfo.packageName, icon); 
            }

            // Set title and summary for the preference  设置 Tile的标题  和  简要
//  title = activityInfo.loadLabel(pm).toString();
//// title 从updateSummaryAndTitle 方法中获得  String overrideTitle = getString(bundle, META_DATA_PREFERENCE_TITLE); // &quot;com.android.settings.title
            tile.title = title;  

//META_DATA_PREFERENCE_SUMMARY = &quot;com.android.settings.summary&quot;
// summary = res.getString(metaData.getInt(META_DATA_PREFERENCE_SUMMARY)); 
// summary = metaData.getString(META_DATA_PREFERENCE_SUMMARY); // 使用 &quot;com.android.settings.summary&quot; 指定的字符串
// summary从updateSummaryAndTitle 方法中获得  String overrideSummary = getString(bundle, META_DATA_PREFERENCE_SUMMARY);
            tile.summary = summary; 

            // Replace the intent with this specific activity
            tile.intent = new Intent().setClassName(activityInfo.packageName,
                    activityInfo.name);
            // Suggest a key for this tile
            tile.key = keyHint;
            tile.isIconTintable = isIconTintable;

            return true;
        }

        return false;
    }




TileUtils.java
    private static void updateSummaryAndTitle(
            Context context, Map&lt;String, IContentProvider&gt; providerMap, Tile tile) {
        if (tile == null || tile.metaData == null
                || !tile.metaData.containsKey(META_DATA_PREFERENCE_SUMMARY_URI)) {
            return;
        }
// META_DATA_PREFERENCE_SUMMARY_URI = &quot;com.android.settings.summary_uri&quot;   如果包含&quot;com.android.settings.summary&quot;这个meta-data
        String uriString = tile.metaData.getString(META_DATA_PREFERENCE_SUMMARY_URI);
        Bundle bundle = getBundleFromUri(context, uriString, providerMap);
        String overrideSummary = getString(bundle, META_DATA_PREFERENCE_SUMMARY);// &quot;com.android.settings.summary&quot;
        String overrideTitle = getString(bundle, META_DATA_PREFERENCE_TITLE); // &quot;com.android.settings.title&quot;
        if (overrideSummary != null) {
            tile.remoteViews.setTextViewText(android.R.id.summary, overrideSummary); // 设置Tile的显示的简要
        }

        if (overrideTitle != null) {
            tile.remoteViews.setTextViewText(android.R.id.title, overrideTitle); // 设置Tile的显示标题
        }
    }



TileUtils.java
    private static Bundle getBundleFromUri(Context context, String uriString,
            Map&lt;String, IContentProvider&gt; providerMap) {
        if (TextUtils.isEmpty(uriString)) {
            return null;
        }
        Uri uri = Uri.parse(uriString);
        String method = getMethodFromUri(uri);
        if (TextUtils.isEmpty(method)) {
            return null;
        }
 //  相当于IContentProvider provider = providerMap.get(uri.getAuthority());
        IContentProvider provider = getProviderFromUri(context, uri, providerMap); 
        if (provider == null) {
            return null;
        }
        try {
            return provider.call(context.getPackageName(), method, uriString, null);  // 反射机制阿
        } catch (RemoteException e) {
            return null;
        }
    }

TileUtils.java
    private static IContentProvider getProviderFromUri(Context context, Uri uri,
            Map&lt;String, IContentProvider&gt; providerMap) {
        if (uri == null) {
            return null;
        }
        String authority = uri.getAuthority();
        if (TextUtils.isEmpty(authority)) {
            return null;
        }
        if (!providerMap.containsKey(authority)) {  //如果没有这个Key  则添加这个Key
            providerMap.put(authority, context.getContentResolver().acquireUnstableProvider(uri));
        }
        return providerMap.get(authority);
    }

TileUtils.java
    static String getMethodFromUri(Uri uri) {
        if (uri == null) {
            return null;
        }
        List&lt;String&gt; pathSegments = uri.getPathSegments();
        if ((pathSegments == null) || pathSegments.isEmpty()) {
            return null;
        }
        return pathSegments.get(0);
    }





*******************************************************
~~~~~~~~~~~~~~~~~
public class DashboardCategory  implements Parcelable {

    public CharSequence title;
    public String key;
    public int prioprity;
    public List&lt;Tile&gt; tiles;  // 主要成员  一级菜单对应的 Tile的集合   每个Tile 都包含 title标题  summary简要 Icon图标  Intent等信息

}


~~~~~~~~~~~~~~~~~
</code></pre><p><a href="file/DashboardAdapter.java">/packages/apps/Settings/src/com/android/settings/dashboard/DashboardAdapter.java</a><br><a href="file/Tile.java">/frameworks/base/packages/SettingsLib/src/com/android/settingslib/drawer/Tile.java</a></p>
<pre><code>/packages/apps/Settings/src/com/android/settings/dashboard/DashboardAdapter.java  // 该文件是Setting的主界面适配器类

public class DashboardAdapter extends RecyclerView.Adapter&lt;DashboardAdapter.DashboardItemHolder&gt;
        implements SummaryLoader.SummaryConsumer, SuggestionDismissController.Callback {


     DashboardData mDashboardData;  // 数据集合


    public void setCategory(List&lt;DashboardCategory&gt; category) {
        final DashboardData prevData = mDashboardData;
        Log.d(TAG, &quot;adapter setCategory called&quot;);
        mDashboardData = new DashboardData.Builder(prevData)
                .setCategories(category)     //【从DashboardSummary 调用setCategory 设置了 数据源】
                .build();
        notifyDashboardDataChanged(prevData);
    }




    private View.OnClickListener mTileClickListener = new View.OnClickListener() {
        @Override
        public void onClick(View v) {
            //TODO: get rid of setTag/getTag
            mDashboardFeatureProvider.openTileIntent((Activity) mContext, (Tile) v.getTag()); // 打开在Tag中定义的Intent
        }
    };     





     @Override 【/packages/apps/Settings/src/com/android/settings/dashboard/DashboardFeatureProviderImpl.java】
    public void openTileIntent(Activity activity, Tile tile) {
        if (tile == null) {
            Intent intent = new Intent(Settings.ACTION_SETTINGS).addFlags(
                    Intent.FLAG_ACTIVITY_CLEAR_TASK);
            mContext.startActivity(intent);
            return;
        }

        if (tile.intent == null) {
            return;
        }
        final Intent intent = new Intent(tile.intent)    //  从Title中获取Intent
                .putExtra(SettingsActivity.EXTRA_SOURCE_METRICS_CATEGORY,
                        MetricsEvent.DASHBOARD_SUMMARY)
                .putExtra(SettingsDrawerActivity.EXTRA_SHOW_MENU, true)
                .addFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK);
        launchIntentOrSelectProfile(activity, tile, intent, MetricsEvent.DASHBOARD_SUMMARY); 【最终调用 activity.startActivityForResult(intent, 0);】
    }




    【DashboardData】
    public int size() {
        return mItems.size();
    }


    @Override
    public int getItemCount() {
        return mDashboardData.size();  //【显示的数量来源于 mDashboardData.size() 最终来源于 DashboardData.mItems【List】.size()】
    }


        @Override
    public DashboardItemHolder onCreateViewHolder(ViewGroup parent, int viewType) { // 绘制该adater的View
        return new DashboardItemHolder(LayoutInflater.from(parent.getContext()).inflate(
                viewType, parent, false));
    }
~~~~~~~~~~~~~~~~~
       public static class DashboardItemHolder extends RecyclerView.ViewHolder { // 绑定ICON  Title 和 summary 对应的 View
        public final ImageView icon;
        public final TextView title;
        public final TextView summary;

        public DashboardItemHolder(View itemView) {
            super(itemView);
            icon = itemView.findViewById(android.R.id.icon);
            title = itemView.findViewById(android.R.id.title);
            summary = itemView.findViewById(android.R.id.summary);
        }
    }

     private void onBindTile(DashboardItemHolder holder, Tile tile) {  // 设置最终显示的字样
        holder.icon.setImageDrawable(mCache.getIcon(tile.icon));
        holder.title.setText(tile.title);
        if (!TextUtils.isEmpty(tile.summary)) {
            holder.summary.setText(tile.summary);
            holder.summary.setVisibility(View.VISIBLE);
        } else {
            holder.summary.setVisibility(View.GONE);
        }
    }
~~~~~~~~~~~~~~~~~


    @Override
    public void onBindViewHolder(DashboardItemHolder holder, int position) {  // 设置主界面的点击逻辑设置函数
        final int type = mDashboardData.getItemTypeByPosition(position);   // mDashboardData 是数据集合
        switch (type) {
            case R.layout.dashboard_category:
                onBindCategory(holder,
                        (DashboardCategory) mDashboardData.getItemEntityByPosition(position));
                break;
            case R.layout.dashboard_tile: //  表示当前的类型是 catetory_title 类型的
                final Tile tile = (Tile) mDashboardData.getItemEntityByPosition(position);
                onBindTile(holder, tile);   // 绑定当前的ViewItem  和 tile   ，使得显示正确的数据字符  和 图标
                holder.itemView.setTag(tile); // 设置每一项的Tag  Tag来源为  mDashboardData.getItemEntityByPosition(position);
                holder.itemView.setOnClickListener(mTileClickListener); // 设置 catetory_title 的点击函数
                break;
            case R.layout.suggestion_header:
                onBindSuggestionHeader(holder, (DashboardData.SuggestionHeaderData)
                        mDashboardData.getItemEntityByPosition(position));
                break;
            case R.layout.suggestion_tile:
                final Tile suggestion = (Tile) mDashboardData.getItemEntityByPosition(position);
                final String suggestionId = mSuggestionFeatureProvider.getSuggestionIdentifier(
                        mContext, suggestion);
                // This is for cases when a suggestion is dismissed and the next one comes to view
                if (!mSuggestionsShownLogged.contains(suggestionId)) {
                    mMetricsFeatureProvider.action(
                            mContext, MetricsEvent.ACTION_SHOW_SETTINGS_SUGGESTION, suggestionId);
                    mSuggestionsShownLogged.add(suggestionId);
                }
                onBindTile(holder, suggestion);
                holder.itemView.setOnClickListener(v -&gt; {
                    mMetricsFeatureProvider.action(mContext,
                            MetricsEvent.ACTION_SETTINGS_SUGGESTION, suggestionId);
                    ((SettingsActivity) mContext).startSuggestion(suggestion.intent);
                });
                break;
            case R.layout.condition_card:
                final boolean isExpanded = mDashboardData.getItemEntityByPosition(position)
                        == mDashboardData.getExpandedCondition();
                ConditionAdapterUtils.bindViews(
                        (Condition) mDashboardData.getItemEntityByPosition(position),
                        holder, isExpanded, mConditionClickListener, v -&gt; onExpandClick(v));
                break;
        }
    }


}


public class DashboardData { // 保存数据的List
    private final List&lt;Item&gt; mItems;
    private final List&lt;DashboardCategory&gt; mCategories;  // DashboardCategory 应该是解析的AndroidManifest.xml 文件中  Acctivity的&lt;meta-data&gt;属性
    private final List&lt;Condition&gt; mConditions;
    private final List&lt;Tile&gt; mSuggestions;


    public Object getItemEntityByPosition(int position) {
        return mItems.get(position).entity;
    }


     private void buildItemsData() { // 构建 ITEM
     .....
        for (int i = 0; mCategories != null &amp;&amp; i &lt; mCategories.size(); i++) { // 先遍历 mCategories ，  然后再遍历每个DashboardCategory的 tiles
            DashboardCategory category = mCategories.get(i);
            countItem(category, R.layout.dashboard_category,!TextUtils.isEmpty(category.title), NS_ITEMS);
            for (int j = 0; j &lt; category.tiles.size(); j++) {
                Tile tile = category.tiles.get(j);  // title 来自于 category  【/frameworks/base/packages/SettingsLib/src/com/android/settingslib/drawer/Tile.java】
                countItem(tile, R.layout.dashboard_tile, true, NS_ITEMS);  // 资源布局ID  R.layout.dashboard_tile
            }
         }
     .....
     }

~~~~~~~~~~~~~~~~~
     /frameworks/base/packages/SettingsLib/src/com/android/settingslib/drawer/Tile.java
    public class Tile implements Parcelable {
    public CharSequence title;
    public CharSequence summary;
    public Icon icon;
    public Intent intent;
    public ArrayList&lt;UserHandle&gt; userHandle = new ArrayList&lt;&gt;();
    public Bundle extras;
    public String category;
    public int priority;
    public Bundle metaData;
    public String key;
    }
~~~~~~~~~~~~~~~~~


        private void countItem(Object object, int type, boolean add, int nameSpace) {
        if (add) {
            mItems.add(new Item(object【Tile】, type, mId + nameSpace, object == mExpandedCondition)); // 添加Item
        }
        mId++;
    }



    private static class Item {
    public final Object entity;  //  最终能转化为 (/frameworks/base/packages/SettingsLib/src/com/android/settingslib/drawer/Tile.java)  包含 (tile.intent) 


    public Item(Object entity, @ItemTypes int type, int id, boolean conditionExpanded) {
    this.entity = entity;  // 构造函数   获取到 entity
    this.type = type;
    this.id = id;
    this.conditionExpanded = conditionExpanded;
    }

    }






}
</code></pre><pre><code>网络和互联网界面引用的布局XML文件   二级菜单加载 使用 xml布局文件
// 在AndroidManifest.xml 文件中指定了该NetworkDashboardActivity启动时加载的NetworkDashboardFragment的加载界面类的 &lt;meta-data&gt;数据
/packages/apps/Settings/src/com/android/settings/network/NetworkDashboardFragment.java   
    @Override
    protected int getPreferenceScreenResId() {
        return R.xml.network_and_internet;  // 引入布局的XML文件
 }
</code></pre><p><a href="file/network_and_internet.xml">/packages/apps/Settings/res/xml/network_and_internet.xml</a></p>
<h3 id="wifi-ua1-">WIFI-UA1布局分析</h3>
<p><img src="img/23.png" width = "25%" height="25%"/><br><a href="file/dashboard_tile.xml">/packages/apps/Settings/res/layout/dashboard_tile.xml</a></p>
<pre><code>设置主界面的每一项Item的布局文件 dashboard_tile.xml
/packages/apps/Settings/res/layout/dashboard_tile.xml

&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

&lt;LinearLayout
    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:id=&quot;@+id/dashboard_tile&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:background=&quot;?android:attr/selectableItemBackground&quot;
    android:gravity=&quot;center_vertical&quot;
    android:minHeight=&quot;@dimen/dashboard_tile_minimum_height&quot;
    android:clickable=&quot;true&quot;
    android:focusable=&quot;true&quot;&gt;

    &lt;ImageView
        android:id=&quot;@android:id/icon&quot;
        android:layout_width=&quot;@dimen/dashboard_tile_image_size&quot;
        android:layout_height=&quot;@dimen/dashboard_tile_image_size&quot;
        android:scaleType=&quot;centerInside&quot;
        android:layout_marginStart=&quot;@dimen/dashboard_tile_image_margin_start&quot;
        android:layout_marginEnd=&quot;@dimen/dashboard_tile_image_margin_end&quot; /&gt;

    &lt;LinearLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:orientation=&quot;vertical&quot;&gt;

        &lt;TextView android:id=&quot;@android:id/title&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:singleLine=&quot;true&quot;
            android:textAppearance=&quot;@style/TextAppearance.TileTitle&quot;
            android:ellipsize=&quot;marquee&quot;
            android:fadingEdge=&quot;horizontal&quot; /&gt;

        &lt;TextView android:id=&quot;@android:id/summary&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:textAppearance=&quot;@style/TextAppearance.Small&quot;
            android:textColor=&quot;?android:attr/textColorSecondary&quot;
            android:maxLines=&quot;1&quot;
            android:ellipsize=&quot;end&quot;
            android:paddingEnd=&quot;@dimen/dashboard_tile_image_margin_start&quot; /&gt;

    &lt;/LinearLayout&gt;

&lt;/LinearLayout&gt;
</code></pre><p><img src="img/20.png" width = "25%" height="25%"/></p>
<pre><code>packages/apps/Settings/res/xml/network_and_internet.xml

&lt;PreferenceScreen
    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:settings=&quot;http://schemas.android.com/apk/res/com.android.settings&quot;
    android:title=&quot;@string/network_dashboard_title&quot;&gt;

    &lt;com.android.settings.widget.MasterSwitchPreference
        android:fragment=&quot;com.android.settings.wifi.WifiSettings&quot;
        android:key=&quot;toggle_wifi&quot;
        android:title=&quot;@string/wifi_settings&quot; 【WLAN】
【&lt;string name=&quot;summary_placeholder&quot; &gt;&amp;#160;&lt;/string&gt; 由WIFI状态动态设置 这里只是占位符】
        android:summary=&quot;@string/summary_placeholder&quot; 
        android:icon=&quot;@drawable/ic_settings_wireless&quot;
        android:order=&quot;-30&quot;&gt;
【在配置每个Preference元素节点时，我们可以显示为点击它时所跳转的Intent。点击该Preference，跳转至目标Intent】
        &lt;intent
            android:action=&quot;android.settings.WIFI_SETTINGS&quot;
            android:targetClass=&quot;Settings$WifiSettingsActivity&quot;/&gt; // WifiSettingsActivity 目标类名 
    &lt;/com.android.settings.widget.MasterSwitchPreference&gt;

    &lt;com.android.settingslib.RestrictedPreference
        android:key=&quot;mobile_network_settings&quot;
        android:title=&quot;@string/network_settings_title&quot;
        android:icon=&quot;@drawable/ic_network_cell&quot;
        android:dependency=&quot;toggle_airplane&quot;
        android:order=&quot;-15&quot;
        settings:keywords=&quot;@string/keywords_more_mobile_networks&quot;
        settings:userRestriction=&quot;no_config_mobile_networks&quot;
        settings:useAdminDisabledSummary=&quot;true&quot;&gt;
        &lt;intent
            android:action=&quot;android.intent.action.MAIN&quot;
            android:targetPackage=&quot;com.android.phone&quot;
            android:targetClass=&quot;com.android.phone.MobileNetworkSettings&quot;/&gt;
    &lt;/com.android.settingslib.RestrictedPreference&gt;

    &lt;com.android.settingslib.RestrictedPreference
        android:fragment=&quot;com.android.settings.TetherSettings&quot;
        android:key=&quot;tether_settings&quot;
        【&lt;string name=&quot;tether_settings_title_all&quot;&gt;&quot;热点和网络共享&quot;&lt;/string&gt;】
        android:title=&quot;@string/tether_settings_title_all&quot;
        android:icon=&quot;@drawable/ic_wifi_tethering&quot;
        android:order=&quot;-5&quot;
        android:summary=&quot;@string/summary_placeholder&quot;
        settings:userRestriction=&quot;no_config_tethering&quot;
        settings:useAdminDisabledSummary=&quot;true&quot;/&gt;

    &lt;com.android.settingslib.RestrictedPreference
        android:fragment=&quot;com.android.settings.vpn2.VpnSettings&quot;
        android:key=&quot;vpn_settings&quot;
        android:title=&quot;@string/vpn_settings_title&quot;
        android:icon=&quot;@drawable/ic_vpn_key&quot;
        android:order=&quot;0&quot;
        android:summary=&quot;@string/summary_placeholder&quot;
        settings:userRestriction=&quot;no_config_vpn&quot;
        settings:useAdminDisabledSummary=&quot;true&quot;/&gt;

    &lt;com.android.settingslib.RestrictedPreference
        android:key=&quot;manage_mobile_plan&quot;
        android:title=&quot;@string/manage_mobile_plan_title&quot;
        android:persistent=&quot;false&quot;
        settings:userRestriction=&quot;no_config_mobile_networks&quot;
        settings:useAdminDisabledSummary=&quot;true&quot;/&gt;

    &lt;SwitchPreference
        android:key=&quot;toggle_airplane&quot;
        android:title=&quot;@string/airplane_mode&quot;
        android:icon=&quot;@drawable/ic_airplanemode_active&quot;
        android:disableDependentsState=&quot;true&quot;
        android:order=&quot;5&quot;/&gt;

    &lt;Preference
        android:fragment=&quot;com.android.settings.ProxySelector&quot;
        android:key=&quot;proxy_settings&quot;
        android:title=&quot;@string/proxy_settings_title&quot;/&gt;

&lt;/PreferenceScreen&gt;
</code></pre><h2 id="wifi-ua2-">WIFI UA2分析</h2>
<h3 id="wifi-ua2-">WIFI UA2 操作列</h3>
<p><img src="img/1.png" width = "25%" height="25%"/></p>
<ol>
<li><strong>UA编号</strong>   UA2</li><li><strong>UA说明</strong>  <strong> WIFI功能开关</strong></li><li><p><strong>UA触发函数</strong>  **在network_and_internet.xml布局文件的Preference指定了Swith开关对应的类 MasterSwitchPreference.java文件中定义的onclick函数<br>业务处理函数为： /packages/apps/Settings/src/com/android/settings/wifi/WifiEnabler.java的 onSwitchToggled 方法</p>
<pre><code>      &lt;com.android.settings.widget.MasterSwitchPreference    // Switch控件
     android:fragment=&quot;com.android.settings.wifi.WifiSettings&quot;  //   触发的Fragment
     android:key=&quot;toggle_wifi&quot;
     &lt;intent
         android:action=&quot;android.settings.WIFI_SETTINGS&quot;   // 点击content时执行Intent
         android:targetClass=&quot;Settings$WifiSettingsActivity&quot;/&gt;
      &lt;/com.android.settings.widget.MasterSwitchPreference&gt;

          widgetView.setOnClickListener(new OnClickListener() {
             @Override
             public void onClick(View v) {
                 if (mSwitch != null &amp;&amp; !mSwitch.isEnabled()) {
                     return;
                 }
                 setChecked(!mChecked);
                 if (!callChangeListener(mChecked)) {
                     setChecked(!mChecked);
                 } else {
                     persistBoolean(mChecked);
                 }
             }
         });
</code></pre></li><li><strong>UA字符可选值</strong>    1.switch开启     2.switch关闭    3.switch不可用</li><li><strong>UA布局及ID</strong>      NetworkDashboardFragment的布局文件network_and_internet.xml中 &lt;com.android.settings.widget.MasterSwitchPreference android:key=&quot;toggle_wifi&quot; 自定义控件</li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong> </li><li><strong>数据库可选值 </strong> </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>  </li><li><strong>UA触发函数所在类</strong>   MasterSwitchPreference.java文件中 onBindViewHolder 定义的onclick函数           </li></ol>
<hr>
<h3 id="wifi-ua2-">WIFI UA2 代码分析</h3>
<pre><code>    &lt;com.android.settings.widget.MasterSwitchPreference  【network_and_internet.xml中定义的MasterSwitchPreference 】
        android:fragment=&quot;com.android.settings.wifi.WifiSettings&quot;
        android:key=&quot;toggle_wifi&quot;
        &lt;intent
            android:action=&quot;android.settings.WIFI_SETTINGS&quot;
            android:targetClass=&quot;Settings$WifiSettingsActivity&quot;/&gt;
    &lt;/com.android.settings.widget.MasterSwitchPreference&gt;


    继承关系：
    /packages/apps/Settings/src/com/android/settings/widget/MasterSwitchPreference.java extends /frameworks/base/packages/SettingsLib/src/com/android/settingslib/TwoTargetPreference.java
    /frameworks/base/packages/SettingsLib/src/com/android/settingslib/TwoTargetPreference.java extends /frameworks/base/core/java/android/preference/Preference.java

    public class MasterSwitchPreference extends TwoTargetPreference {

    private Switch mSwitch;  // Switch控件
    private boolean mChecked;  // 当前开关状态
    private boolean mEnableSwitch = true;  // 当前View是否使能


    @Override
    protected int getSecondTargetResId() {
        return R.layout.preference_widget_master_switch;
    }

        @Override
    public void onBindViewHolder(PreferenceViewHolder holder) {
        super.onBindViewHolder(holder);
        final View widgetView = holder.findViewById(android.R.id.widget_frame);
        if (widgetView != null) {
            widgetView.setOnClickListener(new OnClickListener() { // 为Switch按钮设置点击事件
                @Override
                public void onClick(View v) {
                    if (mSwitch != null &amp;&amp; !mSwitch.isEnabled()) {
                        return;
                    }
                    setChecked(!mChecked);
                    if (!callChangeListener(mChecked)) { // 调用监听类通知wifi开关状态改变 在爷爷类 /frameworks/base/core/java/android/preference/Preference.java 定义的方法
                        setChecked(!mChecked);
                    } else {
                        persistBoolean(mChecked);
                    }
                }
            });
        }
        mSwitch = (Switch) holder.findViewById(R.id.switchWidget);
        if (mSwitch != null) {
            mSwitch.setContentDescription(getTitle());
            mSwitch.setChecked(mChecked);
            mSwitch.setEnabled(mEnableSwitch);
        }
    }
    }


 /frameworks/base/core/java/android/preference/Preference.java

    private OnPreferenceChangeListener mOnChangeListener;

     public interface OnPreferenceChangeListener {
        boolean onPreferenceChange(Preference preference, Object newValue);
    }

     protected boolean callChangeListener(Object newValue) {
        return mOnChangeListener == null || mOnChangeListener.onPreferenceChange(this, newValue); // 调用 监听MasterSwitchController类mOnChangeListener的实现的onPreferenceChange接口
    }


 /packages/apps/Settings/src/com/android/settings/widget/MasterSwitchController.java 继承 
 public class MasterSwitchController extends SwitchWidgetController implements
    Preference.OnPreferenceChangeListener {  // 实现了监听接口 Preference.OnPreferenceChangeListener 

    private final MasterSwitchPreference mPreference; // 该类对应控件network_and_internet.xml中   com.android.settings.widget.MasterSwitchPreference


   @Override
    public boolean onPreferenceChange(Preference preference, Object newValue) {
        if (mListener != null) {
            return mListener.onSwitchToggled((Boolean) newValue); // 又在onPreferenceChange的监听方法中 继续调用 OnSwitchChangeListener的监听接口 onSwitchToggled
        }
        return false;
    }

    }


/packages/apps/Settings/src/com/android/settings/widget/SwitchWidgetController.java
public abstract class SwitchWidgetController {

    protected OnSwitchChangeListener mListener;

    public interface OnSwitchChangeListener {
        boolean onSwitchToggled(boolean isChecked);
    }
    }

// 判断哪里实现了监听的逻辑代码
/packages/apps/Settings/src/com/android/settings/wifi/WifiMasterSwitchPreferenceController.java

public class WifiMasterSwitchPreferenceController extends PreferenceController
        implements SummaryUpdater.OnSummaryChangeListener,
        LifecycleObserver, OnResume, OnPause, OnStart, OnStop {

    public static final String KEY_TOGGLE_WIFI = &quot;toggle_wifi&quot;;

    private MasterSwitchPreference mWifiPreference;  //【该类对应控件network_and_internet.xml中   com.android.settings.widget.MasterSwitchPreference】
    private WifiEnabler mWifiEnabler;
    private final WifiSummaryUpdater mSummaryHelper;
    private final MetricsFeatureProvider mMetricsFeatureProvider;


        @Override
    public void displayPreference(PreferenceScreen screen) {
        super.displayPreference(screen);
        mWifiPreference = (MasterSwitchPreference) screen.findPreference(KEY_TOGGLE_WIFI【&quot;toggle_wifi&quot;】);  // 对MasterSwitchPreference 得到实例
    }


        @Override
    public void onStart() {
        mWifiEnabler = new WifiEnabler(mContext, new MasterSwitchController(mWifiPreference),mMetricsFeatureProvider); // 创建WifiEnabler  并添加mWifiPreference 为参数 在WifiEnabler 设置关联监听关系
    }



    /packages/apps/Settings/src/com/android/settings/wifi/WifiEnabler.java
public class WifiEnabler implements SwitchWidgetController.OnSwitchChangeListener  {  // 实现了 SwitchWidgetController.OnSwitchChangeListener  接口

    private final SwitchWidgetController mSwitchWidget;

        WifiEnabler(Context context, SwitchWidgetController switchWidget,
            MetricsFeatureProvider metricsFeatureProvider,
            ConnectivityManagerWrapper connectivityManagerWrapper) {
        mContext = context;
        mSwitchWidget = switchWidget;
        mSwitchWidget.setListener(this); // 实现了监听关系   SwitchWidgetController.setListener(WifiEnabler)

        }


    @Override
    public boolean onSwitchToggled(boolean isChecked) {  //  当前 UA2 的 Switch Click事件的逻辑处理函数 

        // Show toast message if Wi-Fi is not allowed in airplane mode 如果当前处于飞行模式   那么弹框提示
        if (isChecked &amp;&amp; !WirelessUtils.isRadioAllowed(mContext, Settings.Global.RADIO_WIFI)) {
            Toast.makeText(mContext, R.string.wifi_in_airplane_mode, Toast.LENGTH_SHORT).show();
            mSwitchWidget.setChecked(false);
            return false;
        }

        // Disable tethering if enabling Wifi
        if (mayDisableTethering(isChecked)) {  // 如果当前热点打开的   那么关闭当前的热点
            mConnectivityManager.stopTethering(ConnectivityManager.TETHERING_WIFI);
        }
        if (!mWifiManager.setWifiEnabled(isChecked)) { // 调用mWifiManager.setWifiEnabled 打开或者关闭WIFI  ▲1   UA完成后分析Framework时继续往下分析
            // Error
            mSwitchWidget.setEnabled(true);
            Toast.makeText(mContext, R.string.wifi_error, Toast.LENGTH_SHORT).show();
        }
        return true;
    }
</code></pre><h2 id="wifi-ua3-">WIFI UA3分析</h2>
<h3 id="wifi-ua3-">WIFI UA3 操作列</h3>
<p><img src="img/2.png" width = "25%" height="25%"/></p>
<ol>
<li><strong>UA编号</strong>   UA3</li><li><strong>UA说明</strong>  <strong> WIFI功能开关</strong></li><li><p><strong>UA触发函数</strong>  **在network_and_internet.xml布局文件的Preference指定了Swith开关对应的类 MasterSwitchPreference.java文件中定义的onclick函数<br>业务处理函数为：  /packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java<br>public class WifiSettings extends RestrictedSettingsFragment 中设置处理函数</p>
<pre><code>          &lt;activity android:name=&quot;Settings$WifiSettingsActivity&quot;   WIFI的设置界面WifiSettingsActivity在 AndroidManifest.xml 声明
             android:taskAffinity=&quot;&quot;
             android:label=&quot;@string/wifi_settings&quot;
             android:configChanges=&quot;orientation|keyboardHidden|screenSize&quot;&gt;
         &lt;intent-filter&gt;
             &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;
             &lt;action android:name=&quot;android.settings.WIFI_SETTINGS&quot; /&gt;
             &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;
             &lt;category android:name=&quot;android.intent.category.VOICE_LAUNCH&quot; /&gt;
             &lt;category android:name=&quot;com.android.settings.SHORTCUT&quot; /&gt;
         &lt;/intent-filter&gt;
         &lt;meta-data android:name=&quot;com.android.settings.FRAGMENT_CLASS&quot;
             android:value=&quot;com.android.settings.wifi.WifiSettings&quot; /&gt;  // 指定了加载该Activity显示的Fragment &quot;com.android.settings.wifi.WifiSettings&quot; Fragment类
         &lt;meta-data android:name=&quot;com.android.settings.TOP_LEVEL_HEADER_ID&quot;
             android:resource=&quot;@id/wifi_settings&quot; /&gt;
     &lt;/activity&gt;
</code></pre></li><li><strong>UA字符可选值</strong>    1.switch开启     2.switch关闭    </li><li><strong>UA布局及ID</strong>      WifiSettings(Fragment)的布局文件 R.xml.wifi_settings.xml</li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong> </li><li><strong>数据库可选值 </strong> </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>  </li><li><strong>UA触发函数所在类</strong>   在WifiSettings(Fragment)中创建了新的     new WifiEnabler(activity, new SwitchBarController(activity.getSwitchBar()),mMetricsFeatureProvider);<br>这个WifiEnabler 的onSwitchToggled() 函数是当前页面activity.getSwitchBar()的点击响应事件   同UA2 </li></ol>
<hr>
<h3 id="wifi-ua3-">WIFI UA3 代码分析</h3>
<pre><code> /packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
    @Override
    public void onCreate(Bundle icicle) {
        addPreferencesFromResource(R.xml.wifi_settings);  // 当前WIFI设置界面的布局文件
        }


WIFI开关关闭时 显示的字符串
&lt;string name=&quot;wifi_empty_list_wifi_off&quot; msgid=&quot;8056223875951079463&quot;&gt;&quot;要查看可用网络，请打开 WLAN。&quot;&lt;/string&gt;
&lt;string name=&quot;wifi_scan_notify_text&quot;&gt;
&quot;为了提高位置信息的精确度，系统应用和服务仍然会扫描 WLAN 网络。您可以在&lt;xliff:g id=&quot;LINK_BEGIN_0&quot;&gt;LINK_BEGIN&lt;/xliff:g&gt;扫描设置&lt;xliff:g id=&quot;LINK_END_1&quot;&gt;LINK_END&lt;/xliff:g&gt;中更改此设置。&quot;&lt;/string&gt;

&lt;string name=&quot;wifi_scan_notify_text_scanning_off&quot; msgid=&quot;3426075479272242098&quot;&gt;
&quot;要提高位置信息的精确度，请在&lt;xliff:g id=&quot;LINK_BEGIN_0&quot;&gt;LINK_BEGIN&lt;/xliff:g&gt;扫描设置&lt;xliff:g id=&quot;LINK_END_1&quot;&gt;LINK_END&lt;/xliff:g&gt;中开启 WLAN 扫描功能。&quot;
&lt;/string&gt;


    @Override
    public void onWifiStateChanged(int state) {
    final int wifiState = mWifiManager.getWifiState();
    .....
            case WifiManager.WIFI_STATE_DISABLED:  //  如果当前WIFI是关闭的话
                setOffMessage();  // 显示 关闭字符串
                setProgressBarVisible(false);
                break;
        }
    }

  private void setOffMessage() {
final CharSequence title = getText(R.string.wifi_empty_list_wifi_off);
final CharSequence description = wifiScanningMode ? getText(R.string.wifi_scan_notify_text) : getText(R.string.wifi_scan_notify_text_scanning_off);

        final LinkifyUtils.OnClickListener clickListener = new LinkifyUtils.OnClickListener() {
            @Override
            public void onClick() {
                final SettingsActivity activity = (SettingsActivity) getActivity();
                activity.startPreferencePanel(WifiSettings.this,
                        ScanningSettings.class.getName(),
                        null, R.string.location_scanning_screen_title, null, null, 0);
            }
        };
mStatusMessagePreference.setText(title, description, clickListener);  // 设置WIFI开关关闭时 显示的字符串   简要信息和  蓝色链接字点击事件  LinkifyUtils.OnClickListener clickListener 


}




     /packages/apps/Settings/src/com/android/settings/wifi/WifiEnabler.java
     @Override
    public boolean onSwitchToggled(boolean isChecked) {  //  当前 UA2 的 Switch Click事件的逻辑处理函数 

        // Show toast message if Wi-Fi is not allowed in airplane mode 如果当前处于飞行模式   那么弹框提示
        if (isChecked &amp;&amp; !WirelessUtils.isRadioAllowed(mContext, Settings.Global.RADIO_WIFI)) {
            Toast.makeText(mContext, R.string.wifi_in_airplane_mode, Toast.LENGTH_SHORT).show();
            mSwitchWidget.setChecked(false);
            return false;
        }

        // Disable tethering if enabling Wifi
        if (mayDisableTethering(isChecked)) {  // 如果当前热点打开的   那么关闭当前的热点
            mConnectivityManager.stopTethering(ConnectivityManager.TETHERING_WIFI);
        }
        if (!mWifiManager.setWifiEnabled(isChecked)) { // 调用mWifiManager.setWifiEnabled 打开或者关闭WIFI  ▲1   UA完成后分析Framework时继续往下分析
            // Error
            mSwitchWidget.setEnabled(true);
            Toast.makeText(mContext, R.string.wifi_error, Toast.LENGTH_SHORT).show();
        }
        return true;
    }
</code></pre><h3 id="wifi-ua3-">WIFI UA3 布局分析</h3>
<p>R.xml.wifi_settings.xml 布局文件</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

&lt;PreferenceScreen
        xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
        xmlns:settings=&quot;http://schemas.android.com/apk/res/com.android.settings&quot;
        android:title=&quot;@string/wifi_settings&quot;  // values-zh-rCN/  &lt;string name=&quot;wifi_settings&quot; msgid=&quot;29722149822540994&quot;&gt;&quot;WLAN&quot;&lt;/string&gt;
        settings:keywords=&quot;@string/keywords_wifi&quot;&gt;

    &lt;PreferenceCategory android:key=&quot;connected_access_point&quot; /&gt;  // 当前已连接的热点显示的Preference 

    &lt;PreferenceCategory android:key=&quot;access_points&quot;/&gt;  // 当前手机扫描到的热点的列表

    &lt;PreferenceCategory android:key=&quot;additional_settings&quot;&gt; // 添加网络 Preference Item
        &lt;Preference
                android:key=&quot;configure_settings&quot;  // &lt;string name=&quot;wifi_configure_settings_preference_title&quot; &gt;&quot;WLAN 偏好设置&quot;&lt;/string&gt;   WLAN偏好设置选项
                android:title=&quot;@string/wifi_configure_settings_preference_title&quot;
                android:fragment=&quot;com.android.settings.wifi.ConfigureWifiSettings&quot; /&gt;  // 偏好设置选项显示的Fragment   ConfigureWifiSettings

        &lt;Preference
                android:key=&quot;saved_networks&quot;      // &lt;string name=&quot;wifi_saved_access_points_label&quot;&gt;&quot;已保存的网络&quot;&lt;/string&gt; 
                android:title=&quot;@string/wifi_saved_access_points_label&quot;
                android:fragment=&quot;com.android.settings.wifi.SavedAccessPointsWifiSettings&quot; /&gt;  // 已保存的网络显示的Fragment   SavedAccessPointsWifiSettings
    &lt;/PreferenceCategory&gt; 
&lt;/PreferenceScreen&gt;


WIFI开关关闭时 显示的字符串
&lt;string name=&quot;wifi_empty_list_wifi_off&quot; msgid=&quot;8056223875951079463&quot;&gt;&quot;要查看可用网络，请打开 WLAN。&quot;&lt;/string&gt;
&lt;string name=&quot;wifi_scan_notify_text&quot;&gt;
&quot;为了提高位置信息的精确度，系统应用和服务仍然会扫描 WLAN 网络。您可以在&lt;xliff:g id=&quot;LINK_BEGIN_0&quot;&gt;LINK_BEGIN&lt;/xliff:g&gt;扫描设置&lt;xliff:g id=&quot;LINK_END_1&quot;&gt;LINK_END&lt;/xliff:g&gt;中更改此设置。&quot;&lt;/string&gt;

&lt;string name=&quot;wifi_scan_notify_text_scanning_off&quot; msgid=&quot;3426075479272242098&quot;&gt;
&quot;要提高位置信息的精确度，请在&lt;xliff:g id=&quot;LINK_BEGIN_0&quot;&gt;LINK_BEGIN&lt;/xliff:g&gt;扫描设置&lt;xliff:g id=&quot;LINK_END_1&quot;&gt;LINK_END&lt;/xliff:g&gt;中开启 WLAN 扫描功能。&quot;
&lt;/string&gt;
</code></pre><h2 id="wifi-ua4-">WIFI UA4分析</h2>
<h3 id="wifi-ua4-">WIFI UA4 操作列</h3>
<p><img src="img/2.png" width = "25%" height="25%"/> </p>
<ol>
<li><strong>UA编号</strong>   UA4</li><li><strong>UA说明</strong>  <strong>扫描设置入口</strong></li><li><p><strong>UA触发函数</strong>   在  /packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 的 final LinkifyUtils.OnClickListener clickListener 函数进行响应</p>
<pre><code>  private void setOffMessage() {
  final CharSequence title = getText(R.string.wifi_empty_list_wifi_off);
  final CharSequence description = wifiScanningMode ? getText(R.string.wifi_scan_notify_text) : getText(R.string.wifi_scan_notify_text_scanning_off);

     final LinkifyUtils.OnClickListener clickListener = new LinkifyUtils.OnClickListener() {
         @Override
         public void onClick() {
             final SettingsActivity activity = (SettingsActivity) getActivity();
             activity.startPreferencePanel(WifiSettings.this,
                     ScanningSettings.class.getName(),   // 启动另一个 /packages/apps/Settings/src/com/android/settings/location/ScanningSettings.java  Fragment类
                                                         // public class ScanningSettings extends SettingsPreferenceFragment {
                     null, R.string.location_scanning_screen_title, null, null, 0);
         }
     };
     mStatusMessagePreference.setText(title, description, clickListener);  // 设置WIFI开关关闭时 显示的字符串   简要信息和  蓝色链接字点击事件  LinkifyUtils.OnClickListener clickListener 
    }
</code></pre></li><li><strong>UA字符可选值</strong>    <pre><code> &lt;string name=&quot;wifi_scan_notify_text&quot;&gt;
 &quot;为了提高位置信息的精确度，系统应用和服务仍然会扫描 WLAN 网络。您可以在&lt;xliff:g id=&quot;LINK_BEGIN_0&quot;&gt;LINK_BEGIN&lt;/xliff:g&gt;扫描设置&lt;xliff:g id=&quot;LINK_END_1&quot;&gt;LINK_END&lt;/xliff:g&gt;中更改此设置。&quot;
 &lt;/string&gt;
</code></pre></li><li><strong>UA布局及ID</strong>      WifiSettings(Fragment)的布局文件 R.xml.wifi_settings.xml</li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong> </li><li><strong>数据库可选值 </strong> </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>   ScanningSettings extends SettingsPreferenceFragment </li><li><strong>UA触发函数所在类</strong>   在WifiSettings(Fragment)中的  LinkifyUtils.OnClickListener</li></ol>
<hr>
<h2 id="wifi-ua5-">WIFI UA5分析</h2>
<h3 id="wifi-ua5-">WIFI UA5 操作列</h3>
<p><img src="img/2.png" width = "25%" height="25%"/></p>
<ol>
<li><strong>UA编号</strong>   UA5</li><li><strong>UA说明</strong>  <strong>WIFI票号设置入口</strong></li><li><p><strong>UA触发函数</strong>   在  /packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 的 布局文件存在指定fragment  ConfigureWifiSettings</p>
<pre><code> /packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
Preference  mConfigureWifiSettingsPreference = findPreference(PREF_KEY_CONFIGURE_WIFI_SETTINGS【&quot;configure_settings&quot;】); // findPreference 函数
   /frameworks/support/v14/preference/src/android/support/v14/preference/PreferenceFragment.java
@Override
public Preference findPreference(CharSequence key) {
 if (mPreferenceManager == null) {
     return null;
 }
 return mPreferenceManager.findPreference(key);
 }
 //R.xml.wifi_settings.xml 中 Preference 布局
 &lt;Preference
         android:key=&quot;configure_settings&quot;
         android:title=&quot;@string/wifi_configure_settings_preference_title&quot;
         android:fragment=&quot;com.android.settings.wifi.ConfigureWifiSettings&quot; /&gt;
</code></pre></li><li><p><strong>UA字符可选值</strong>    </p>
<pre><code> &lt;string name=&quot;wifi_scan_notify_text&quot;&gt;
 &quot;为了提高位置信息的精确度，系统应用和服务仍然会扫描 WLAN 网络。您可以在&lt;xliff:g id=&quot;LINK_BEGIN_0&quot;&gt;LINK_BEGIN&lt;/xliff:g&gt;扫描设置&lt;xliff:g id=&quot;LINK_END_1&quot;&gt;LINK_END&lt;/xliff:g&gt;中更改此设置。&quot;
 &lt;/string&gt;
</code></pre></li><li><strong>UA布局及ID</strong>      WifiSettings(Fragment)的布局文件 R.xml.wifi_settings.xml 中的  &lt;Preference  android:key=&quot;configure_settings&quot;</li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong> </li><li><strong>数据库可选值 </strong> </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>   ScanningSettings extends SettingsPreferenceFragment </li><li><strong>UA触发函数所在类</strong>   在WifiSettings(Fragment)中的  &lt;Preference   android:key=&quot;configure_settings&quot;   android:fragment=&quot;com.android.settings.wifi.ConfigureWifiSettings&quot; 指定</li></ol>
<hr>
<h2 id="wifi-ua6-">WIFI UA6分析</h2>
<h3 id="wifi-ua6-">WIFI UA6 操作列</h3>
<p><img src="img/3.png" width = "25%" height="25%"/>   <img src="img/4.png" width = "25%" height="25%"/></p>
<ol>
<li><strong>UA编号</strong>   UA6</li><li><strong>UA说明</strong>  <strong>显示WLAN弹出消息 Switch开关</strong></li><li><p><strong>UA触发函数</strong>   在  /packages/apps/Settings/src/com/android/settings/wifi/ConfigureWifiSettings.java  的 布局文件存在指定fragment  ConfigureWifiSettings</p>
<pre><code> /packages/apps/Settings/src/com/android/settings/wifi/ConfigureWifiSettings.java
  public class ConfigureWifiSettings extends DashboardFragment {
        private UseOpenWifiPreferenceController mUseOpenWifiPreferenceController; //显示WLAN弹出消息 开关
   //
     protected int getPreferenceScreenResId() {
         return R.xml.wifi_configure_settings; // 当前ConfigureWifiSettings 这个Fragment的布局文件
     }
    //
   protected List&lt;PreferenceController&gt; getPreferenceControllers(Context context) {
    final NetworkScoreManagerWrapper networkScoreManagerWrapper = new NetworkScoreManagerWrapper(context.getSystemService(NetworkScoreManager.class));
   mUseOpenWifiPreferenceController = new UseOpenWifiPreferenceController(context, this,networkScoreManagerWrapper, getLifecycle()); // 创建 显示WLAN弹出消息的 ViewController
    final List&lt;PreferenceController&gt; controllers = new ArrayList&lt;&gt;();

   controllers.add(new NotifyOpenNetworksPreferenceController(context, getLifecycle())); 
   }
     //////////////////
   /packages/apps/Settings/src/com/android/settings/wifi/NotifyOpenNetworksPreferenceController.java 
   public class NotifyOpenNetworksPreferenceController extends PreferenceController implements
   LifecycleObserver, OnResume, OnPause {

 private static final String KEY_NOTIFY_OPEN_NETWORKS = &quot;notify_open_networks&quot;; //有可用WIFI时通知

     @Override
 public boolean handlePreferenceTreeClick(Preference preference) {  // 当Preference被点击时触发的函数
 if (!TextUtils.equals(preference.getKey(), KEY_NOTIFY_OPEN_NETWORKS)) {
     return false;
 }
 if (!(preference instanceof SwitchPreference)) {
     return false;
 }
 Settings.Global.putInt(mContext.getContentResolver(), // 把设置数据库中的&quot;wifi_networks_available_notification_on&quot;依据switch状态进行改变
         Settings.Global.WIFI_NETWORKS_AVAILABLE_NOTIFICATION_ON 【&quot;wifi_networks_available_notification_on&quot;】,
         ((SwitchPreference) preference).isChecked() ? 1 : 0);
 return true;
}
</code></pre></li><li><p><strong>UA字符可选值</strong>    </p>
</li><li><strong>UA布局及ID</strong>      WifiSettings(Fragment)的布局文件 R.xml.wifi_settings.xml 中的  &lt;Preference  android:key=&quot;configure_settings&quot;</li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>  &quot;wifi_networks_available_notification_on&quot;</li><li><strong>数据库可选值 </strong>   0关闭   1打开   </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>   ConfigureWifiSettings extends SettingsPreferenceFragment </li><li><strong>UA触发函数所在类</strong>   在 ConfigureWifiSettings (Fragment)中的  &lt;SwitchPreference   android:key=&quot;notify_open_networks&quot;   指定</li></ol>
<hr>
<h3 id="wifi-ua6-">WIFI UA6 布局分析</h3>
<pre><code>R.xml.wifi_configure_settings
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

&lt;PreferenceScreen
        xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
        xmlns:settings=&quot;http://schemas.android.com/apk/res/com.android.settings&quot;
        android:title=&quot;@string/wifi_configure_titlebar&quot;&gt;

    &lt;SwitchPreference
            android:key=&quot;enable_wifi_wakeup&quot; 
            android:title=&quot;@string/wifi_wakeup&quot; // &lt;string name=&quot;wifi_wakeup&quot; &gt;&quot;自动开启 WLAN&quot;&lt;/string&gt;
            android:icon=&quot;@drawable/ic_auto_wifi&quot;
            android:summary=&quot;@string/wifi_wakeup_summary&quot; /&gt;

    &lt;SwitchPreference
        android:key=&quot;use_open_wifi_automatically&quot;
        android:icon=&quot;@drawable/ic_open_wifi_autoconnect&quot; 
        android:title=&quot;@string/use_open_wifi_automatically_title&quot; // &lt;string name=&quot;use_open_wifi_automatically_title&quot; &gt;&quot;连接到开放网络&quot;&lt;/string&gt;
        android:summary=&quot;@string/use_open_wifi_automatically_summary&quot; /&gt; // &lt;string name=&quot;use_open_wifi_automatically_summary&quot;&gt;&quot;自动连接到高品质的公共网络&quot;&lt;/string&gt;

    &lt;SwitchPreference
            android:key=&quot;notify_open_networks&quot;
            android:title=&quot;@string/wifi_notify_open_networks&quot;  // &lt;string name=&quot;wifi_notify_open_networks&quot; msgid=&quot;76298880708051981&quot;&gt;&quot;打开网络通知&quot;&lt;/string&gt;
            android:icon=&quot;@drawable/ic_open_wifi_notifications&quot;
            android:summary=&quot;@string/wifi_notify_open_networks_summary&quot; /&gt; //&lt;string name=&quot;wifi_notify_open_networks_summary&quot; &gt;&quot;有可用的高品质公共网络时通知我&quot;&lt;/string&gt;

    &lt;SwitchPreference
        android:key=&quot;wifi_cellular_data_fallback&quot;
        android:title=&quot;@string/wifi_cellular_data_fallback_title&quot;
        android:summary=&quot;@string/wifi_cellular_data_fallback_summary&quot;/&gt;

    &lt;ListPreference
            android:key=&quot;sleep_policy&quot;   // 在安卓8.1中 WIFI的休眠策略被去除  new WifiSleepPolicyPreferenceController(context));类进行处理
            android:title=&quot;@string/wifi_setting_sleep_policy_title&quot;// &lt;string name=&quot;wifi_setting_sleep_policy_title&quot;&gt;&quot;在休眠状态下保持WLAN网络连接&quot;&lt;/string&gt;
            android:entries=&quot;@array/wifi_sleep_policy_entries&quot;
            android:entryValues=&quot;@array/wifi_sleep_policy_values&quot; /&gt;

    &lt;Preference
            android:key=&quot;install_credentials&quot;
            android:title=&quot;@string/wifi_install_credentials&quot;&gt; // &lt;string name=&quot;wifi_install_credentials&quot; &gt;&quot;安装证书&quot;&lt;/string&gt;
        &lt;intent android:action=&quot;android.credentials.INSTALL_AS_USER&quot;
                android:targetPackage=&quot;com.android.certinstaller&quot;
                android:targetClass=&quot;com.android.certinstaller.CertInstallerMain&quot;&gt;
            &lt;extra android:name=&quot;install_as_uid&quot; android:value=&quot;1010&quot;/&gt;
        &lt;/intent&gt;
    &lt;/Preference&gt;

    &lt;Preference
            android:key=&quot;wifi_calling_settings&quot;
            android:title=&quot;@string/wifi_calling_settings_title&quot;
            android:fragment=&quot;com.android.settings.WifiCallingSettings&quot;
            settings:keywords=&quot;@string/keywords_wifi_calling&quot;/&gt;

    &lt;Preference
            android:key=&quot;network_scorer_picker&quot;
            android:title=&quot;@string/network_scorer_picker_title&quot; // &lt;string name=&quot;network_scorer_picker_title&quot;&gt;&quot;网络评分服务提供方&quot;&lt;/string&gt;
            android:fragment=&quot;com.android.settings.network.NetworkScorerPicker&quot;/&gt;

    &lt;Preference
            android:key=&quot;wifi_direct&quot;    //  new WifiP2pPreferenceController(context, getLifecycle(), wifiManager)) 类进行处理
            android:title=&quot;@string/wifi_menu_p2p&quot;&gt; // &lt;string name=&quot;wifi_menu_p2p&quot;&gt;&quot;WLAN直连&quot;&lt;/string&gt;  WLAN直连指定了目标Activity类
        &lt;intent android:targetPackage=&quot;com.android.settings&quot;
                android:targetClass=&quot;com.android.settings.Settings$WifiP2pSettingsActivity&quot;/&gt;
    &lt;/Preference&gt;

    &lt;Preference
            android:key=&quot;wps_push_button&quot;    // new WpsPreferenceController( context, getLifecycle(), wifiManager, getFragmentManager()) 类进行处理
            android:title=&quot;@string/wifi_menu_wps_pbc&quot; /&gt;  // &lt;string name=&quot;wifi_menu_wps_pbc&quot;&gt;&quot;WPS按钮&quot;&lt;/string&gt;

    &lt;Preference
            android:key=&quot;wps_pin_entry&quot;   // new WpsPreferenceController( context, getLifecycle(), wifiManager, getFragmentManager()) 类进行处理
            android:title=&quot;@string/wifi_menu_wps_pin&quot; /&gt;  // &lt;string name=&quot;wifi_menu_wps_pin&quot;&gt;&quot;WPS PIN码输入&quot;&lt;/string&gt;

    &lt;Preference
            android:key=&quot;mac_address&quot;    // new WifiInfoPreferenceController(context, getLifecycle(), wifiManager)); 类进行处理
            android:title=&quot;@string/wifi_advanced_mac_address_title&quot;/&gt;  // &lt;string name=&quot;wifi_advanced_mac_address_title&quot; &gt;&quot;MAC地址&quot;&lt;/string&gt;

    &lt;Preference
            android:key=&quot;current_ip_address&quot;  // new WifiInfoPreferenceController(context, getLifecycle(), wifiManager)); 类进行处理
            android:title=&quot;@string/wifi_advanced_ip_address_title&quot;/&gt; //&lt;string name=&quot;wifi_advanced_ip_address_title&quot;&gt;&quot;IP 地址&quot;&lt;/string&gt;

&lt;/PreferenceScreen&gt;
</code></pre><h2 id="wifi-ua9-">WIFI UA9分析</h2>
<p> <img src="img/4.png" width = "25%" height="25%"/></p>
<h3 id="wifi-ua9-ua6-">WIFI UA9 操作列 (同UA6大致相同)</h3>
<pre><code>R.xml.wifi_configure_settings 中定义了 SwitchPreference   同

new NotifyOpenNetworksPreferenceController(context, getLifecycle() 来完成 SwitchPreference  android:key=&quot;notify_open_networks&quot; 的 点击业务事件


    &lt;SwitchPreference
            android:key=&quot;notify_open_networks&quot;
            android:title=&quot;@string/wifi_notify_open_networks&quot;  // &lt;string name=&quot;wifi_notify_open_networks&quot;&gt;&quot;打开网络通知&quot;&lt;/string&gt;
            android:icon=&quot;@drawable/ic_open_wifi_notifications&quot;
            android:summary=&quot;@string/wifi_notify_open_networks_summary&quot; /&gt; //&lt;string name=&quot;wifi_notify_open_networks_summary&quot; &gt;&quot;有可用的高品质公共网络时通知我&quot;&lt;/string&gt;



            //////////////////
          /packages/apps/Settings/src/com/android/settings/wifi/NotifyOpenNetworksPreferenceController.java 
          public class NotifyOpenNetworksPreferenceController extends PreferenceController implements
          LifecycleObserver, OnResume, OnPause {

        private static final String KEY_NOTIFY_OPEN_NETWORKS = &quot;notify_open_networks&quot;; //有可用WIFI时通知

            @Override
        public boolean handlePreferenceTreeClick(Preference preference) {  // 当Preference被点击时触发的函数
        if (!TextUtils.equals(preference.getKey(), KEY_NOTIFY_OPEN_NETWORKS)) {
            return false;
        }
        if (!(preference instanceof SwitchPreference)) {
            return false;
        }
        Settings.Global.putInt(mContext.getContentResolver(), // 把设置数据库中的&quot;wifi_networks_available_notification_on&quot;依据switch状态进行改变
                Settings.Global.WIFI_NETWORKS_AVAILABLE_NOTIFICATION_ON 【&quot;wifi_networks_available_notification_on&quot;】,
                ((SwitchPreference) preference).isChecked() ? 1 : 0);
        return true;
       }
</code></pre><h2 id="wifi-ua10-">WIFI UA10分析</h2>
<p> <img src="img/4.png" width = "25%" height="25%"/></p>
<h3 id="wifi-ua10-ua6-">WIFI UA10 操作列 (同UA6大致相同)</h3>
<pre><code>R.xml.wifi_configure_settings 中定义了 Preference   同  并指定了目标Class WifiP2pSettingsActivity

    &lt;Preference   
            android:key=&quot;wifi_direct&quot;    //  new WifiP2pPreferenceController(context, getLifecycle(), wifiManager)) 类进行处理
            android:title=&quot;@string/wifi_menu_p2p&quot;&gt; // &lt;string name=&quot;wifi_menu_p2p&quot;&gt;&quot;WLAN直连&quot;&lt;/string&gt;  WLAN直连指定了目标Activity类
        &lt;intent android:targetPackage=&quot;com.android.settings&quot;
                android:targetClass=&quot;com.android.settings.Settings$WifiP2pSettingsActivity&quot;/&gt;
    &lt;/Preference&gt;



public static class WifiP2pSettingsActivity extends SettingsActivity { /* empty */ }


        &lt;activity android:name=&quot;Settings$WifiP2pSettingsActivity&quot;
                android:taskAffinity=&quot;com.android.settings&quot;
                android:parentActivityName=&quot;Settings$WifiSettingsActivity&quot;&gt;
            &lt;intent-filter&gt;
                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;
                &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;
                &lt;category android:name=&quot;android.intent.category.VOICE_LAUNCH&quot; /&gt;
            &lt;/intent-filter&gt;
            &lt;meta-data android:name=&quot;com.android.settings.FRAGMENT_CLASS&quot;
                android:value=&quot;com.android.settings.wifi.p2p.WifiP2pSettings&quot; /&gt;  // WifiP2pSettings extends Fragment  会被展示出来
        &lt;/activity&gt;



/packages/apps/Settings/src/com/android/settings/wifi/p2p/WifiP2pPreferenceController.java

    private void togglePreferences() {
        if (mWifiDirectPref != null) {
            mWifiDirectPref.setEnabled(mWifiManager.isWifiEnabled());  // 当WIFI关闭时  当前的WIFI直连 Preference 不可用
        }
    }
</code></pre><h2 id="wifi-ua12-">WIFI UA12分析</h2>
<p> <img src="img/6.png" width = "25%" height="25%"/></p>
<h3 id="wifi-ua12-ua6-">WIFI UA12 操作列 (同UA6大致相同)</h3>
<pre><code>ScanningSettings (Fragment)
 在  /packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 的 final LinkifyUtils.OnClickListener clickListener 函数是入口

    &lt;string name=&quot;wifi_scan_notify_text&quot;&gt;
    &quot;为了提高位置信息的精确度，系统应用和服务仍然会扫描 WLAN 网络。您可以在&lt;xliff:g id=&quot;LINK_BEGIN_0&quot;&gt;LINK_BEGIN&lt;/xliff:g&gt;扫描设置&lt;xliff:g id=&quot;LINK_END_1&quot;&gt;LINK_END&lt;/xliff:g&gt;中更改此设置。&quot;
    &lt;/string&gt;

        final LinkifyUtils.OnClickListener clickListener = new LinkifyUtils.OnClickListener() {
            @Override
            public void onClick() {
                final SettingsActivity activity = (SettingsActivity) getActivity();
                activity.startPreferencePanel(WifiSettings.this,   //  进入 ScanningSettings
                        ScanningSettings.class.getName(),
                        null, R.string.location_scanning_screen_title, null, null, 0);
            }
        }




/packages/apps/Settings/src/com/android/settings/location/ScanningSettings.java
public class ScanningSettings extends SettingsPreferenceFragment {
    private static final String KEY_WIFI_SCAN_ALWAYS_AVAILABLE = &quot;wifi_always_scanning&quot;;   //两个Key
    private static final String KEY_BLUETOOTH_SCAN_ALWAYS_AVAILABLE = &quot;bluetooth_always_scanning&quot;;



        @Override  // Switch按钮点击的业务处理
    public boolean onPreferenceTreeClick(Preference preference) {  // 设置 &quot;wifi_always_scanning&quot;   和 &quot;bluetooth_always_scanning&quot; 在设置数据库中的值
        String key = preference.getKey();
        if (KEY_WIFI_SCAN_ALWAYS_AVAILABLE.equals(key)) {
            Global.putInt(getContentResolver(), Global.WIFI_SCAN_ALWAYS_AVAILABLE, ((SwitchPreference) preference).isChecked() ? 1 : 0);
        } else if (KEY_BLUETOOTH_SCAN_ALWAYS_AVAILABLE.equals(key)) {
            Global.putInt(getContentResolver(), Global.BLE_SCAN_ALWAYS_AVAILABLE, ((SwitchPreference) preference).isChecked() ? 1 : 0);
        } else {
            return super.onPreferenceTreeClick(preference);
        }
        return true;
    }


    }
</code></pre><h3 id="wifi-ua12-">WIFI UA12 布局分析</h3>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

&lt;PreferenceScreen xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
        android:title=&quot;@string/location_scanning_screen_title&quot;
        android:key=&quot;scanning_screen&quot;&gt;

        &lt;SwitchPreference
            android:title=&quot;@string/location_scanning_wifi_always_scanning_title&quot;  // &lt;string name=&quot;location_scanning_wifi_always_scanning_title&quot; &gt;&quot;WLAN 扫描&quot;&lt;/string&gt;
            android:summary=&quot;@string/location_scanning_wifi_always_scanning_description&quot;
            //&lt;string name=&quot;location_scanning_wifi_always_scanning_description&quot; &gt;&quot;允许系统应用和服务随时检测 WLAN 网络，以便提高位置信息的精确度。&quot;&lt;/string&gt;
            android:defaultValue=&quot;true&quot;
            android:key=&quot;wifi_always_scanning&quot; /&gt;


//&lt;string name=&quot;location_scanning_bluetooth_always_scanning_description&quot; &gt;&quot;允许系统应用和服务随时检测蓝牙设备，以便提高位置信息的精确度。&quot;&lt;/string&gt;
        &lt;SwitchPreference  // &lt;string name=&quot;location_scanning_bluetooth_always_scanning_title&quot; &gt;&quot;蓝牙扫描&quot;&lt;/string&gt;
            android:title=&quot;@string/location_scanning_bluetooth_always_scanning_title&quot;
            android:summary=&quot;@string/location_scanning_bluetooth_always_scanning_description&quot;
            android:defaultValue=&quot;true&quot;
            android:key=&quot;bluetooth_always_scanning&quot; /&gt;

&lt;/PreferenceScreen&gt;
</code></pre><h2 id="wifi-ua13-">WIFI UA13分析</h2>
<h3 id="wifi-ua13-">WIFI UA13 操作列</h3>
<p><img src="img/7.png" width = "25%" height="25%"/> </p>
<ol>
<li><strong>UA编号</strong>   UA13</li><li><strong>UA说明</strong>  <strong>当前已连接网络Preference的点击事件</strong></li><li><strong>UA触发函数</strong>   在  /packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java函数 addConnectedAccessPointPreference<br>pref.setFragment(WifiNetworkDetailsFragment.class.getName());设置了当前Preference 点击是 显示的 Fragment    WifiSettings的onPreferenceTreeClick 为点击响应函数</li><li><strong>UA字符可选值</strong>    </li><li><strong>UA布局及ID</strong>     LongPressAccessPointPreference 的布局    private int mLayoutResId = com.android.internal.R.layout.preference;/frameworks/base/core/res/res/layout/preference.xml</li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>  </li><li><strong>数据库可选值 </strong>   </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>    WifiNetworkDetailsFragment </li><li><strong>UA触发函数所在类</strong>    WifiNetworkDetailsFragment</li></ol>
<hr>
<h3 id="wifi-ua13-">WIFI UA13 代码分析</h3>
<pre><code> /packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 

 public class WifiSettings extends RestrictedSettingsFragment implements Indexable, WifiTracker.WifiListener, AccessPointListener, WifiDialog.WifiDialogListener {

private static final String PREF_KEY_CONNECTED_ACCESS_POINTS = &quot;connected_access_point&quot;;
private PreferenceCategory  mConnectedAccessPointPreferenceCategory；
private PreferenceCategory mAccessPointsPreferenceCategory;
private LinkablePreference mStatusMessagePreference; // 用来显示提示 显示  要查看可用网络，请打开WLAN   或者  正在搜索WLAN网络...   等一些提示信息的 Preference


  @Override
    public void onCreate(Bundle icicle) {
        addPreferencesFromResource(R.xml.wifi_settings);
         // 实例化mConnectedAccessPointPreferenceCategory 已连接WIFI热点 PreferenceCategory
            mConnectedAccessPointPreferenceCategory =  (PreferenceCategory) findPreference(PREF_KEY_CONNECTED_ACCESS_POINTS);


        Context prefContext = getPrefContext();
        mAddPreference = new Preference(prefContext);
        mAddPreference.setIcon(R.drawable.ic_menu_add_inset);
        mAddPreference.setTitle(R.string.wifi_add_network);
        mStatusMessagePreference = new LinkablePreference(prefContext);  // 创建实例化   LinkablePreference  mStatusMessagePreference

       }



 /packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 
  @Override
    public boolean onPreferenceTreeClick(Preference preference) {
        // If the preference has a fragment set, open that
        if (preference.getFragment() != null) { 
//  如果当前 从 preference获取的 Fragment 不为 空  那么  调用   super.onPreferenceTreeClick(preference)  
//  connectPref.setFragment(WifiNetworkDetailsFragment.class.getName())  由于此前程序设置了  已连接热点的 Preference 的fragment 为  WifiNetworkDetailsFragment  所以 程序 调用到这里
            preference.setOnPreferenceClickListener(null);
            return super.onPreferenceTreeClick(preference);
        }

        if (preference instanceof LongPressAccessPointPreference) {
            mSelectedAccessPoint = ((LongPressAccessPointPreference) preference).getAccessPoint();
            if (mSelectedAccessPoint == null) {
                return false;
            }
            if (mSelectedAccessPoint.isActive()) {
                return super.onPreferenceTreeClick(preference);
            }
            /**
             * Bypass dialog and connect to unsecured networks, or previously connected saved
             * networks, or Passpoint provided networks.
             */
            WifiConfiguration config = mSelectedAccessPoint.getConfig();
            if (mSelectedAccessPoint.getSecurity() == AccessPoint.SECURITY_NONE) {
                mSelectedAccessPoint.generateOpenNetworkConfig();
                connect(mSelectedAccessPoint.getConfig(), mSelectedAccessPoint.isSaved());
            } else if (mSelectedAccessPoint.isSaved() &amp;&amp; config != null
                    &amp;&amp; config.getNetworkSelectionStatus() != null
                    &amp;&amp; config.getNetworkSelectionStatus().getHasEverConnected()) {
                connect(config, true /* isSavedNetwork */);
            } else if (mSelectedAccessPoint.isPasspoint()) {
                // Access point provided by an installed Passpoint provider, connect using
                // the associated config.
                connect(config, true /* isSavedNetwork */);
            } else {
                showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_CONNECT);
            }
        } else if (preference == mAddPreference) {
            onAddNetworkPressed();
        } else {
            return super.onPreferenceTreeClick(preference);
        }
        return true;
    }

############
/frameworks/base/core/java/android/preference/PreferenceFragment.java    WifiSettings.java  的 爷爷类
    public boolean onPreferenceTreeClick(PreferenceScreen preferenceScreen, Preference preference) {
        if (preference.getFragment() != null &amp;&amp; getActivity() instanceof OnPreferenceStartFragmentCallback) {
            return ((OnPreferenceStartFragmentCallback)getActivity()【SettingsActivity】).onPreferenceStartFragment(this, preference); // 调用 onPreferenceStartFragment
        }
        return false;
    }


/packages/apps/Settings/src/com/android/settings/SettingsActivity.java
public class SettingsActivity extends SettingsDrawerActivity
        implements PreferenceManager.OnPreferenceTreeClickListener,
        PreferenceFragment.OnPreferenceStartFragmentCallback【由于当前的Activity SettingsActivity 实现了  PreferenceFragment.OnPreferenceStartFragmentCallback 接口】,
        // 所以 调用到了 SettingsActivity 方法实现的接口方法 onPreferenceStartFragment
        ButtonBarHandler, FragmentManager.OnBackStackChangedListener {


    @Override
    public boolean onPreferenceStartFragment(PreferenceFragment caller, Preference pref) {
        startPreferencePanel(caller, pref.getFragment(), pref.getExtras(), -1, pref.getTitle(), null, 0);  //
        return true;
    }


    public void startPreferencePanel(Fragment caller, String fragmentClass, Bundle args,int titleRes, CharSequence titleText, Fragment resultTo, int resultRequestCode) {
        String title = null;
        if (titleRes &lt; 0) {
            if (titleText != null) {
                title = titleText.toString();
            } else {
                title = &quot;&quot;;
            }
        }
        // 完成 跳转
        Utils.startWithFragment(this, fragmentClass, args, resultTo, resultRequestCode,titleRes, title, mIsShortcut, mMetricsFeatureProvider.getMetricsCategory(caller));
    }
    }


    /packages/apps/Settings/src/com/android/settings/Utils.java

public static void startWithFragment(Context context, String fragmentName, Bundle args,Fragment resultTo, int resultRequestCode, int titleResId,CharSequence title, int metricsCategory) {
        startWithFragment(context, fragmentName, args, resultTo, resultRequestCode,null /* titleResPackageName */, titleResId, title, false /* not a shortcut */, metricsCategory);
    }


-------------
    private void setOffMessage() {
        mStatusMessagePreference.setText(title, description, clickListener);
        removeConnectedAccessPointPreference();
        mAccessPointsPreferenceCategory.removeAll();
    // 当当前WLAN 不可用时  把 mStatusMessagePreference 放到 mAccessPointsPreferenceCategory中
        mAccessPointsPreferenceCategory.addPreference(mStatusMessagePreference);
    }



        public static void startWithFragment(Context context, String fragmentName, Bundle args,Fragment resultTo, int resultRequestCode, int titleResId, CharSequence title, boolean isShortcut, int metricsCategory) {
        Intent intent = onBuildStartFragmentIntent(context, fragmentName, args, null /* titleResPackageName */, titleResId, title, isShortcut, metricsCategory);
        if (resultTo == null) {
            context.startActivity(intent);  // intent 启动Activity 
        } else {
            resultTo.getActivity().startActivityForResult(intent, resultRequestCode);  // intent 启动Activity 
        }
    }


------------
           private void updateAccessPointPreferences() {


         final List&lt;AccessPoint&gt; accessPoints = mWifiTracker.getAccessPoints();  //从 mWifiTracker 获得AccessPoint ▲2     UA完成后分析Framework时继续往下分析
         boolean hasAvailableAccessPoints = false;
        mAccessPointsPreferenceCategory.removePreference(mStatusMessagePreference); // 把提示信息 LinkablePreference mStatusMessagePreference 移除
        cacheRemoveAllPrefs(mAccessPointsPreferenceCategory);  //  把当前的Preference 缓存到 cache中  然后 填充新的 Prefernce



         // 如果显示已连接WIFI项 那么 index就从1开始 因为index=0 就是已连接的WIFI热点，如果 不显示已连接WIIF网络  那么index=0开始遍历 显示所有的扫描热点 
        int index =configureConnectedAccessPointPreferenceCategory(accessPoints) ? 1 : 0;
        int numAccessPoints = accessPoints.size();
        for (; index &lt; numAccessPoints; index++) {

            AccessPoint accessPoint = accessPoints.get(index);  // 获得对应索引位置的 AccessPoint
            // Ignore access points that are out of range.
            if (accessPoint.isReachable()) {  //  // 当accessPoint的 mRssi 有被赋予正常值时  就表示 当前AccessPoint 可达
                String key = accessPoint.getBssid();  // 获得类似mac地址的 bssid 字符串   private String bssid;
                if (TextUtils.isEmpty(key)) {
                    key = accessPoint.getSsidStr();  // 如果 bssid为空  那么 就获取 热点的 ssid 热点名为 key
                }
                hasAvailableAccessPoints = true;
                // 依据 key 来从 cacheRemoveAllPrefs 方法 填充的  ArrayMap&lt;String, Preference&gt; mPreferenceCache 获取Preference 并强制转换为 LongPressAccessPointPreference  
                LongPressAccessPointPreference pref = (LongPressAccessPointPreference) getCachedPreference(key);
                if (pref != null) {
                    pref.setOrder(index);  // 设置 Preference 的显示位置
                    continue;  // 重新开始  for循环
                }

                // 如果从 cache中取得的 Preference为空  那么 就需要新建 new LongPressAccessPointPreference
                LongPressAccessPointPreference preference = createLongPressActionPointPreference(accessPoint);
                preference.setKey(key);  //  设置 key 索引 
                preference.setOrder(index);  // 设置 显示的位置 索引 
                if (mOpenSsid != null &amp;&amp; mOpenSsid.equals(accessPoint.getSsidStr())
                        &amp;&amp; !accessPoint.isSaved()
                        &amp;&amp; accessPoint.getSecurity() != AccessPoint.SECURITY_NONE) {  // mOpenSsid 保存的是已连接网络的 ssid
                    onPreferenceTreeClick(preference);  // 如果当前的preference 就是 需要连接的网络  那么 触发 onPreferenceTreeClick 事件 进行连接
                    mOpenSsid = null;
                }
                mAccessPointsPreferenceCategory.addPreference(preference);  // 把该 LongPressAccessPointPreference 添加到  mAccessPointsPreferenceCategory
                accessPoint.setListener(WifiSettings.this);  // accessPoint添加监听类为 WifiSettings
                preference.refresh();
            }  //   if (accessPoint.isReachable())----end
        }  // for end
        removeCachedPrefs(mAccessPointsPreferenceCategory);  //   把 ArrayMap&lt;String, Preference&gt; mPreferenceCache; 置空 mPreferenceCache = null;
        mAddPreference.setOrder(index); 
        mAccessPointsPreferenceCategory.addPreference(mAddPreference); // for循环 结束后 添加 mAddPreference 这个  添加 网络的 mPreference
        setAdditionalSettingsSummaries();

        if (!hasAvailableAccessPoints) {  //如果 没有搜索到 任何  可达 的 AccessPoint 那么 就显示 正在搜索WLAN网络… 
            setProgressBarVisible(true);
            Preference pref = new Preference(getPrefContext());
            pref.setSelectable(false);
            pref.setSummary(R.string.wifi_empty_list_wifi_on); // &lt;string name=&quot;wifi_empty_list_wifi_on&quot; &gt;&quot;正在搜索WLAN网络…&quot;&lt;/string&gt;
            pref.setOrder(index++);
            pref.setKey(PREF_KEY_EMPTY_WIFI_LIST);
            mAccessPointsPreferenceCategory.addPreference(pref);
        } else {
            // Continuing showing progress bar for an additional delay to overlap with animation
            getView().postDelayed(mHideProgressBarRunnable, 1700 /* delay millis */);  // 有搜索到WIFI 那么就一直显示 ProgressBar动画   间隔 1.7秒
        }
    }

 ##############
 /frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPoint.java
     public static final int UNREACHABLE_RSSI = Integer.MIN_VALUE;
     private int mRssi = UNREACHABLE_RSSI;

     public boolean isReachable() {
        return mRssi != UNREACHABLE_RSSI; // 当mRssi 有被赋予正常值时  就表示 当前AccessPoint 可达
    }
    }

    AccessPointListener mAccessPointListener;

        public void setListener(AccessPointListener listener) {
        mAccessPointListener = listener;
    }


    public interface AccessPointListener {
        void onAccessPointChanged(AccessPoint accessPoint);
        void onLevelChanged(AccessPoint accessPoint);
    }

 ##############
/packages/apps/Settings/src/com/android/settings/SettingsPreferenceFragment.java    

 private ArrayMap&lt;String, Preference&gt; mPreferenceCache;

     protected void cacheRemoveAllPrefs(PreferenceGroup group) {
        mPreferenceCache = new ArrayMap&lt;String, Preference&gt;();
        final int N = group.getPreferenceCount();
        for (int i = 0; i &lt; N; i++) {
            Preference p = group.getPreference(i);
            if (TextUtils.isEmpty(p.getKey())) {
                continue;
            }
            mPreferenceCache.put(p.getKey(), p);
        }
    }


     protected void removeCachedPrefs(PreferenceGroup group) {
        for (Preference p : mPreferenceCache.values()) {
            group.removePreference(p);
        }
        mPreferenceCache = null;
    }

 ##############
 /packages/apps/Settings/src/com/android/settings/SettingsPreferenceFragment.java  
  private ArrayMap&lt;String, Preference&gt; mPreferenceCache;

    protected Preference getCachedPreference(String key) {
        return mPreferenceCache != null ? mPreferenceCache.remove(key) : null;  // 依据之前的 cacheRemoveAllPrefs() 方法 填充了 mPreferenceCache， 现在从这个cache 取出对应的 Preference
    }


 ##############
  /packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
        private LongPressAccessPointPreference createLongPressActionPointPreference( AccessPoint accessPoint) {
        return new LongPressAccessPointPreference(accessPoint, getPrefContext(), mUserBadgeCache,false, R.drawable.ic_wifi_signal_0, this);
    }


----------------
/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java

     // Configure the ConnectedAccessPointPreferenceCategory and return true if the Category was shown.
     //配置当前已连接的热点  如果函数 configureConnectedAccessPointPreferenceCategory() 返回为true  那么就显示 mConnectedAccessPointPreferenceCategory 这个以连接 PreferenceCategory
     // 如果 返回为 false 那么就不显示已连接 WIFI 这个 PreferenceCategory
    private boolean configureConnectedAccessPointPreferenceCategory( List&lt;AccessPoint&gt; accessPoints) {
        if (accessPoints.size() == 0) {  // 如果List&lt;AccessPoint&gt; accessPoints 大小为0  说明 没有搜到WIFI网络 也就没有已连接网络
            removeConnectedAccessPointPreference();  // 去除 mConnectedAccessPointPreferenceCategory.removeAll();  并设置为不可见
            return false;
        }

        AccessPoint connectedAp = accessPoints.get(0);   // 获取排序第一的  index=0 的那么热点 AccessPoint   
        if (!connectedAp.isActive()) {  // 如果该热点不是isActive 不是可用  那么 也去掉mConnectedAccessPointPreferenceCategory显示 
            removeConnectedAccessPointPreference();
            return false;
        }

        // Is the preference category empty?
        if (mConnectedAccessPointPreferenceCategory.getPreferenceCount() == 0) { // 如果当前 mConnectedAccessPointPreferenceCategory 没有 Preference 那么就添加 当前的 Preference 返回 true
            addConnectedAccessPointPreference(connectedAp);  // 新建 当前已连接的  LongPressAccessPointPreference
            return true;
        }

        // Is the previous currently connected SSID different from the new one?
        if (!((AccessPointPreference)
                mConnectedAccessPointPreferenceCategory.getPreference(0))
                        .getAccessPoint().getSsidStr().equals(
                                connectedAp.getSsidStr())) {  // 如果当前mConnectedAccessPointPreferenceCategory已经有了prefernce 那么需要对比  把旧的移除 添加新的
            removeConnectedAccessPointPreference();  
            addConnectedAccessPointPreference(connectedAp);
            return true;
        }

        // Else same AP is connected, simply refresh the connected access point preference
        // (first and only access point in this category).
        ((LongPressAccessPointPreference) mConnectedAccessPointPreferenceCategory.getPreference(0))
                .refresh();
        return true;
    }

}

###########
/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
    private void removeConnectedAccessPointPreference() {
        mConnectedAccessPointPreferenceCategory.removeAll();
        mConnectedAccessPointPreferenceCategory.setVisible(false);
    }



    private void addConnectedAccessPointPreference(AccessPoint connectedAp) {
        String key = connectedAp.getBssid();
        LongPressAccessPointPreference pref = (LongPressAccessPointPreference)getCachedPreference(key); // 从cache 获取 LongPressAccessPointPreference
        if (pref == null) {
            pref = createLongPressActionPointPreference(connectedAp); // 如果cache为空 那么 new  LongPressActionPointPreference
        }

        // Save the state of the current access point in the bundle so that we can restore it
        // in the Wifi Network Details Fragment
        pref.getAccessPoint().saveWifiState(pref.getExtras());
        pref.setFragment(WifiNetworkDetailsFragment.class.getName());  // 设置当前 Preference的 目标 Fragment 是 WifiNetworkDetailsFragment.class.getName()
        pref.refresh();

        mConnectedAccessPointPreferenceCategory.addPreference(pref);  // 添加 当前已连接WIFI 的 Preference 到 mConnectedAccessPointPreferenceCategory
        mConnectedAccessPointPreferenceCategory.setVisible(true); // 设置  当前已连接WIFI 可见 
    }


#############
/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPoint.java

 private NetworkInfo mNetworkInfo;
 private int networkId = WifiConfiguration.INVALID_NETWORK_ID【-1】;

    public boolean isActive() {
        return mNetworkInfo != null &amp;&amp;
                (networkId != WifiConfiguration.INVALID_NETWORK_ID ||
                 mNetworkInfo.getState() != State.DISCONNECTED);
    }


    public void saveWifiState(Bundle savedState) {
        if (ssid != null) savedState.putString(KEY_SSID, getSsidStr());
        savedState.putInt(KEY_SECURITY, security);
        savedState.putInt(KEY_PSKTYPE, pskType);
        if (mConfig != null) savedState.putParcelable(KEY_CONFIG, mConfig);
        savedState.putParcelable(KEY_WIFIINFO, mInfo);
        evictOldScanResults();
        savedState.putParcelableArrayList(KEY_SCANRESULTCACHE,
                new ArrayList&lt;ScanResult&gt;(mScanResultCache.values()));
        if (mNetworkInfo != null) {
            savedState.putParcelable(KEY_NETWORKINFO, mNetworkInfo);
        }
        if (mFqdn != null) {
            savedState.putString(KEY_FQDN, mFqdn);
        }
        if (mProviderFriendlyName != null) {
            savedState.putString(KEY_PROVIDER_FRIENDLY_NAME, mProviderFriendlyName);
        }
    }



------------------
UA13 的  LongPressAccessPointPreference 
/packages/apps/Settings/src/com/android/settings/wifi/LongPressAccessPointPreference.java
public class LongPressAccessPointPreference extends AccessPointPreference {

    private final Fragment mFragment;

        public void onBindViewHolder(final PreferenceViewHolder view) {
        super.onBindViewHolder(view);
        if (mFragment != null) {
            view.itemView.setOnCreateContextMenuListener(mFragment);
            view.itemView.setTag(this);
            view.itemView.setLongClickable(true);
        }
    }
}



/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPointPreference.java

public class AccessPointPreference extends Preference {

    &lt;string name=&quot;accessibility_wifi_one_bar&quot;&gt;&quot;WLAN 信号强度为一格。&quot;&lt;/string&gt;
    &lt;string name=&quot;accessibility_wifi_two_bars&quot; &gt;&quot;WLAN 信号强度为两格。&quot;&lt;/string&gt;
    &lt;string name=&quot;accessibility_wifi_three_bars&quot; &gt;&quot;WLAN 信号强度为三格。&quot;&lt;/string&gt;
    &lt;string name=&quot;accessibility_wifi_signal_full&quot; &gt;&quot;WLAN 信号满格。&quot;&lt;/string&gt;

    static final int[] WIFI_CONNECTION_STRENGTH = {
            R.string.accessibility_wifi_one_bar,
            R.string.accessibility_wifi_two_bars,
            R.string.accessibility_wifi_three_bars,
            R.string.accessibility_wifi_signal_full
    };


    public AccessPointPreference(AccessPoint accessPoint, Context context, UserBadgeCache cache,boolean forSavedNetworks) {
        setWidgetLayoutResource(R.layout.access_point_friction_widget);  // 布局文件为  access_point_friction_widget.xml

        }

}

/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPointPreference.java

import android.support.v7.preference.PreferenceViewHolder;

public class AccessPointPreference extends Preference {

 private TextView mTitleView;  // 显示  各个 热点名字的  TextView

    @Override
    public void onBindViewHolder(final PreferenceViewHolder view) {
        super.onBindViewHolder(view);
        if (mAccessPoint == null) {
            // Used for dummy pref.
            return;
        }
        Drawable drawable = getIcon();
        if (drawable != null) {
            drawable.setLevel(mLevel); 
        }

        mTitleView = (TextView) view.findViewById(com.android.internal.R.id.title);  // 显示  各个 热点名字的  TextView
        if (mTitleView != null) {
            // Attach to the end of the title view
            mTitleView.setCompoundDrawablesRelativeWithIntrinsicBounds(null, null, mBadge, null);
            mTitleView.setCompoundDrawablePadding(mBadgePadding);
        }
        view.itemView.setContentDescription(mContentDescription);  // 设置 简要text  在 refresh() 方法中查看  mContentDescription  获取的值

        ImageView frictionImageView = (ImageView) view.findViewById(R.id.friction_icon);
        bindFrictionImage(frictionImageView);
    }

/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPointPreference.java
    protected void updateIcon(int level, Context context) {
        if (level == -1) {
            safeSetDefaultIcon();
            return;
        }
        TronUtils.logWifiSettingsBadge(context, mWifiBadge);
        Drawable drawable = NetworkBadging.getWifiIcon(level, mWifiBadge, getContext().getTheme()); // 依据 level 获得 wifi信号 图标
        if (!mForSavedNetworks &amp;&amp; drawable != null) {
            drawable.setTint(Utils.getColorAttr(context, android.R.attr.colorControlNormal));
            setIcon(drawable); // 设置 图标 
        } else {
            safeSetDefaultIcon();
        }
    }



/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPointPreference.java
    public void refresh() {
        if (mForSavedNetworks) {
            setTitle(mAccessPoint.getConfigName());  // 在此处设置 标题显示的字符串
        } else {
            setTitle(mAccessPoint.getSsid()); // 在此处设置 标题显示的字符串
        }

        final Context context = getContext();
        int level = mAccessPoint.getLevel();  // 获得信号的强度值
        int wifiBadge = mAccessPoint.getBadge();
        if (level != mLevel || wifiBadge != mWifiBadge) {
            mLevel = level;
            mWifiBadge = wifiBadge;
            updateIcon(mLevel, context);
            notifyChanged();
        }

        updateBadge(context);

        setSummary(mForSavedNetworks ? mAccessPoint.getSavedNetworkSummary(): mAccessPoint.getSettingsSummary());

        mContentDescription = getTitle();
        if (getSummary() != null) {
            mContentDescription = TextUtils.concat(mContentDescription, &quot;,&quot;, getSummary());
        }
        if (level &gt;= 0 &amp;&amp; level &lt; WIFI_CONNECTION_STRENGTH.length) {
            mContentDescription = TextUtils.concat(mContentDescription, &quot;,&quot;,
                    getContext().getString(WIFI_CONNECTION_STRENGTH[level]));
        }
    }



#########
/frameworks/support/v7/preference/src/android/support/v7/preference/PreferenceViewHolder.java
public class PreferenceViewHolder extends RecyclerView.ViewHolder {

    private final SparseArray&lt;View&gt; mCachedViews = new SparseArray&lt;&gt;(4);
    /* package */ PreferenceViewHolder(View itemView) {
        super(itemView);

        // Pre-cache the views that we know in advance we&#39;ll want to find
        mCachedViews.put(android.R.id.title, itemView.findViewById(android.R.id.title)); // title 标题
        mCachedViews.put(android.R.id.summary, itemView.findViewById(android.R.id.summary));  // 简要
        mCachedViews.put(android.R.id.icon, itemView.findViewById(android.R.id.icon));  // 图标
        mCachedViews.put(R.id.icon_frame, itemView.findViewById(R.id.icon_frame));
        mCachedViews.put(AndroidResources.ANDROID_R_ICON_FRAME,itemView.findViewById(AndroidResources.ANDROID_R_ICON_FRAME));
    }

#############
/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPoint.java

    public int getLevel() {
        return WifiManager.calculateSignalLevel(mRssi, SIGNAL_LEVELS【5】);
    }



    public String getSavedNetworkSummary() {
        WifiConfiguration config = mConfig;
        if (config != null) {
            PackageManager pm = mContext.getPackageManager();
            String systemName = pm.getNameForUid(android.os.Process.SYSTEM_UID);
            int userId = UserHandle.getUserId(config.creatorUid);
            ApplicationInfo appInfo = null;
            if (config.creatorName != null &amp;&amp; config.creatorName.equals(systemName)) {
                appInfo = mContext.getApplicationInfo();
            } else {
                try {
                    IPackageManager ipm = AppGlobals.getPackageManager();
                    appInfo = ipm.getApplicationInfo(config.creatorName, 0 /* flags */, userId);
                } catch (RemoteException rex) {
                }
            }
            if (appInfo != null &amp;&amp;
                    !appInfo.packageName.equals(mContext.getString(R.string.settings_package)) &amp;&amp;
                    !appInfo.packageName.equals(
                    mContext.getString(R.string.certinstaller_package))) {
                return mContext.getString(R.string.saved_network, appInfo.loadLabel(pm));
     //  &lt;string name=&quot;saved_network&quot;&gt;&quot;由&lt;xliff:g id=&quot;NAME&quot;&gt;%1$s&lt;/xliff:g&gt;保存&quot;&lt;/string&gt;
            }
        }
        return &quot;&quot;;
    }



private WifiConfiguration mConfig;

    private String getSettingsSummary(WifiConfiguration config) {
        // Update to new summary
        StringBuilder summary = new StringBuilder();

        if (isActive() &amp;&amp; config != null &amp;&amp; config.isPasspoint()) { // 一.  1.当前 AccessPoint 是Active   2.  WifiConfiguration mConfig 不为空  3. 当前 mConfig 类型为 passpoint网络
            // This is the active connection on passpoint
            summary.append(getSummary(mContext, getDetailedState(),false, config.providerFriendlyName));
        } else if (isActive()) { // 二.   1.当前 AccessPoint 是Active
            // This is the active connection on non-passpoint network
            summary.append(getSummary(mContext, getDetailedState(),mInfo != null &amp;&amp; mInfo.isEphemeral()));
        } else if (config != null &amp;&amp; config.isPasspoint() &amp;&amp; config.getNetworkSelectionStatus().isNetworkEnabled()) {
            String format = mContext.getString(R.string.available_via_passpoint);
            //  &lt;string name=&quot;available_via_passpoint&quot; msgid=&quot;1617440946846329613&quot;&gt;&quot;可通过%1$s连接&quot;&lt;/string&gt;
            summary.append(String.format(format, config.providerFriendlyName));
        } else if (config != null &amp;&amp; config.hasNoInternetAccess()) {
            int messageID = config.getNetworkSelectionStatus().isNetworkPermanentlyDisabled() ? R.string.wifi_no_internet_no_reconnect : R.string.wifi_no_internet;
            //&lt;string name=&quot;wifi_no_internet_no_reconnect&quot; msgid=&quot;5724903347310541706&quot;&gt;&quot;无法自动连接&quot;&lt;/string&gt; 
            //&lt;string name=&quot;wifi_no_internet&quot; msgid=&quot;3880396223819116454&quot;&gt;&quot;无法连接到互联网&quot;&lt;/string&gt;
            summary.append(mContext.getString(messageID));
        } else if (config != null &amp;&amp; !config.getNetworkSelectionStatus().isNetworkEnabled()) {
            WifiConfiguration.NetworkSelectionStatus networkStatus =config.getNetworkSelectionStatus();
            switch (networkStatus.getNetworkSelectionDisableReason()) {
                case WifiConfiguration.NetworkSelectionStatus.DISABLED_AUTHENTICATION_FAILURE:
                    summary.append(mContext.getString(R.string.wifi_disabled_password_failure));
                    // &lt;string name=&quot;wifi_disabled_password_failure&quot; msgid=&quot;8659805351763133575&quot;&gt;&quot;身份验证出现问题&quot;&lt;/string&gt;
                    break;
                case WifiConfiguration.NetworkSelectionStatus.DISABLED_DHCP_FAILURE:
                case WifiConfiguration.NetworkSelectionStatus.DISABLED_DNS_FAILURE:
                    summary.append(mContext.getString(R.string.wifi_disabled_network_failure));
                    // &lt;string name=&quot;wifi_disabled_network_failure&quot; msgid=&quot;2364951338436007124&quot;&gt;&quot;IP 配置失败&quot;&lt;/string&gt;
                    break;
                case WifiConfiguration.NetworkSelectionStatus.DISABLED_ASSOCIATION_REJECTION:
                    summary.append(mContext.getString(R.string.wifi_disabled_generic));
                    // &lt;string name=&quot;wifi_disabled_generic&quot; msgid=&quot;4259794910584943386&quot;&gt;&quot;已停用&quot;&lt;/string&gt;
                    break;
            }
        } else if (config != null &amp;&amp; config.getNetworkSelectionStatus().isNotRecommended()) {
            summary.append(mContext.getString(R.string.wifi_disabled_by_recommendation_provider));
            //   &lt;string name=&quot;wifi_disabled_by_recommendation_provider&quot; msgid=&quot;5168315140978066096&quot;&gt;&quot;网络质量较差，因此未连接&quot;&lt;/string&gt;
        } else if (!isReachable()) { // Wifi out of range
            summary.append(mContext.getString(R.string.wifi_not_in_range));
            // &lt;string name=&quot;wifi_not_in_range&quot; msgid=&quot;1136191511238508967&quot;&gt;&quot;不在范围内&quot;&lt;/string&gt; 
        } else { // In range, not disabled.
            if (config != null) { // Is saved network
                summary.append(mContext.getString(R.string.wifi_remembered));
                // &lt;string name=&quot;wifi_remembered&quot; msgid=&quot;4955746899347821096&quot;&gt;&quot;已保存&quot;&lt;/string&gt;
            }
        }

        if (WifiTracker.sVerboseLogging &gt; 0) { // 如果打开了 开发者选项的   wifi-verbose 按钮  那么
            // Add RSSI/band information for this config, what was seen up to 6 seconds ago
            // verbose WiFi Logging is only turned on thru developers settings
            if (mInfo != null &amp;&amp; mNetworkInfo != null) { // This is the active connection
                summary.append(&quot; f=&quot; + Integer.toString(mInfo.getFrequency()));  // f=5724  打印出当前的 通信信道
            }
            summary.append(&quot; &quot; + getVisibilityStatus());  // 返回  WifiConfiguration 的信息
            if (config != null &amp;&amp; !config.getNetworkSelectionStatus().isNetworkEnabled()) {
                summary.append(&quot; (&quot; + config.getNetworkSelectionStatus().getNetworkStatusString());
                if (config.getNetworkSelectionStatus().getDisableTime() &gt; 0) {
                    long now = System.currentTimeMillis();
                    long diff = (now - config.getNetworkSelectionStatus().getDisableTime()) / 1000;
                    long sec = diff%60; //seconds
                    long min = (diff/60)%60; //minutes
                    long hour = (min/60)%60; //hours
                    summary.append(&quot;, &quot;);
                    if (hour &gt; 0) summary.append(Long.toString(hour) + &quot;h &quot;);
                    summary.append( Long.toString(min) + &quot;m &quot;);
                    summary.append( Long.toString(sec) + &quot;s &quot;);  //   添加 断开连接的时间
                }
                summary.append(&quot;)&quot;);
            }

            if (config != null) {
                WifiConfiguration.NetworkSelectionStatus networkStatus = config.getNetworkSelectionStatus();
                for (int index = WifiConfiguration.NetworkSelectionStatus.NETWORK_SELECTION_ENABLE 【0】;
                        index &lt; WifiConfiguration.NetworkSelectionStatus.NETWORK_SELECTION_DISABLED_MAX 【12 】; index++) {
                    if (networkStatus.getDisableReasonCounter(index) != 0) {
                        summary.append(&quot; &quot; + WifiConfiguration.NetworkSelectionStatus.getNetworkDisableReasonString(index) + &quot;=&quot;+ networkStatus.getDisableReasonCounter(index));
                    }
                }
            }
        }
        return summary.toString();
    }

#############
/frameworks/base/wifi/java/android/net/wifi/WifiConfiguration.java

private int mStatus;

        public static final String[] QUALITY_NETWORK_SELECTION_STATUS = {
                &quot;NETWORK_SELECTION_ENABLED&quot;,
                &quot;NETWORK_SELECTION_TEMPORARY_DISABLED&quot;,
                &quot;NETWORK_SELECTION_PERMANENTLY_DISABLED&quot;};

        public String getNetworkStatusString() {
            return QUALITY_NETWORK_SELECTION_STATUS[mStatus];
        }


        public static String getNetworkDisableReasonString(int reason) {
            if (reason &gt;= NETWORK_SELECTION_ENABLE &amp;&amp; reason &lt; NETWORK_SELECTION_DISABLED_MAX) {
                return QUALITY_NETWORK_SELECTION_DISABLE_REASON[reason];
            } else {
                return null;
            }
        }


        public int getDisableReasonCounter(int reason) {
            if (reason &gt;= NETWORK_SELECTION_ENABLE【0】 &amp;&amp; reason &lt; NETWORK_SELECTION_DISABLED_MAX【12】) {
                return mNetworkSeclectionDisableCounter[reason];
            } else {
                throw new IllegalArgumentException(&quot;Illegal reason value: &quot; + reason);
            }
        }


 Arrays.fill(mNetworkSeclectionDisableCounter, NETWORK_SELECTION_ENABLE);

        public static final String[] QUALITY_NETWORK_SELECTION_DISABLE_REASON = {  // 连接失败的原因
                &quot;NETWORK_SELECTION_ENABLE&quot;,
                &quot;NETWORK_SELECTION_DISABLED_BAD_LINK&quot;, // deprecated
                &quot;NETWORK_SELECTION_DISABLED_ASSOCIATION_REJECTION &quot;,
                &quot;NETWORK_SELECTION_DISABLED_AUTHENTICATION_FAILURE&quot;,
                &quot;NETWORK_SELECTION_DISABLED_DHCP_FAILURE&quot;,
                &quot;NETWORK_SELECTION_DISABLED_DNS_FAILURE&quot;,
                &quot;NETWORK_SELECTION_DISABLED_WPS_START&quot;,
                &quot;NETWORK_SELECTION_DISABLED_TLS_VERSION&quot;,
                &quot;NETWORK_SELECTION_DISABLED_AUTHENTICATION_NO_CREDENTIALS&quot;,
                &quot;NETWORK_SELECTION_DISABLED_NO_INTERNET&quot;,
                &quot;NETWORK_SELECTION_DISABLED_BY_WIFI_MANAGER&quot;,
                &quot;NETWORK_SELECTION_DISABLED_BY_USER_SWITCH&quot;
        };


---------------

/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPoint.java
    /**
     * Returns the visibility status of the WifiConfiguration.
     *
     * @return autojoin debugging information
     * TODO: use a string formatter
     * [&quot;rssi 5Ghz&quot;, &quot;num results on 5GHz&quot; / &quot;rssi 5Ghz&quot;, &quot;num results on 5GHz&quot;]
     * For instance [-40,5/-30,2]
     */
 private WifiInfo mInfo;
 private int mRankingScore = Integer.MIN_VALUE;

 private String getVisibilityStatus() {
        StringBuilder visibility = new StringBuilder();
        StringBuilder scans24GHz = null;
        StringBuilder scans5GHz = null;
        String bssid = null;

        long now = System.currentTimeMillis();

        if (mInfo != null) {
            bssid = mInfo.getBSSID();
            if (bssid != null) {
                visibility.append(&quot; &quot;).append(bssid); // 显示当前连接wifi的 Bssid
            }
            visibility.append(&quot; rssi=&quot;).append(mInfo.getRssi());  //信号实时量
            visibility.append(&quot; &quot;);
            visibility.append(&quot; score=&quot;).append(mInfo.score);  // 当前 wifi网络的 评分
            if (mRankingScore != Integer.MIN_VALUE) {
              visibility.append(&quot; rankingScore=&quot;).append(getRankingScore()); // 排行
            }
            if (mBadge != NetworkBadging.BADGING_NONE) {
              visibility.append(&quot; badge=&quot;).append(getBadge());
            }
            visibility.append(String.format(&quot; tx=%.1f,&quot;, mInfo.txSuccessRate));  // public double txSuccessRate;  成功发送速率
            visibility.append(String.format(&quot;%.1f,&quot;, mInfo.txRetriesRate));   //public double txRetriesRate;  重传发送速率  
            visibility.append(String.format(&quot;%.1f &quot;, mInfo.txBadRate));   //  public double txBadRate;   失败发送速率
            visibility.append(String.format(&quot;rx=%.1f&quot;, mInfo.rxSuccessRate));  //  public double rxSuccessRate; 成功接收的速率
        }

        int rssi5 = WifiConfiguration.INVALID_RSSI;
        int rssi24 = WifiConfiguration.INVALID_RSSI;
        int num5 = 0;
        int num24 = 0;
        int numBlackListed = 0;
        int n24 = 0; // Number scan results we included in the string
        int n5 = 0; // Number scan results we included in the string
        evictOldScanResults();
        // TODO: sort list by RSSI or age
        for (ScanResult result : mScanResultCache.values()) {

            if (result.frequency &gt;= LOWER_FREQ_5GHZ  &amp;&amp; result.frequency &lt;= HIGHER_FREQ_5GHZ) {
                // Strictly speaking: [4915, 5825]
                // number of known BSSID on 5GHz band
                num5 = num5 + 1;
            } else if (result.frequency &gt;= LOWER_FREQ_24GHZ  &amp;&amp; result.frequency &lt;= HIGHER_FREQ_24GHZ) {
                // Strictly speaking: [2412, 2482]
                // number of known BSSID on 2.4Ghz band
                num24 = num24 + 1;
            }


            if (result.frequency &gt;= LOWER_FREQ_5GHZ &amp;&amp; result.frequency &lt;= HIGHER_FREQ_5GHZ) {
                if (result.level &gt; rssi5) {
                    rssi5 = result.level;
                }
                 scans5GHz.append(&quot;max=&quot;).append(max5Grssi); // 在安卓8.1 显示 最大的 max的 5G信号量
                if (n5 &lt; 4) {  // 显示最多四个 5G 信道信息
                    if (scans5GHz == null) scans5GHz = new StringBuilder();
                    scans5GHz.append(&quot; \n{&quot;).append(result.BSSID);  // 添加  {  bssid = frequency，
                    if (bssid != null &amp;&amp; result.BSSID.equals(bssid)) scans5GHz.append(&quot;*&quot;);
                    scans5GHz.append(&quot;=&quot;).append(result.frequency);
                    scans5GHz.append(&quot;,&quot;).append(result.level);
                     scans5GHz.append(&quot;,&quot;).append(now - result.timestamp/1000*1000).append(&quot;s&quot;);  //  用于显示在几秒之前探测到的结果
                    scans5GHz.append(&quot;}&quot;);
                    n5++;
                }
            } else if (result.frequency &gt;= LOWER_FREQ_24GHZ &amp;&amp; result.frequency &lt;= HIGHER_FREQ_24GHZ) {
                if (result.level &gt; rssi24) {
                    rssi24 = result.level;
                }
                scans24GHz.append(&quot;max=&quot;).append(max24Grssi); // 在安卓8.1 显示 最大的 max的 2.4G信号量
                if (n24 &lt; 4) {   // 显示最多四个 2.4G 信道信息
                    if (scans24GHz == null) scans24GHz = new StringBuilder();
                    scans24GHz.append(&quot; \n{&quot;).append(result.BSSID);
                    if (bssid != null &amp;&amp; result.BSSID.equals(bssid)) scans24GHz.append(&quot;*&quot;);
                    scans24GHz.append(&quot;=&quot;).append(result.frequency);
                    scans24GHz.append(&quot;,&quot;).append(result.level);
                    scans5GHz.append(&quot;,&quot;).append(now - result.timestamp/1000*1000).append(&quot;s&quot;);  //  用于显示在几秒之前探测到的结果
                    scans24GHz.append(&quot;}&quot;);
                    n24++;
                }
            }
        }
        visibility.append(&quot; [&quot;);
        if (num24 &gt; 0) {
            visibility.append(&quot;(&quot;).append(num24).append(&quot;)&quot;);
            if (n24 &lt;= 4) {
                if (scans24GHz != null) {
                    visibility.append(scans24GHz.toString());
                }
            } else {
                visibility.append(&quot;max=&quot;).append(rssi24); // 2.4G 最好的信号质量 信号量
                if (scans24GHz != null) {
                    visibility.append(&quot;,&quot;).append(scans24GHz.toString());
                }
            }
        }
        visibility.append(&quot;;&quot;);
        if (num5 &gt; 0) {
            visibility.append(&quot;(&quot;).append(num5).append(&quot;)&quot;);
            if (n5 &lt;= 4) {
                if (scans5GHz != null) {
                    visibility.append(scans5GHz.toString());
                }
            } else {
                visibility.append(&quot;max=&quot;).append(rssi5);  // 5G 最好的信号质量 信号量
                if (scans5GHz != null) {
                    visibility.append(&quot;,&quot;).append(scans5GHz.toString());
                }
            }
        }
        if (numBlackListed &gt; 0)
            visibility.append(&quot;!&quot;).append(numBlackListed);
        visibility.append(&quot;]&quot;);

        return visibility.toString();  // 返回 简要显示的 字符串 Summary
    }



------------------------------------

    public static String getSummary(Context context, String ssid, DetailedState state,boolean isEphemeral, String passpointProvider) {
        if (state == DetailedState.CONNECTED &amp;&amp; ssid == null) {
            if (TextUtils.isEmpty(passpointProvider) == false) {
                // Special case for connected + passpoint networks.
                String format = context.getString(R.string.connected_via_passpoint);
           // &lt;string name=&quot;connected_via_passpoint&quot; msgid=&quot;2826205693803088747&quot;&gt;&quot;已通过%1$s连接&quot;&lt;/string&gt;    已通过 passpoint 网络连接 

                return String.format(format, passpointProvider);
            } else if (isEphemeral) {
                // Special case for connected + ephemeral networks.
                final NetworkScoreManager networkScoreManager = context.getSystemService( NetworkScoreManager.class);
                NetworkScorerAppData scorer = networkScoreManager.getActiveScorer();
                if (scorer != null &amp;&amp; scorer.getRecommendationServiceLabel() != null) {
                    String format = context.getString(R.string.connected_via_network_scorer);
               //  &lt;string name=&quot;connected_via_network_scorer&quot; msgid=&quot;5713793306870815341&quot;&gt;&quot;已通过%1$s自动连接&quot;&lt;/string&gt;   已通过 passpoint网络  自动连接
                    return String.format(format, scorer.getRecommendationServiceLabel());
                } else {
                    return context.getString(R.string.connected_via_network_scorer_default);
               //  &lt;string name=&quot;connected_via_network_scorer_default&quot; msgid=&quot;7867260222020343104&quot;&gt;&quot;已自动连接（通过网络评分服务提供方）&quot;&lt;/string&gt;
                }
            }
        }
        //  if (state == DetailedState.CONNECTED &amp;&amp; ssid == null) {----------end
        // Case when there is wifi connected without internet connectivity.
        final ConnectivityManager cm = (ConnectivityManager)  context.getSystemService(Context.CONNECTIVITY_SERVICE);
        if (state == DetailedState.CONNECTED) {
            IWifiManager wifiManager = IWifiManager.Stub.asInterface( ServiceManager.getService(Context.WIFI_SERVICE));
            NetworkCapabilities nc = null;
            try {
                nc = cm.getNetworkCapabilities(wifiManager.getCurrentNetwork());
            } catch (RemoteException e) {}

            if (nc != null) {
                if (nc.hasCapability(nc.NET_CAPABILITY_CAPTIVE_PORTAL)) {   //  如果当前网络的 NetworkCapabilities  属于 NET_CAPABILITY_CAPTIVE_PORTAL PORTAL网络 那么显示   登录到网络
                    return context.getString(com.android.internal.R.string.network_available_sign_in);
                    // &lt;string name=&quot;network_available_sign_in&quot; msgid=&quot;1848877297365446605&quot;&gt;&quot;登录到网络&quot;&lt;/string&gt;
                } else if (!nc.hasCapability(NetworkCapabilities.NET_CAPABILITY_VALIDATED)) { 
            //  如果当前网络的 NetworkCapabilities 包含  NET_CAPABILITY_VALIDATED【网络有效】 返回为false 那么显示  当前网络无   internet访问能力 
            // &lt;string name=&quot;wifi_connected_no_internet&quot; msgid=&quot;3149853966840874992&quot;&gt;&quot;已连接，但无法访问互联网&quot;&lt;/string&gt;
                    return context.getString(R.string.wifi_connected_no_internet);
                }
            }
        }
        if (state == null) {
            Log.w(TAG, &quot;state is null, returning empty summary&quot;);
            return &quot;&quot;;
        }
        String[] formats = context.getResources().getStringArray((ssid == null)? R.array.wifi_status : R.array.wifi_status_with_ssid); // 依据 ssid 是否为空 获取 字符数组
        int index = state【DetailedState】.ordinal();  // 获得当前State 在 emnu数组中的 索引    因为状态是数组索引是一一对应的关系

        if (index &gt;= formats.length || formats[index].length() == 0) {
            return &quot;&quot;;
        }
        return String.format(formats[index], ssid);  //  返回字符串
    }



  &lt;string-array name=&quot;wifi_status&quot;&gt;
    &lt;item msgid=&quot;1922181315419294640&quot;&gt;&lt;/item&gt;
    &lt;item msgid=&quot;8934131797783724664&quot;&gt;&quot;正在扫描...&quot;&lt;/item&gt;
    &lt;item msgid=&quot;8513729475867537913&quot;&gt;&quot;正在连接...&quot;&lt;/item&gt;
    &lt;item msgid=&quot;515055375277271756&quot;&gt;&quot;正在进行身份验证...&quot;&lt;/item&gt;
    &lt;item msgid=&quot;1943354004029184381&quot;&gt;&quot;正在获取IP地址...&quot;&lt;/item&gt;
    &lt;item msgid=&quot;4221763391123233270&quot;&gt;&quot;已连接&quot;&lt;/item&gt;
    &lt;item msgid=&quot;624838831631122137&quot;&gt;&quot;已暂停&quot;&lt;/item&gt;
    &lt;item msgid=&quot;7979680559596111948&quot;&gt;&quot;正在断开连接...&quot;&lt;/item&gt;
    &lt;item msgid=&quot;1634960474403853625&quot;&gt;&quot;已断开连接&quot;&lt;/item&gt;
    &lt;item msgid=&quot;746097431216080650&quot;&gt;&quot;失败&quot;&lt;/item&gt;
    &lt;item msgid=&quot;6367044185730295334&quot;&gt;&quot;已停用&quot;&lt;/item&gt;
    &lt;item msgid=&quot;503942654197908005&quot;&gt;&quot;暂时关闭（网络状况不佳）&quot;&lt;/item&gt;
  &lt;/string-array&gt;


    &lt;string-array name=&quot;wifi_status_with_ssid&quot;&gt;
    &lt;item msgid=&quot;7714855332363650812&quot;&gt;&lt;/item&gt;
    &lt;item msgid=&quot;8878186979715711006&quot;&gt;&quot;正在扫描...&quot;&lt;/item&gt;
    &lt;item msgid=&quot;355508996603873860&quot;&gt;&quot;正在连接到 &lt;xliff:g id=&quot;NETWORK_NAME&quot;&gt;%1$s&lt;/xliff:g&gt;...&quot;&lt;/item&gt;
    &lt;item msgid=&quot;554971459996405634&quot;&gt;&quot;正在通过 &lt;xliff:g id=&quot;NETWORK_NAME&quot;&gt;%1$s&lt;/xliff:g&gt; 进行身份验证...&quot;&lt;/item&gt;
    &lt;item msgid=&quot;7928343808033020343&quot;&gt;&quot;正在从&lt;xliff:g id=&quot;NETWORK_NAME&quot;&gt;%1$s&lt;/xliff:g&gt;获取IP地址...&quot;&lt;/item&gt;
    &lt;item msgid=&quot;8937994881315223448&quot;&gt;&quot;已连接到 &lt;xliff:g id=&quot;NETWORK_NAME&quot;&gt;%1$s&lt;/xliff:g&gt;&quot;&lt;/item&gt;
    &lt;item msgid=&quot;1330262655415760617&quot;&gt;&quot;已暂停&quot;&lt;/item&gt;
    &lt;item msgid=&quot;7698638434317271902&quot;&gt;&quot;正在断开与 &lt;xliff:g id=&quot;NETWORK_NAME&quot;&gt;%1$s&lt;/xliff:g&gt; 的连接...&quot;&lt;/item&gt;
    &lt;item msgid=&quot;197508606402264311&quot;&gt;&quot;已断开连接&quot;&lt;/item&gt;
    &lt;item msgid=&quot;8578370891960825148&quot;&gt;&quot;失败&quot;&lt;/item&gt;
    &lt;item msgid=&quot;5660739516542454527&quot;&gt;&quot;已停用&quot;&lt;/item&gt;
    &lt;item msgid=&quot;1805837518286731242&quot;&gt;&quot;暂时关闭（网络状况不佳）&quot;&lt;/item&gt;
  &lt;/string-array&gt;

##############
/frameworks/base/core/java/android/net/NetworkInfo.java

public class NetworkInfo implements Parcelable {

    public enum DetailedState {   // 与字符串数组   &lt;string-array name=&quot;wifi_status_with_ssid&quot;&gt;     &lt;string-array name=&quot;wifi_status&quot;&gt; 的索引是一一对应的关系
        IDLE,/** Ready to start data connection setup. */
        SCANNING,    /** Searching for an available access point. */
        CONNECTING,   /** Currently setting up data connection. */
        AUTHENTICATING,/** Network link established, performing authentication. */
        OBTAINING_IPADDR,/** Awaiting response from DHCP server in order to assign IP address information. */
        CONNECTED, /** IP traffic should be available. */
        SUSPENDED,/** IP traffic is suspended */
        DISCONNECTING,/** Currently tearing down data connection. */
        DISCONNECTED, /** IP traffic not available. */
        FAILED, /** Attempt to connect failed. */
        BLOCKED,  /** Access to this network is blocked. */
        VERIFYING_POOR_LINK,  /** Link has poor connectivity. */
        CAPTIVE_PORTAL_CHECK  /** Checking if network is a captive portal */
    }




#########

/frameworks/base/wifi/java/android/net/wifi/WifiManager.java
    public static int calculateSignalLevel(int rssi, int numLevels) {
        if (rssi &lt;= MIN_RSSI 【-100】) {
            return 0;
        } else if (rssi &gt;= MAX_RSSI【-50】) {
            return numLevels - 1;
        } else {
            float inputRange = (MAX_RSSI - MIN_RSSI); // 50
            float outputRange = (numLevels - 1); // 4 
            return (int)((float)(rssi - MIN_RSSI) * outputRange / inputRange);  // 在 -50 到 -100 之间 取值
        }
    }


###########
/frameworks/base/core/java/android/net/NetworkBadging.java

    @NonNull public static Drawable getWifiIcon(@IntRange(from=0, to=4) int signalLevel, @Badging int badging, @Nullable Theme theme) {
        return Resources.getSystem().getDrawable(getWifiSignalResource(signalLevel), theme);
    }


    @DrawableRes private static int getWifiSignalResource(int signalLevel) {
        switch (signalLevel) {
            case 0:
                return com.android.internal.R.drawable.ic_wifi_signal_0;  // 信号图标资源ID
            case 1:
                return com.android.internal.R.drawable.ic_wifi_signal_1;
            case 2:
                return com.android.internal.R.drawable.ic_wifi_signal_2;
            case 3:
                return com.android.internal.R.drawable.ic_wifi_signal_3;
            case 4:
                return com.android.internal.R.drawable.ic_wifi_signal_4;
            default:
                throw new IllegalArgumentException(&quot;Invalid signal level: &quot; + signalLevel);
        }
    }
</code></pre><h3 id="wifi-ua13-">WIFI UA13 布局分析</h3>
<pre><code>
     wifi_settings.xml
     &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

      &lt;PreferenceScreen
        xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
        xmlns:settings=&quot;http://schemas.android.com/apk/res/com.android.settings&quot;
        android:title=&quot;@string/wifi_settings&quot;
        settings:keywords=&quot;@string/keywords_wifi&quot;&gt;

    &lt;PreferenceCategory android:key=&quot;connected_access_point&quot; /&gt; // 当前已连接网络的PreferenceCategory

    &lt;PreferenceCategory android:key=&quot;access_points&quot;/&gt;  // 当前搜索到的网络的PreferenceCategory

    &lt;PreferenceCategory android:key=&quot;additional_settings&quot;&gt;  //  添加网络的 PreferenceCategory
        &lt;Preference
                android:key=&quot;configure_settings&quot;           // WLAN偏好设置
                android:title=&quot;@string/wifi_configure_settings_preference_title&quot;
                android:fragment=&quot;com.android.settings.wifi.ConfigureWifiSettings&quot; /&gt;

        &lt;Preference
                android:key=&quot;saved_networks&quot;    // 已保存网络Preference
                android:title=&quot;@string/wifi_saved_access_points_label&quot;
                android:fragment=&quot;com.android.settings.wifi.SavedAccessPointsWifiSettings&quot; /&gt;
    &lt;/PreferenceCategory&gt;
      &lt;/PreferenceScreen&gt;


  access_point_friction_widget.xml

  &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;ImageView xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
        android:id=&quot;@+id/friction_icon&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_gravity=&quot;center&quot;
        android:contentDescription=&quot;@null&quot; /&gt;





com.android.internal.R.layout.preference  资源ID
/frameworks/base/core/res/res/layout/preference.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; 
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:minHeight=&quot;?android:attr/listPreferredItemHeight&quot;
    android:gravity=&quot;center_vertical&quot;
    android:paddingEnd=&quot;?android:attr/scrollbarSize&quot;
    android:background=&quot;?android:attr/selectableItemBackground&quot; &gt;

    &lt;ImageView
        android:id=&quot;@+android:id/icon&quot;   // 显示  wifi信号质量的图标
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_gravity=&quot;center&quot;
        /&gt;

    &lt;RelativeLayout
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_marginStart=&quot;15dip&quot;
        android:layout_marginEnd=&quot;6dip&quot;
        android:layout_marginTop=&quot;6dip&quot;
        android:layout_marginBottom=&quot;6dip&quot;
        android:layout_weight=&quot;1&quot;&gt;

        &lt;TextView android:id=&quot;@+android:id/title&quot;   // 显示  WIFI 热点  名字
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:singleLine=&quot;true&quot;
            android:textAppearance=&quot;?android:attr/textAppearanceLarge&quot;
            android:ellipsize=&quot;marquee&quot;
            android:fadingEdge=&quot;horizontal&quot; /&gt;

        &lt;TextView android:id=&quot;@+android:id/summary&quot;   //   显示 热点 简要
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_below=&quot;@android:id/title&quot;
            android:layout_alignStart=&quot;@android:id/title&quot;
            android:textAppearance=&quot;?android:attr/textAppearanceSmall&quot;
            android:textColor=&quot;?android:attr/textColorSecondary&quot;
            android:maxLines=&quot;4&quot; /&gt;

    &lt;/RelativeLayout&gt;

    &lt;!-- Preference should place its actual preference widget here. --&gt;
    &lt;LinearLayout android:id=&quot;@+android:id/widget_frame&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;match_parent&quot;
        android:gravity=&quot;center_vertical&quot;
        android:orientation=&quot;vertical&quot; /&gt;

&lt;/LinearLayout&gt;
</code></pre><h2 id="wifi-ua14-">WIFI UA14分析</h2>
<h3 id="wifi-ua14-">WIFI UA14 操作列</h3>
<p><img src="img/7.png" width = "25%" height="25%"/><img src="img/10.png" width = "25%" height="25%"/><img src="img/11.png" width = "25%" height="25%"/>  </p>
<ol>
<li><strong>UA编号</strong>   UA14</li><li><strong>UA说明</strong>  <strong>当前已连接网络Preference的长按事件</strong></li><li><p><strong>UA触发函数</strong>   在 /packages/apps/Settings/src/com/android/settings/wifi/LongPressAccessPointPreference.java 函数onBindViewHolder 设置了 setOnCreateContextMenuListener(mFragment)<br>/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java这个Fragemnt 以及setLongClickable(true);   来接受长按事件 </p>
</li><li><p><strong>UA字符可选值</strong>    </p>
</li><li><strong>UA布局及ID</strong>    系统上下文 menu</li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>  </li><li><strong>数据库可选值 </strong>   </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>    WifiNetworkDetailsFragment </li><li><strong>UA触发函数所在类</strong>    WifiNetworkDetailsFragment</li></ol>
<hr>
<h3 id="wifi-ua14-">WIFI UA14 代码分析</h3>
<pre><code>/packages/apps/Settings/src/com/android/settings/wifi/LongPressAccessPointPreference.java
public class LongPressAccessPointPreference extends AccessPointPreference {

    @Override
    public void onBindViewHolder(final PreferenceViewHolder view) {
        super.onBindViewHolder(view);
        if (mFragment != null) {
            view.itemView.setOnCreateContextMenuListener(mFragment); // 长按事件的响应类
            view.itemView.setTag(this); // 设置tag 用于保存当前preference
            view.itemView.setLongClickable(true);  // 长按事件使能
        }
    }

  }








/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
    @Override
    public void onCreateContextMenu(ContextMenu menu, View view, ContextMenuInfo info) { // 长按 AccessPoint时触发的函数
            Preference preference = (Preference) view.getTag();

            if (preference instanceof LongPressAccessPointPreference) {

            //  private AccessPoint mSelectedAccessPoint;  用户长按的Prference 对应的  AccessPoint 
                mSelectedAccessPoint =((LongPressAccessPointPreference) preference).getAccessPoint();
                menu.setHeaderTitle(mSelectedAccessPoint.getSsid()); //  长按 显示的第一个项  为 热点的名字
                if (mSelectedAccessPoint.isConnectable()) {  // 如果当前网络热点有信号 的话 isConnectable() = true
                //   &lt;string name=&quot;wifi_menu_connect&quot; msgid=&quot;4996220309848349408&quot;&gt;&quot;连接到网络&quot;&lt;/string&gt;    显示  连接到网络
                    menu.add(Menu.NONE, MENU_ID_CONNECT, 0, R.string.wifi_menu_connect);
                }

                WifiConfiguration config = mSelectedAccessPoint.getConfig();
                // Some configs are ineditable
                if (isEditabilityLockedDown(getActivity(), config)) {  // 判断该热点对应的 WifiConfiguration 是否可修改
                    return;
                }

                if (mSelectedAccessPoint.isSaved() || mSelectedAccessPoint.isEphemeral()) { // 如果当前preference 对应的AccessPoint 是已保存过 或是 临时的话  显示
                    // Allow forgetting a network if either the network is saved or ephemerally
                    // connected. (In the latter case, &quot;forget&quot; blacklists the network so it won&#39;t
                    // be used again, ephemerally).
                    // &lt;string name=&quot;wifi_menu_forget&quot; msgid=&quot;8736964302477327114&quot;&gt;&quot;取消保存网络&quot;&lt;/string&gt;
                    menu.add(Menu.NONE, MENU_ID_FORGET, 0, R.string.wifi_menu_forget);
                }
                if (mSelectedAccessPoint.isSaved()) {
                //  &lt;string name=&quot;wifi_menu_modify&quot; msgid=&quot;2068554918652440105&quot;&gt;&quot;修改网络&quot;&lt;/string&gt;
                    menu.add(Menu.NONE, MENU_ID_MODIFY, 0, R.string.wifi_menu_modify);
                    NfcAdapter nfcAdapter = NfcAdapter.getDefaultAdapter(getActivity());
                    if (nfcAdapter != null &amp;&amp; nfcAdapter.isEnabled() &amp;&amp; mSelectedAccessPoint.getSecurity() != AccessPoint.SECURITY_NONE) {
                        // Only allow writing of NFC tags for password-protected networks.
                        // &lt;string name=&quot;wifi_menu_write_to_nfc&quot; msgid=&quot;7692881642188240324&quot;&gt;&quot;写入NFC标签&quot;&lt;/string&gt;  只在 NFC有效的条件下
                        menu.add(Menu.NONE, MENU_ID_WRITE_NFC, 0, R.string.wifi_menu_write_to_nfc);
                    }
                }
            }
    }

/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
   static boolean isEditabilityLockedDown(Context context, WifiConfiguration config) {
        return !canModifyNetwork(context, config); //canModifyNetwork 用于判断是否 WifiConfiguration 可修改    
    }


/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
    static boolean canModifyNetwork(Context context, WifiConfiguration config) {
        if (config == null) {
            return true;
        }
        final DevicePolicyManager dpm = (DevicePolicyManager) context.getSystemService( Context.DEVICE_POLICY_SERVICE);
        final PackageManager pm = context.getPackageManager();
        if (pm.hasSystemFeature(PackageManager.FEATURE_DEVICE_ADMIN) &amp;&amp; dpm == null) {
            return false;
        }

        boolean isConfigEligibleForLockdown = false;
        if (dpm != null) {
            final ComponentName deviceOwner = dpm.getDeviceOwnerComponentOnAnyUser();
            if (deviceOwner != null) {
                final int deviceOwnerUserId = dpm.getDeviceOwnerUserId();
                try {
                    final int deviceOwnerUid = pm.getPackageUidAsUser(deviceOwner.getPackageName(),deviceOwnerUserId);
                    isConfigEligibleForLockdown = deviceOwnerUid == config.creatorUid;
                } catch (NameNotFoundException e) {
                    // don&#39;t care
                }
            }
        }
        if (!isConfigEligibleForLockdown) {
            return true;
        }
//         public static final String WIFI_DEVICE_OWNER_CONFIGS_LOCKDOWN = &quot;wifi_device_owner_configs_lockdown&quot;; 用于判断是否允许用户修改wifi配置的数据库项  1-true  0 false
        final ContentResolver resolver = context.getContentResolver();
        final boolean isLockdownFeatureEnabled = Settings.Global.getInt(resolver,Settings.Global.WIFI_DEVICE_OWNER_CONFIGS_LOCKDOWN, 0) != 0;
        return !isLockdownFeatureEnabled;
    }



/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPoint.java
    public boolean isConnectable() {
        return getLevel() != -1 &amp;&amp; getDetailedState() == null;
    }    
    public int getLevel() {
        return WifiManager.calculateSignalLevel(mRssi, SIGNAL_LEVELS);
    }
    public DetailedState getDetailedState() {
        if (mNetworkInfo != null) {
            return mNetworkInfo.getDetailedState();
        }
        Log.w(TAG, &quot;NetworkInfo is null, cannot return detailed state&quot;);
        return null;
    }


/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPoint.java
public boolean isSaved() {
        return networkId != WifiConfiguration.INVALID_NETWORK_ID;
    }

/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPoint.java
    public boolean isEphemeral() {
        return mInfo != null &amp;&amp; mInfo.isEphemeral() &amp;&amp;
                mNetworkInfo != null &amp;&amp; mNetworkInfo.getState() != State.DISCONNECTED;
    }




/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
     @Override
    public boolean onContextItemSelected(MenuItem item) {
        if (mSelectedAccessPoint == null) {
            return super.onContextItemSelected(item);
        }
        switch (item.getItemId()) { // 用户选择 上下文按钮
            case MENU_ID_CONNECT: {  // 选择  连接到网络
                boolean isSavedNetwork = mSelectedAccessPoint.isSaved(); // 判断当前网络是否有 networkId
                if (isSavedNetwork) {
                    connect(mSelectedAccessPoint.getConfig(), isSavedNetwork); // 如果有执行 connect(final WifiConfiguration config, boolean isSavedNetwork) 方法
                // // 如果当前网络没有加密认证 则先生成 networkdId 再 connect(final WifiConfiguration config, boolean isSavedNetwork)
                } else if (mSelectedAccessPoint.getSecurity() == AccessPoint.SECURITY_NONE) { 
                    /** Bypass dialog for unsecured networks */
                    mSelectedAccessPoint.generateOpenNetworkConfig();  // 用于产生 WifiConfiguration 
                    connect(mSelectedAccessPoint.getConfig(), isSavedNetwork);
                } else {
                    showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_CONNECT); // 弹出 Dialog框 用于 用户输入 一些认证信息才能连接
                }
                return true;
            }
            case MENU_ID_FORGET: {   // 选择 取消保存网络
                forget();   
                return true;
            }
            case MENU_ID_MODIFY: {  // 选择 修改网络
                showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_MODIFY);
                return true;
            }
            case MENU_ID_WRITE_NFC:  // 选择 写入 NFC标签
                showDialog(WRITE_NFC_DIALOG_ID);
                return true;

        }
        return super.onContextItemSelected(item);
    }





/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
    protected void connect(final WifiConfiguration config, boolean isSavedNetwork) {
        // Log subtype if configuration is a saved network.
        mMetricsFeatureProvider.action(getActivity(), MetricsEvent.ACTION_WIFI_CONNECT, isSavedNetwork);
        mWifiManager.connect(config, mConnectListener);  //  调用 mWifiManager的 connect 方法  ▲3 UA分析完之后分析
    }



/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
    /* package */ void forget() {
        mMetricsFeatureProvider.action(getActivity(), MetricsEvent.ACTION_WIFI_FORGET);
        if (!mSelectedAccessPoint.isSaved()) {
            if (mSelectedAccessPoint.getNetworkInfo() != null &amp;&amp; mSelectedAccessPoint.getNetworkInfo().getState() != State.DISCONNECTED) {
                // Network is active but has no network ID - must be ephemeral.
       //针对临时网络  调用 mWifiManager的 disableEphemeralNetwork 方法  ▲4 UA分析完之后分析
                mWifiManager.disableEphemeralNetwork(AccessPoint.convertToQuotedString(mSelectedAccessPoint.getSsidStr()));
            } else {
                // Should not happen, but a monkey seems to trigger it
                Log.e(TAG, &quot;Failed to forget invalid network &quot; + mSelectedAccessPoint.getConfig());
                return;
            }
        } else if (mSelectedAccessPoint.getConfig().isPasspoint()) {
            mWifiManager.removePasspointConfiguration(mSelectedAccessPoint.getConfig().FQDN); //调用 mWifiManager的 removePasspointConfiguration 方法  ▲5 UA分析完之后分析  针对passpoint网络
        } else {
            mWifiManager.forget(mSelectedAccessPoint.getConfig().networkId, mForgetListener); //调用 mWifiManager的 forget 方法  ▲6 UA分析完之后分析  针对趋同网络
        }

        mWifiTracker.resumeScanning();

        // We need to rename/replace &quot;Next&quot; button in wifi setup context.
        changeNextButtonState(false);
    }






/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
      private void showDialog(AccessPoint accessPoint, int dialogMode) {
        if (accessPoint != null) {
            WifiConfiguration config = accessPoint.getConfig();
            if (isEditabilityLockedDown(getActivity(), config) &amp;&amp; accessPoint.isActive()) {
                RestrictedLockUtils.sendShowAdminSupportDetailsIntent(getActivity(),RestrictedLockUtils.getDeviceOwner(getActivity()));
                return;
            }
        }

        if (mDialog != null) {
            removeDialog(WIFI_DIALOG_ID);
            mDialog = null;
        }

        // Save the access point and edit mode
        mDlgAccessPoint = accessPoint;    // 对话框 所显示的 AccessPoint
        mDialogMode = dialogMode;

        showDialog(WIFI_DIALOG_ID);  // 显示Diaglog 对话框
    }




/packages/apps/Settings/src/com/android/settings/SettingsPreferenceFragment.java    WifiSettings.java的父父类
    protected void showDialog(int dialogId) {
        if (mDialogFragment != null) {
            Log.e(TAG, &quot;Old dialog fragment not null!&quot;);
        }
        mDialogFragment = new SettingsDialogFragment(this, dialogId);  // 创建 SettingsDialogFragment   并调用 show 方法 显示 Dialog对话框
        mDialogFragment.show(getChildFragmentManager(), Integer.toString(dialogId));
    }



    public static class SettingsDialogFragment extends InstrumentedDialogFragment {
        private static final String KEY_DIALOG_ID = &quot;key_dialog_id&quot;;
        private static final String KEY_PARENT_FRAGMENT_ID = &quot;key_parent_fragment_id&quot;;

        public SettingsDialogFragment(DialogCreatable fragment, int dialogId) {
            super(fragment, dialogId);
            if (!(fragment instanceof Fragment)) {
                throw new IllegalArgumentException(&quot;fragment argument must be an instance of &quot;
                        + Fragment.class.getName());
            }
            mParentFragment = (Fragment) fragment;
        }





        @Override  SettingsDialogFragment.java
        public Dialog onCreateDialog(Bundle savedInstanceState) {
            if (savedInstanceState != null) {
                mDialogId = savedInstanceState.getInt(KEY_DIALOG_ID, 0);
                mParentFragment = getParentFragment();
                int mParentFragmentId = savedInstanceState.getInt(KEY_PARENT_FRAGMENT_ID, -1);
                if (mParentFragment == null) {
                    mParentFragment = getFragmentManager().findFragmentById(mParentFragmentId);
                }
                if (!(mParentFragment instanceof DialogCreatable)) {
                    throw new IllegalArgumentException();
                }
                // This dialog fragment could be created from non-SettingsPreferenceFragment
                if (mParentFragment instanceof SettingsPreferenceFragment) {
                    // restore mDialogFragment in mParentFragment
                    ((SettingsPreferenceFragment) mParentFragment).mDialogFragment = this;
                }
            }
            return ((DialogCreatable) mParentFragment).onCreateDialog(mDialogId); // 调用子类的 onCreateDialog 方法
        }
        }




 /packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
    @Override
    public Dialog onCreateDialog(int dialogId) {
        switch (dialogId) {
            case WIFI_DIALOG_ID:
                AccessPoint ap = mDlgAccessPoint; // For manual launch
                if (ap == null) { // For re-launch from saved state
                    if (mAccessPointSavedState != null) {
                        ap = new AccessPoint(getActivity(), mAccessPointSavedState);
                        // For repeated orientation changes
                        mDlgAccessPoint = ap;
                        // Reset the saved access point data
                        mAccessPointSavedState = null;
                    }
                }
                // If it&#39;s null, fine, it&#39;s for Add Network
                mSelectedAccessPoint = ap;
                mDialog = new WifiDialog(getActivity(), this, ap, mDialogMode, /* no hide submit/connect */ false); // 查看WIfiDialog对象
                return mDialog;
            case WPS_PBC_DIALOG_ID:
                return new WpsDialog(getActivity(), WpsInfo.PBC);
            case WPS_PIN_DIALOG_ID:
                return new WpsDialog(getActivity(), WpsInfo.DISPLAY);
            case WRITE_NFC_DIALOG_ID:
                if (mSelectedAccessPoint != null) {
                    mWifiToNfcDialog = new WriteWifiConfigToNfcDialog(
                            getActivity(),
                            mSelectedAccessPoint.getSecurity(),
                            new WifiManagerWrapper(mWifiManager));
                } else if (mWifiNfcDialogSavedState != null) {
                    mWifiToNfcDialog = new WriteWifiConfigToNfcDialog(getActivity(),
                            mWifiNfcDialogSavedState, new WifiManagerWrapper(mWifiManager));
                }

                return mWifiToNfcDialog;
        }
        return super.onCreateDialog(dialogId);
    }



###########
/packages/apps/Settings/src/com/android/settings/wifi/WifiDialog.java

class WifiDialog extends AlertDialog implements WifiConfigUiBase, DialogInterface.OnClickListener {

    public interface WifiDialogListener {
        void onForget(WifiDialog dialog);
        void onSubmit(WifiDialog dialog);
    }

        public WifiDialog(Context context, WifiDialogListener listener, AccessPoint accessPoint,
            int mode, boolean hideSubmitButton) {
        this(context, listener, accessPoint, mode);
        mHideSubmitButton = hideSubmitButton;
    }


     @Override
    protected void onCreate(Bundle savedInstanceState) {
        mView = getLayoutInflater().inflate(R.layout.wifi_dialog, null); // 对话框布局 wifi_dialog  输入密码等对话框 详见file文档
        setView(mView);
        setInverseBackgroundForced(true);
        mController = new WifiConfigController(this, mView, mAccessPoint, mMode);
        super.onCreate(savedInstanceState);

        if (mHideSubmitButton) { // 是否隐藏提交按钮
            mController.hideSubmitButton();
        } else {
            mController.enableSubmitIfAppropriate();
        }

        if (mAccessPoint == null) {
            mController.hideForgetButton();
        }
    }




        @Override    WifiDialog
    public void onClick(DialogInterface dialogInterface, int id) {
        if (mListener != null) {
            switch (id) {
                case BUTTON_SUBMIT:  // 点击对话框的 提交按钮
                    mListener.onSubmit(this);
                    break;
                case BUTTON_FORGET:  // 点击对话框的  取消 按钮
                    if (WifiSettings.isEditabilityLockedDown(
                            getContext(), mAccessPoint.getConfig())) {
                        RestrictedLockUtils.sendShowAdminSupportDetailsIntent(getContext(),
                                RestrictedLockUtils.getDeviceOwner(getContext()));
                        return;
                    }
                    mListener.onForget(this);
                    break;
            }
        }
    }


############
/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPoint.java
   public void generateOpenNetworkConfig() {
        if (security != SECURITY_NONE) // 只有 security 为SECURITY_NONE 才能这样配置
            throw new IllegalStateException();
        if (mConfig != null)
            return;
        mConfig = new WifiConfiguration();
        mConfig.SSID = AccessPoint.convertToQuotedString(ssid);
        mConfig.allowedKeyManagement.set(KeyMgmt.NONE);
    }
</code></pre><h3 id="wifi-ua14-">WIFI UA14  布局分析</h3>
<p><img src="img/25.png" width = "25%" height="25%"/> <img src="img/26.png" width = "25%" height="25%"/><br><a href="file/wifi_dialog.xml">R.layout.wifi_dialog</a></p>
<pre><code>/packages/apps/Settings/src/com/android/settings/wifi/WifiDialog.java

 R.layout.wifi_dialog


             &lt;LinearLayout
                    android:layout_width=&quot;match_parent&quot;
                    android:layout_height=&quot;wrap_content&quot;
                    style=&quot;@style/wifi_item&quot; &gt;
                &lt;TextView
                        android:layout_width=&quot;wrap_content&quot;
                        android:layout_height=&quot;wrap_content&quot;
                        style=&quot;@style/wifi_item_label&quot;
                        android:text=&quot;@string/wifi_ssid&quot;   //  热点的名字
                        android:textDirection=&quot;locale&quot; /&gt;

                &lt;EditText android:id=&quot;@+id/ssid&quot;   // 输入热点密码的输入框
                        android:layout_width=&quot;match_parent&quot;
                        android:layout_height=&quot;wrap_content&quot;
                        style=&quot;@style/wifi_item_edit_content&quot;
                        android:hint=&quot;@string/wifi_ssid_hint&quot;
                        android:maxLength=&quot;32&quot;
                        android:singleLine=&quot;true&quot;
                        android:inputType=&quot;textNoSuggestions&quot; /&gt;
             &lt;/LinearLayout&gt;


                &lt;CheckBox android:id=&quot;@+id/show_password&quot;
                        android:layout_width=&quot;match_parent&quot;
                        android:layout_height=&quot;wrap_content&quot;
                        style=&quot;@style/wifi_item_content&quot;
                        android:textSize=&quot;14sp&quot;
                        android:text=&quot;@string/wifi_show_password&quot; /&gt;  // 是否明文显示密码 选框


                     &lt;Spinner android:id=&quot;@+id/ca_cert&quot;   // 证书下拉框
                            android:layout_width=&quot;match_parent&quot;
                            android:layout_height=&quot;wrap_content&quot;
                            style=&quot;@style/wifi_item_spinner&quot;
                            android:prompt=&quot;@string/wifi_eap_ca_cert&quot; /&gt;

                    &lt;TextView
                            android:layout_width=&quot;wrap_content&quot;
                            android:layout_height=&quot;wrap_content&quot;
                            style=&quot;@style/wifi_item_label&quot;
                            android:text=&quot;@string/wifi_eap_method&quot; /&gt;

                    &lt;Spinner android:id=&quot;@+id/method&quot;  // EAP 方法下拉框
                            android:layout_width=&quot;match_parent&quot;
                            android:layout_height=&quot;wrap_content&quot;
                            style=&quot;@style/wifi_item_spinner&quot;
                            android:prompt=&quot;@string/wifi_eap_method&quot;
                            android:entries=&quot;@array/wifi_eap_method&quot; /&gt;
                      &lt;Spinner android:id=&quot;@+id/phase2&quot;  // eap 阶段2 身份验证下拉框
                            android:layout_width=&quot;match_parent&quot;
                            android:layout_height=&quot;wrap_content&quot;
                            style=&quot;@style/wifi_item_spinner&quot;
                            android:prompt=&quot;@string/please_select_phase2&quot;
                            android:entries=&quot;@array/wifi_phase2_entries&quot; /&gt;



                 &lt;Spinner android:id=&quot;@+id/proxy_settings&quot;   // 代理设置 下拉框
                        android:layout_width=&quot;match_parent&quot;
                        android:layout_height=&quot;wrap_content&quot;
                        style=&quot;@style/wifi_item_spinner&quot;
                        android:prompt=&quot;@string/proxy_settings_title&quot;
                        android:entries=&quot;@array/wifi_proxy_settings&quot; /&gt;


                   &lt;Spinner android:id=&quot;@+id/ip_settings&quot;  // Ip代理设置下拉框
                        android:layout_width=&quot;match_parent&quot;
                        android:layout_height=&quot;wrap_content&quot;
                        style=&quot;@style/wifi_item_spinner&quot;
                        android:prompt=&quot;@string/wifi_ip_settings&quot;
                        android:entries=&quot;@array/wifi_ip_settings&quot; /&gt;
</code></pre><h2 id="wifi-ua15-">WIFI UA15分析</h2>
<h3 id="wifi-ua15-">WIFI UA15 操作列</h3>
<p><img src="img/7.png" width = "25%" height="25%"/><img src="img/10.png" width = "25%" height="25%"/><img src="img/11.png" width = "25%" height="25%"/>  </p>
<ol>
<li><strong>UA编号</strong>   UA15( 同UA13)</li><li><strong>UA说明</strong>  <strong>当前搜索到的网络Preference的点击事件</strong></li><li><p><strong>UA触发函数</strong>   /packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 这个Fragemnt的  WifiSettings的 onPreferenceTreeClick 为点击响应函数</p>
</li><li><p><strong>UA字符可选值</strong>    </p>
</li><li><strong>UA布局及ID</strong>    </li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>  </li><li><strong>数据库可选值 </strong>   </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>    packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java  onPreferenceTreeClick </li><li><strong>UA触发函数所在类</strong>    packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java   onPreferenceTreeClick</li></ol>
<hr>
<h3 id="wifi-ua15-">WIFI UA15 代码分析</h3>
<pre><code>/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 
    @Override
    public boolean onPreferenceTreeClick(Preference preference) {
        // If the preference has a fragment set, open that
        if (preference.getFragment() != null) {
            preference.setOnPreferenceClickListener(null);
            return super.onPreferenceTreeClick(preference);  // 如果 preference设置了 fragment 则 跳转到该 fragment
        }

        if (preference instanceof LongPressAccessPointPreference) {
            mSelectedAccessPoint = ((LongPressAccessPointPreference) preference).getAccessPoint();
            if (mSelectedAccessPoint == null) {
                return false;
            }
            if (mSelectedAccessPoint.isActive()) {  // 如果当前 AccessPoint 是 Active 活动的 则让 父类处置
                return super.onPreferenceTreeClick(preference);
            }
            /**
             * Bypass dialog and connect to unsecured networks, or previously connected saved
             * networks, or Passpoint provided networks.
             */
            WifiConfiguration config = mSelectedAccessPoint.getConfig();
            if (mSelectedAccessPoint.getSecurity() == AccessPoint.SECURITY_NONE) { // 如果当前 AccessPoint 是不需要认证的 那么直接 连接它 通过 WifiConfiguration
                mSelectedAccessPoint.generateOpenNetworkConfig();
                connect(mSelectedAccessPoint.getConfig(), mSelectedAccessPoint.isSaved());
            } else if (mSelectedAccessPoint.isSaved() &amp;&amp; config != null
                    &amp;&amp; config.getNetworkSelectionStatus() != null
                    &amp;&amp; config.getNetworkSelectionStatus().getHasEverConnected()) {
                connect(config, true /* isSavedNetwork */);
            } else if (mSelectedAccessPoint.isPasspoint()) {  // 如果当前网络是 Passpoint类型的网络 那么 直接连接 
                // Access point provided by an installed Passpoint provider, connect using
                // the associated config.
                connect(config, true /* isSavedNetwork */);
            } else {
                showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_CONNECT);  // 否则就弹出对话框  请求用户进行认证输入 已达到连接的目的
            }
        } else if (preference == mAddPreference) {
            onAddNetworkPressed(); // 如果点击的是  mAddPreference  添加网络那项 Preference  那么执行   onAddNetworkPressed() 执行添加网络的操作
        } else {
            return super.onPreferenceTreeClick(preference);
        }
        return true;
    }
</code></pre><h2 id="wifi-ua16-">WIFI UA16分析</h2>
<h3 id="wifi-ua16-">WIFI UA16 操作列</h3>
<p><img src="img/7.png" width = "25%" height="25%"/><img src="img/10.png" width = "25%" height="25%"/><img src="img/11.png" width = "25%" height="25%"/>  </p>
<ol>
<li><strong>UA编号</strong>   UA16( 同UA14)</li><li><strong>UA说明</strong>  <strong>当前搜索到的网络Preference的长按事件</strong></li><li><p><strong>UA触发函数</strong>     在 /packages/apps/Settings/src/com/android/settings/wifi/LongPressAccessPointPreference.java 函数onBindViewHolder 设置了 setOnCreateContextMenuListener(mFragment)<br>/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java这个Fragemnt 以及s etLongClickable(true);   来接受长按事件 </p>
</li><li><p><strong>UA字符可选值</strong>    </p>
</li><li><strong>UA布局及ID</strong>    </li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>  </li><li><strong>数据库可选值 </strong>   </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>    </li><li><strong>UA触发函数所在类</strong>   </li></ol>
<hr>
<h3 id="wifi-ua16-">WIFI UA16 代码分析</h3>
<p><img src="img/27.png" width = "25%" height="25%"/></p>
<pre><code>
/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
    @Override
    public void onCreateContextMenu(ContextMenu menu, View view, ContextMenuInfo info) { // 长按 AccessPoint时触发的函数
            Preference preference = (Preference) view.getTag();

            if (preference instanceof LongPressAccessPointPreference) {

            //  private AccessPoint mSelectedAccessPoint;  用户长按的Prference 对应的  AccessPoint 
                mSelectedAccessPoint =((LongPressAccessPointPreference) preference).getAccessPoint();
                menu.setHeaderTitle(mSelectedAccessPoint.getSsid()); //  长按 显示的第一个项  为 热点的名字
                if (mSelectedAccessPoint.isConnectable()) {  // 如果当前网络热点有信号 的话 isConnectable() = true
                //   &lt;string name=&quot;wifi_menu_connect&quot; msgid=&quot;4996220309848349408&quot;&gt;&quot;连接到网络&quot;&lt;/string&gt;    显示  连接到网络 
                    menu.add(Menu.NONE, MENU_ID_CONNECT, 0, R.string.wifi_menu_connect);
                }

                WifiConfiguration config = mSelectedAccessPoint.getConfig();
                // Some configs are ineditable
                if (isEditabilityLockedDown(getActivity(), config)) {  // 判断该热点对应的 WifiConfiguration 是否可修改
                    return;
                }

                if (mSelectedAccessPoint.isSaved() || mSelectedAccessPoint.isEphemeral()) { // 如果当前preference 对应的AccessPoint 是已保存过 或是 临时的话  显示
                    // Allow forgetting a network if either the network is saved or ephemerally
                    // connected. (In the latter case, &quot;forget&quot; blacklists the network so it won&#39;t
                    // be used again, ephemerally).
                    // &lt;string name=&quot;wifi_menu_forget&quot; msgid=&quot;8736964302477327114&quot;&gt;&quot;取消保存网络&quot;&lt;/string&gt;
                    menu.add(Menu.NONE, MENU_ID_FORGET, 0, R.string.wifi_menu_forget);
                }
                if (mSelectedAccessPoint.isSaved()) {
                //  &lt;string name=&quot;wifi_menu_modify&quot; msgid=&quot;2068554918652440105&quot;&gt;&quot;修改网络&quot;&lt;/string&gt;
                    menu.add(Menu.NONE, MENU_ID_MODIFY, 0, R.string.wifi_menu_modify);
                    NfcAdapter nfcAdapter = NfcAdapter.getDefaultAdapter(getActivity());
                    if (nfcAdapter != null &amp;&amp; nfcAdapter.isEnabled() &amp;&amp; mSelectedAccessPoint.getSecurity() != AccessPoint.SECURITY_NONE) {
                        // Only allow writing of NFC tags for password-protected networks.
                        // &lt;string name=&quot;wifi_menu_write_to_nfc&quot; msgid=&quot;7692881642188240324&quot;&gt;&quot;写入NFC标签&quot;&lt;/string&gt;  只在 NFC有效的条件下
                        menu.add(Menu.NONE, MENU_ID_WRITE_NFC, 0, R.string.wifi_menu_write_to_nfc);
                    }
                }
            }
    }
</code></pre><h2 id="wifi-ua17-">WIFI UA17分析</h2>
<h3 id="wifi-ua17-">WIFI UA17 操作列</h3>
<p><img src="img/8.png" width = "25%" height="25%"/></p>
<ol>
<li><strong>UA编号</strong>   UA17</li><li><strong>UA说明</strong>  <strong>添加网络的Preference点击事件</strong></li><li><p><strong>UA触发函数</strong>   packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java   onPreferenceTreeClick<br>/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java  private Preference mAddPreference; mAddPreference对应 添加网络Preference</p>
</li><li><p><strong>UA字符可选值</strong>    </p>
</li><li><strong>UA布局及ID</strong>    </li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>  </li><li><strong>数据库可选值 </strong>   </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>    </li><li><strong>UA触发函数所在类</strong>   </li></ol>
<hr>
<h3 id="wifi-ua17-">WIFI UA17 代码分析</h3>
<pre><code>

/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 

private Preference mAddPreference;



    @Override
    public void onCreate(Bundle icicle) {
        Context prefContext = getPrefContext();
        mAddPreference = new Preference(prefContext);
        mAddPreference.setIcon(R.drawable.ic_menu_add_inset);
        mAddPreference.setTitle(R.string.wifi_add_network);   // &lt;string name=&quot;wifi_add_network&quot; msgid=&quot;6234851776910938957&quot;&gt;&quot;添加网络&quot;&lt;/string&gt;
        mAccessPointsPreferenceCategory.addPreference(mAddPreference);
       }




    @Override
    public boolean onPreferenceTreeClick(Preference preference) {
        // If the preference has a fragment set, open that
        if (preference.getFragment() != null) {
            preference.setOnPreferenceClickListener(null);
            return super.onPreferenceTreeClick(preference);  // 如果 preference设置了 fragment 则 跳转到该 fragment
        }

        if (preference instanceof LongPressAccessPointPreference) {
            mSelectedAccessPoint = ((LongPressAccessPointPreference) preference).getAccessPoint();
            if (mSelectedAccessPoint == null) {
                return false;
            }
            if (mSelectedAccessPoint.isActive()) {  // 如果当前 AccessPoint 是 Active 活动的 则让 父类处置
                return super.onPreferenceTreeClick(preference);
            }
            /**
             * Bypass dialog and connect to unsecured networks, or previously connected saved
             * networks, or Passpoint provided networks.
             */
            WifiConfiguration config = mSelectedAccessPoint.getConfig();
            if (mSelectedAccessPoint.getSecurity() == AccessPoint.SECURITY_NONE) { // 如果当前 AccessPoint 是不需要认证的 那么直接 连接它 通过 WifiConfiguration
                mSelectedAccessPoint.generateOpenNetworkConfig();
                connect(mSelectedAccessPoint.getConfig(), mSelectedAccessPoint.isSaved());
            } else if (mSelectedAccessPoint.isSaved() &amp;&amp; config != null
                    &amp;&amp; config.getNetworkSelectionStatus() != null
                    &amp;&amp; config.getNetworkSelectionStatus().getHasEverConnected()) {
                connect(config, true /* isSavedNetwork */);
            } else if (mSelectedAccessPoint.isPasspoint()) {  // 如果当前网络是 Passpoint类型的网络 那么 直接连接 
                // Access point provided by an installed Passpoint provider, connect using
                // the associated config.
                connect(config, true /* isSavedNetwork */);
            } else {
                showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_CONNECT);  // 否则就弹出对话框  请求用户进行认证输入 已达到连接的目的
            }
        } else if (preference == mAddPreference) {
            onAddNetworkPressed(); // 如果点击的是  mAddPreference  添加网络那项 Preference  那么执行   onAddNetworkPressed() 执行添加网络的操作
        } else {
            return super.onPreferenceTreeClick(preference);
        }
        return true;
    }




/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 


void onAddNetworkPressed() {
        mMetricsFeatureProvider.action(getActivity(), MetricsEvent.ACTION_WIFI_ADD_NETWORK);
        // No exact access point is selected.
        mSelectedAccessPoint = null;
        showDialog(null, WifiConfigUiBase.MODE_CONNECT); // 显示 添加网络的Dialog
    }


/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 
    private void showDialog(AccessPoint accessPoint, int dialogMode) {
        if (accessPoint != null) {
            WifiConfiguration config = accessPoint.getConfig();
            if (isEditabilityLockedDown(getActivity(), config) &amp;&amp; accessPoint.isActive()) {
                RestrictedLockUtils.sendShowAdminSupportDetailsIntent(getActivity(),
                        RestrictedLockUtils.getDeviceOwner(getActivity()));
                return;
            }
        }
        if (mDialog != null) {
            removeDialog(WIFI_DIALOG_ID);
            mDialog = null;
        }

        // Save the access point and edit mode
        mDlgAccessPoint = accessPoint;  // 为空  null
        mDialogMode = dialogMode;  

        showDialog(WIFI_DIALOG_ID); // showDialog
    }



/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 
    @Override
    public Dialog onCreateDialog(int dialogId) {
        switch (dialogId) {
            case WIFI_DIALOG_ID:
                AccessPoint ap = mDlgAccessPoint; // For manual launch
                if (ap == null) { // For re-launch from saved state
                    if (mAccessPointSavedState != null) {
                        ap = new AccessPoint(getActivity(), mAccessPointSavedState);
                        // For repeated orientation changes
                        mDlgAccessPoint = ap;
                        // Reset the saved access point data
                        mAccessPointSavedState = null;
                    }
                }
                // If it&#39;s null, fine, it&#39;s for Add Network
                mSelectedAccessPoint = ap;
                mDialog = new WifiDialog(getActivity(), this, ap, mDialogMode【WifiConfigUiBase.MODE_CONNECT】,/* no hide submit/connect */ false);  // 
                return mDialog;
                ......
             }

/packages/apps/Settings/src/com/android/settings/wifi/WifiDialog.java

private WifiConfigController mController;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        mView = getLayoutInflater().inflate(R.layout.wifi_dialog, null);
        setView(mView);
        setInverseBackgroundForced(true);
        mController = new WifiConfigController(this, mView, mAccessPoint 【NULL】, mMode 【WifiConfigUiBase.MODE_CONNECT】); // 依据 新建了 WifiConfigController  业务交由WifiConfigController实现
        super.onCreate(savedInstanceState);

        if (mHideSubmitButton) {
            mController.hideSubmitButton();
        } else {
            /* During creation, the submit button can be unavailable to determine
             * visibility. Right after creation, update button visibility */
            mController.enableSubmitIfAppropriate();
        }

        if (mAccessPoint == null) {
            mController.hideForgetButton();
        }
    }



/packages/apps/Settings/src/com/android/settings/wifi/WifiConfigController.java

          public WifiConfigController(WifiConfigUiBase parent, View view, AccessPoint accessPoint【null】,int mode 【WifiConfigUiBase.MODE_CONNECT】) {
        mConfigUi = parent;

        mView = view;
        mAccessPoint = accessPoint;
        mAccessPointSecurity = (accessPoint == null) ? AccessPoint.SECURITY_NONE : accessPoint.getSecurity();  // mAccessPointSecurity在此等于  AccessPoint.SECURITY_NONE
        mMode = mode;

        mTextViewChangedHandler = new Handler();
        mContext = mConfigUi.getContext();
        final Resources res = mContext.getResources();

//    &lt;string-array name=&quot;wifi_signal&quot;&gt;
//       &lt;item&gt;Poor&lt;/item&gt;
//        &lt;item&gt;Poor&lt;/item&gt;
//        &lt;item&gt;Fair&lt;/item&gt;
//        &lt;item&gt;Good&lt;/item&gt;
//       &lt;item&gt;Excellent&lt;/item&gt;
//    &lt;/string-array&gt;

        mLevels = res.getStringArray(R.array.wifi_signal);
        // &lt;bool name=&quot;config_eap_sim_based_auth_supported&quot;&gt;true&lt;/bool&gt;
        if (Utils.isWifiOnly(mContext) || !mContext.getResources().getBoolean(com.android.internal.R.bool.config_eap_sim_based_auth_supported)) {

//  &lt;string-array name=&quot;wifi_peap_phase2_entries&quot;&gt;
//    &lt;item msgid=&quot;2577747762745812488&quot;&gt;&quot;无&quot;&lt;/item&gt;
//    &lt;item msgid=&quot;937786527870979616&quot;&gt;&quot;MSCHAPV2&quot;&lt;/item&gt;
//    &lt;item msgid=&quot;5302613883318643629&quot;&gt;&quot;GTC&quot;&lt;/item&gt;
//  &lt;/string-array&gt;

            mPhase2PeapAdapter = new ArrayAdapter&lt;String&gt;( mContext, android.R.layout.simple_spinner_item,res.getStringArray(R.array.wifi_peap_phase2_entries));
        } else {


//&lt;string-array name=&quot;wifi_peap_phase2_entries_with_sim_auth&quot;&gt;
//    &lt;item msgid=&quot;5760470455461128892&quot;&gt;&quot;无&quot;&lt;/item&gt;
 //   &lt;item msgid=&quot;7480272092408291086&quot;&gt;&quot;MSCHAPV2&quot;&lt;/item&gt;
//    &lt;item msgid=&quot;5881794903338319324&quot;&gt;&quot;GTC&quot;&lt;/item&gt;
 //   &lt;item msgid=&quot;5610607665198791980&quot;&gt;&quot;SIM&quot;&lt;/item&gt;
 //   &lt;item msgid=&quot;2860798636241124128&quot;&gt;&quot;AKA&quot;&lt;/item&gt;
 //   &lt;item msgid=&quot;8926455723452645935&quot;&gt;&quot;AKA\&#39;&quot;&lt;/item&gt;
 // &lt;/string-array&gt;

            mPhase2PeapAdapter = new ArrayAdapter&lt;String&gt;(mContext, android.R.layout.simple_spinner_item,res.getStringArray(R.array.wifi_peap_phase2_entries_with_sim_auth));
        }
        mPhase2PeapAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);


// &lt;string-array name=&quot;wifi_phase2_entries&quot;&gt;
//    &lt;item msgid=&quot;1818786254010764570&quot;&gt;&quot;无&quot;&lt;/item&gt;
//    &lt;item msgid=&quot;6189918678874123056&quot;&gt;&quot;PAP&quot;&lt;/item&gt;
//    &lt;item msgid=&quot;1524112260493662517&quot;&gt;&quot;MSCHAP&quot;&lt;/item&gt;
//    &lt;item msgid=&quot;5923246669412752932&quot;&gt;&quot;MSCHAPV2&quot;&lt;/item&gt;
//    &lt;item msgid=&quot;8651992560135239389&quot;&gt;&quot;GTC&quot;&lt;/item&gt;
//  &lt;/string-array&gt;


        mPhase2FullAdapter = new ArrayAdapter&lt;String&gt;(mContext, android.R.layout.simple_spinner_item,res.getStringArray(R.array.wifi_phase2_entries));


        mPhase2FullAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);

// &lt;string name=&quot;wifi_unspecified&quot; msgid=&quot;4917316464723064807&quot;&gt;&quot;请选择&quot;&lt;/string&gt;
        mUnspecifiedCertString = mContext.getString(R.string.wifi_unspecified);

        // &lt;string name=&quot;wifi_multiple_cert_added&quot; msgid=&quot;3240743501460165224&quot;&gt;&quot;（已添加多份证书）&quot;&lt;/string&gt;
        mMultipleCertSetString = mContext.getString(R.string.wifi_multiple_cert_added);

//  &lt;string name=&quot;wifi_use_system_certs&quot; msgid=&quot;5270879895056893783&quot;&gt;&quot;使用系统证书&quot;&lt;/string&gt;
        mUseSystemCertsString = mContext.getString(R.string.wifi_use_system_certs);


// &lt;string name=&quot;wifi_do_not_provide_eap_user_cert&quot; msgid=&quot;5160499244977160665&quot;&gt;&quot;不提供&quot;&lt;/string&gt;
        mDoNotProvideEapUserCertString = mContext.getString(R.string.wifi_do_not_provide_eap_user_cert);

       // &lt;string name=&quot;wifi_do_not_validate_eap_server&quot; msgid=&quot;4266754430576348471&quot;&gt;&quot;不验证&quot;&lt;/string&gt;
        mDoNotValidateEapServerString = mContext.getString(R.string.wifi_do_not_validate_eap_server);

        mIpSettingsSpinner = (Spinner) mView.findViewById(R.id.ip_settings);
        mIpSettingsSpinner.setOnItemSelectedListener(this);
        mProxySettingsSpinner = (Spinner) mView.findViewById(R.id.proxy_settings);
        mProxySettingsSpinner.setOnItemSelectedListener(this);
        mSharedCheckBox = (CheckBox) mView.findViewById(R.id.shared);

        if (mAccessPoint == null) { // new network  // 当前的 AccessPoint为空 说明是 需要 新增 网络
            mConfigUi.setTitle(R.string.wifi_add_network);  // &lt;string name=&quot;wifi_add_network&quot; msgid=&quot;6234851776910938957&quot;&gt;&quot;添加网络&quot;&lt;/string&gt;

            mSsidView = (TextView) mView.findViewById(R.id.ssid);
            mSsidView.addTextChangedListener(this);
            mSecuritySpinner = ((Spinner) mView.findViewById(R.id.security));
            mSecuritySpinner.setOnItemSelectedListener(this);
            mView.findViewById(R.id.type).setVisibility(View.VISIBLE);

            showIpConfigFields();
            showProxyFields();
            mView.findViewById(R.id.wifi_advanced_toggle).setVisibility(View.VISIBLE);
            ((CheckBox) mView.findViewById(R.id.wifi_advanced_togglebox)).setOnCheckedChangeListener(this);
            mConfigUi.setSubmitButton(res.getString(R.string.wifi_save));  // &lt;string name=&quot;wifi_save&quot; msgid=&quot;3331121567988522826&quot;&gt;&quot;保存&quot;&lt;/string&gt;
        } else {
            if (!mAccessPoint.isPasspointConfig()) {
                mConfigUi.setTitle(mAccessPoint.getSsid());
            } else {
                mConfigUi.setTitle(mAccessPoint.getConfigName());
            }

            ViewGroup group = (ViewGroup) mView.findViewById(R.id.info);

            boolean showAdvancedFields = false;
            if (mAccessPoint.isSaved()) {
                WifiConfiguration config = mAccessPoint.getConfig();
                if (config.getIpAssignment() == IpAssignment.STATIC) {
                    mIpSettingsSpinner.setSelection(STATIC_IP);
                    showAdvancedFields = true;
                    // Display IP address.
                    StaticIpConfiguration staticConfig = config.getStaticIpConfiguration();
                    if (staticConfig != null &amp;&amp; staticConfig.ipAddress != null) {
                   // &lt;string name=&quot;wifi_ip_address&quot; msgid=&quot;1440054061044402918&quot;&gt;&quot;IP 地址&quot;&lt;/string&gt;
                    addRow(group, R.string.wifi_ip_address,staticConfig.ipAddress.getAddress().getHostAddress());
                    }
                } else {
                    mIpSettingsSpinner.setSelection(DHCP);
                }

                mSharedCheckBox.setEnabled(config.shared);
                if (!config.shared) {
                    showAdvancedFields = true;
                }

                if (config.getProxySettings() == ProxySettings.STATIC) {
                    mProxySettingsSpinner.setSelection(PROXY_STATIC);
                    showAdvancedFields = true;
                } else if (config.getProxySettings() == ProxySettings.PAC) {
                    mProxySettingsSpinner.setSelection(PROXY_PAC);
                    showAdvancedFields = true;
                } else {
                    mProxySettingsSpinner.setSelection(PROXY_NONE);
                }
                if (config != null &amp;&amp; config.isPasspoint()) {
                // &lt;string name=&quot;passpoint_label&quot; msgid=&quot;6381371313076009926&quot;&gt;&quot;保存方式：&quot;&lt;/string&gt;  
                // &lt;string name=&quot;passpoint_content&quot; msgid=&quot;8447207162397870483&quot;&gt;&quot;&lt;xliff:g id=&quot;NAME&quot;&gt;%1$s&lt;/xliff:g&gt;凭据&quot;&lt;/string&gt;
                    addRow(group, R.string.passpoint_label,String.format(mContext.getString(R.string.passpoint_content),config.providerFriendlyName));
                }
            }

            if ((!mAccessPoint.isSaved() &amp;&amp; !mAccessPoint.isActive() &amp;&amp; !mAccessPoint.isPasspointConfig()) || mMode != WifiConfigUiBase.MODE_VIEW) {
                showSecurityFields();
                showIpConfigFields();
                showProxyFields();
                final CheckBox advancedTogglebox = (CheckBox) mView.findViewById(R.id.wifi_advanced_togglebox); //高级设置选项
                mView.findViewById(R.id.wifi_advanced_toggle).setVisibility(View.VISIBLE);
                advancedTogglebox.setOnCheckedChangeListener(this);
                advancedTogglebox.setChecked(showAdvancedFields);
                mView.findViewById(R.id.wifi_advanced_fields).setVisibility(showAdvancedFields ? View.VISIBLE : View.GONE);
            }

            if (mMode == WifiConfigUiBase.MODE_MODIFY) { // 如果是 修改模式的话
                mConfigUi.setSubmitButton(res.getString(R.string.wifi_save));  //   &lt;string name=&quot;wifi_save&quot; msgid=&quot;3331121567988522826&quot;&gt;&quot;保存&quot;&lt;/string&gt;
            } else if (mMode == WifiConfigUiBase.MODE_CONNECT) {
                mConfigUi.setSubmitButton(res.getString(R.string.wifi_connect));
            } else {
                final DetailedState state = mAccessPoint.getDetailedState();
                final String signalLevel = getSignalString();

                if ((state == null || state == DetailedState.DISCONNECTED) &amp;&amp; signalLevel != null) {
                    mConfigUi.setSubmitButton(res.getString(R.string.wifi_connect));  // &lt;string name=&quot;wifi_connect&quot; msgid=&quot;1076622875777072845&quot;&gt;&quot;连接&quot;&lt;/string&gt; 
                } else {
                    if (state != null) {
                        boolean isEphemeral = mAccessPoint.isEphemeral();
                        WifiConfiguration config = mAccessPoint.getConfig();
                        String providerFriendlyName = null;
                        if (config != null &amp;&amp; config.isPasspoint()) {
                            providerFriendlyName = config.providerFriendlyName;
                        }
                        String summary = AccessPoint.getSummary(mConfigUi.getContext(), state, isEphemeral, providerFriendlyName);
                        //  &lt;string name=&quot;wifi_status&quot; msgid=&quot;4824568012414605414&quot;&gt;&quot;状态信息&quot;&lt;/string&gt;
                        addRow(group, R.string.wifi_status, summary);
                    }

                    if (signalLevel != null) {
                        addRow(group, R.string.wifi_signal, signalLevel);  //  &lt;string name=&quot;wifi_signal&quot; msgid=&quot;5514120261628065287&quot;&gt;&quot;信号强度&quot;&lt;/string&gt;
                    }

                    WifiInfo info = mAccessPoint.getInfo();
                    if (info != null &amp;&amp; info.getLinkSpeed() != -1) {
                    //  &lt;string name=&quot;wifi_speed&quot; msgid=&quot;3526198708812322037&quot;&gt;&quot;连接速度&quot;&lt;/string&gt;  
                    //  &lt;string name=&quot;link_speed&quot; msgid=&quot;8896664974117585555&quot;&gt;&quot;%1$d Mbps&quot;&lt;/string&gt;
                        addRow(group, R.string.wifi_speed, String.format(res.getString(R.string.link_speed), info.getLinkSpeed()));
                    }

                    if (info != null &amp;&amp; info.getFrequency() != -1) {
                        final int frequency = info.getFrequency();
                        String band = null;

                        if (frequency &gt;= AccessPoint.LOWER_FREQ_24GHZ  &amp;&amp; frequency &lt; AccessPoint.HIGHER_FREQ_24GHZ) {
                            band = res.getString(R.string.wifi_band_24ghz);  // &lt;string name=&quot;wifi_band_24ghz&quot; msgid=&quot;852929254171856911&quot;&gt;&quot;2.4 GHz&quot;&lt;/string&gt;
                        } else if (frequency &gt;= AccessPoint.LOWER_FREQ_5GHZ &amp;&amp; frequency &lt; AccessPoint.HIGHER_FREQ_5GHZ) {
                            band = res.getString(R.string.wifi_band_5ghz);  // &lt;string name=&quot;wifi_band_5ghz&quot; msgid=&quot;6433822023268515117&quot;&gt;&quot;5 GHz&quot;&lt;/string&gt;
                        } else {
                            Log.e(TAG, &quot;Unexpected frequency &quot; + frequency);
                        }
                        if (band != null) {
                            addRow(group, R.string.wifi_frequency, band);
                        }
                    }
//   &lt;string name=&quot;wifi_security&quot; msgid=&quot;6603611185592956936&quot;&gt;&quot;安全性&quot;&lt;/string&gt;
                    addRow(group, R.string.wifi_security, mAccessPoint.getSecurityString(false));
                    mView.findViewById(R.id.ip_fields).setVisibility(View.GONE);
                }
                if (mAccessPoint.isSaved() || mAccessPoint.isActive() || mAccessPoint.isPasspointConfig()) {
                    mConfigUi.setForgetButton(res.getString(R.string.wifi_forget));    //  &lt;string name=&quot;wifi_forget&quot; msgid=&quot;8168174695608386644&quot;&gt;&quot;取消保存&quot;&lt;/string&gt;
                }
            }
        }

        if (!isSplitSystemUser()) {
            mSharedCheckBox.setVisibility(View.GONE);
        }

        mConfigUi.setCancelButton(res.getString(R.string.wifi_cancel));  // &lt;string name=&quot;wifi_cancel&quot; msgid=&quot;6763568902542968964&quot;&gt;&quot;取消&quot;&lt;/string&gt;
        if (mConfigUi.getSubmitButton() != null) {
            enableSubmitIfAppropriate();
        }
    }
</code></pre><h3 id="ua17-">UA17  布局分析</h3>
<p><a href="file/wifi_dialog.xml">R.layout.wifi_dialog</a></p>
<pre><code>/packages/apps/Settings/src/com/android/settings/wifi/WifiDialog.java

 R.layout.wifi_dialog


             &lt;LinearLayout
                    android:layout_width=&quot;match_parent&quot;
                    android:layout_height=&quot;wrap_content&quot;
                    style=&quot;@style/wifi_item&quot; &gt;
                &lt;TextView
                        android:layout_width=&quot;wrap_content&quot;
                        android:layout_height=&quot;wrap_content&quot;
                        style=&quot;@style/wifi_item_label&quot;
                        android:text=&quot;@string/wifi_ssid&quot;   //  热点的名字
                        android:textDirection=&quot;locale&quot; /&gt;

                &lt;EditText android:id=&quot;@+id/ssid&quot;   // 输入热点密码的输入框
                        android:layout_width=&quot;match_parent&quot;
                        android:layout_height=&quot;wrap_content&quot;
                        style=&quot;@style/wifi_item_edit_content&quot;
                        android:hint=&quot;@string/wifi_ssid_hint&quot;
                        android:maxLength=&quot;32&quot;
                        android:singleLine=&quot;true&quot;
                        android:inputType=&quot;textNoSuggestions&quot; /&gt;
             &lt;/LinearLayout&gt;


                &lt;CheckBox android:id=&quot;@+id/show_password&quot;
                        android:layout_width=&quot;match_parent&quot;
                        android:layout_height=&quot;wrap_content&quot;
                        style=&quot;@style/wifi_item_content&quot;
                        android:textSize=&quot;14sp&quot;
                        android:text=&quot;@string/wifi_show_password&quot; /&gt;  // 是否明文显示密码 选框


                     &lt;Spinner android:id=&quot;@+id/ca_cert&quot;   // 证书下拉框
                            android:layout_width=&quot;match_parent&quot;
                            android:layout_height=&quot;wrap_content&quot;
                            style=&quot;@style/wifi_item_spinner&quot;
                            android:prompt=&quot;@string/wifi_eap_ca_cert&quot; /&gt;

                    &lt;TextView
                            android:layout_width=&quot;wrap_content&quot;
                            android:layout_height=&quot;wrap_content&quot;
                            style=&quot;@style/wifi_item_label&quot;
                            android:text=&quot;@string/wifi_eap_method&quot; /&gt;

                    &lt;Spinner android:id=&quot;@+id/method&quot;  // EAP 方法下拉框
                            android:layout_width=&quot;match_parent&quot;
                            android:layout_height=&quot;wrap_content&quot;
                            style=&quot;@style/wifi_item_spinner&quot;
                            android:prompt=&quot;@string/wifi_eap_method&quot;
                            android:entries=&quot;@array/wifi_eap_method&quot; /&gt;
                      &lt;Spinner android:id=&quot;@+id/phase2&quot;  // eap 阶段2 身份验证下拉框
                            android:layout_width=&quot;match_parent&quot;
                            android:layout_height=&quot;wrap_content&quot;
                            style=&quot;@style/wifi_item_spinner&quot;
                            android:prompt=&quot;@string/please_select_phase2&quot;
                            android:entries=&quot;@array/wifi_phase2_entries&quot; /&gt;



                 &lt;Spinner android:id=&quot;@+id/proxy_settings&quot;   // 代理设置 下拉框
                        android:layout_width=&quot;match_parent&quot;
                        android:layout_height=&quot;wrap_content&quot;
                        style=&quot;@style/wifi_item_spinner&quot;
                        android:prompt=&quot;@string/proxy_settings_title&quot;
                        android:entries=&quot;@array/wifi_proxy_settings&quot; /&gt;


                   &lt;Spinner android:id=&quot;@+id/ip_settings&quot;  // Ip代理设置下拉框
                        android:layout_width=&quot;match_parent&quot;
                        android:layout_height=&quot;wrap_content&quot;
                        style=&quot;@style/wifi_item_spinner&quot;
                        android:prompt=&quot;@string/wifi_ip_settings&quot;
                        android:entries=&quot;@array/wifi_ip_settings&quot; /&gt;
</code></pre><h2 id="wifi-ua18-ua5-">WIFI UA18分析  (同UA5)</h2>
<h3 id="wifi-ua18-">WIFI UA18 操作列</h3>
<p><img src="img/8.png" width = "25%" height="25%"/><img src="img/4.png" width = "25%" height="25%"/><img src="img/5.png" width = "25%" height="25%"/></p>
<ol>
<li><strong>UA编号</strong>   UA18</li><li><strong>UA说明</strong>  <strong>Wifi Preference 偏好设置的 Preference点击事件</strong> android:key=&quot;configure_settings&quot;</li><li><strong>UA触发函数</strong>   packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 的布局文件 wifi_settings.xml 中 指定了 点击打开的Fragment ConfigureWifiSettings 具体的逻辑事件同 UA13<br>WifiSettings.java onPreferenceTreeClick 是它的触发函数   该Preference无长按事件<pre><code>   &lt;Preference
         android:key=&quot;configure_settings&quot;  // &lt;string name=&quot;wifi_configure_settings_preference_title&quot; &gt;&quot;WLAN 偏好设置&quot;&lt;/string&gt;   WLAN偏好设置选项
         android:title=&quot;@string/wifi_configure_settings_preference_title&quot;
         android:fragment=&quot;com.android.settings.wifi.ConfigureWifiSettings&quot; /&gt; 
</code></pre></li><li><strong>UA字符可选值</strong>    </li><li><strong>UA布局及ID</strong>    </li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>  </li><li><strong>数据库可选值 </strong>   </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>    </li><li><strong>UA触发函数所在类</strong>   </li></ol>
<hr>
<h3 id="wifi-ua18-">WIFI UA18 代码分析</h3>
<pre><code> /packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 
  @Override
    public boolean onPreferenceTreeClick(Preference preference) {
        // If the preference has a fragment set, open that
        if (preference.getFragment() != null) { 
//  如果当前 从 preference获取的 Fragment 不为 空  那么  调用   super.onPreferenceTreeClick(preference)  
// xml   文件 定义了 该 Fragment   SavedAccessPointsWifiSettings
            preference.setOnPreferenceClickListener(null);
            return super.onPreferenceTreeClick(preference);
        }



/packages/apps/Settings/src/com/android/settings/wifi/ConfigureWifiSettings.java

public class ConfigureWifiSettings extends DashboardFragment {


    @Override
    protected int getPreferenceScreenResId() {
        return R.xml.wifi_configure_settings;  //  wifi偏好设置的 xml布局文件
    }



    @Override
    protected List&lt;PreferenceController&gt; getPreferenceControllers(Context context) {  //  添加各个 List&lt;PreferenceController&gt; controllers 到界面
        final NetworkScoreManagerWrapper networkScoreManagerWrapper = new NetworkScoreManagerWrapper(context.getSystemService(NetworkScoreManager.class));
        mUseOpenWifiPreferenceController = new UseOpenWifiPreferenceController(context, this, networkScoreManagerWrapper, getLifecycle());
        final WifiManager wifiManager = (WifiManager) getSystemService(WIFI_SERVICE);
        final List&lt;PreferenceController&gt; controllers = new ArrayList&lt;&gt;();
        controllers.add(new WifiWakeupPreferenceController(context, getLifecycle()));
        controllers.add(new NetworkScorerPickerPreferenceController(context,  networkScoreManagerWrapper));
        controllers.add(new NotifyOpenNetworksPreferenceController(context, getLifecycle()));
        controllers.add(mUseOpenWifiPreferenceController);
        controllers.add(new WifiSleepPolicyPreferenceController(context));
        controllers.add(new WifiInfoPreferenceController(context, getLifecycle(), wifiManager));
        controllers.add(new CellularFallbackPreferenceController(context));
        controllers.add(new WifiP2pPreferenceController(context, getLifecycle(), wifiManager));
        controllers.add(new WifiCallingPreferenceController(context));
        controllers.add(new WpsPreferenceController( context, getLifecycle(), wifiManager, getFragmentManager()));
        return controllers;
    }




############
/frameworks/base/core/java/android/preference/PreferenceFragment.java    WifiSettings.java  的 爷爷类
    public boolean onPreferenceTreeClick(PreferenceScreen preferenceScreen, Preference preference) {
        if (preference.getFragment() != null &amp;&amp; getActivity() instanceof OnPreferenceStartFragmentCallback) {
            return ((OnPreferenceStartFragmentCallback)getActivity()【SettingsActivity】).onPreferenceStartFragment(this, preference); // 调用 onPreferenceStartFragment
        }
        return false;
    }


/packages/apps/Settings/src/com/android/settings/SettingsActivity.java
public class SettingsActivity extends SettingsDrawerActivity
        implements PreferenceManager.OnPreferenceTreeClickListener,
        PreferenceFragment.OnPreferenceStartFragmentCallback【由于当前的Activity SettingsActivity 实现了  PreferenceFragment.OnPreferenceStartFragmentCallback 接口】,
        // 所以 调用到了 SettingsActivity 方法实现的接口方法 onPreferenceStartFragment
        ButtonBarHandler, FragmentManager.OnBackStackChangedListener {


    @Override
    public boolean onPreferenceStartFragment(PreferenceFragment caller, Preference pref) {
        startPreferencePanel(caller, pref.getFragment(), pref.getExtras(), -1, pref.getTitle(), null, 0);  //
        return true;
    }


    public void startPreferencePanel(Fragment caller, String fragmentClass, Bundle args,int titleRes, CharSequence titleText, Fragment resultTo, int resultRequestCode) {
        String title = null;
        if (titleRes &lt; 0) {
            if (titleText != null) {
                title = titleText.toString();
            } else {
                title = &quot;&quot;;
            }
        }
        // 完成 跳转
        Utils.startWithFragment(this, fragmentClass, args, resultTo, resultRequestCode,titleRes, title, mIsShortcut, mMetricsFeatureProvider.getMetricsCategory(caller));
    }
    }


    /packages/apps/Settings/src/com/android/settings/Utils.java

public static void startWithFragment(Context context, String fragmentName, Bundle args,Fragment resultTo, int resultRequestCode, int titleResId,CharSequence title, int metricsCategory) {
        startWithFragment(context, fragmentName, args, resultTo, resultRequestCode,null /* titleResPackageName */, titleResId, title, false /* not a shortcut */, metricsCategory);
    }
</code></pre><h3 id="wifi-ua18-">WIFI UA18 布局分析</h3>
<p>R.xml.wifi_settings.xml 布局文件</p>
<pre><code>R.xml.wifi_settings.xml    android:key=&quot;configure_settings&quot;    WLAN偏好设置选项
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

&lt;PreferenceScreen
        xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
        xmlns:settings=&quot;http://schemas.android.com/apk/res/com.android.settings&quot;
        android:title=&quot;@string/wifi_settings&quot;  // values-zh-rCN/  &lt;string name=&quot;wifi_settings&quot; msgid=&quot;29722149822540994&quot;&gt;&quot;WLAN&quot;&lt;/string&gt;
        settings:keywords=&quot;@string/keywords_wifi&quot;&gt;

    &lt;PreferenceCategory android:key=&quot;connected_access_point&quot; /&gt;  // 当前已连接的热点显示的Preference 

    &lt;PreferenceCategory android:key=&quot;access_points&quot;/&gt;  // 当前手机扫描到的热点的列表

    &lt;PreferenceCategory android:key=&quot;additional_settings&quot;&gt; // 添加网络 Preference Item
        &lt;Preference
                android:key=&quot;configure_settings&quot;  // &lt;string name=&quot;wifi_configure_settings_preference_title&quot; &gt;&quot;WLAN 偏好设置&quot;&lt;/string&gt;   WLAN偏好设置选项
                android:title=&quot;@string/wifi_configure_settings_preference_title&quot;
                android:fragment=&quot;com.android.settings.wifi.ConfigureWifiSettings&quot; /&gt;  // 偏好设置选项显示的Fragment   ConfigureWifiSettings

        &lt;Preference
                android:key=&quot;saved_networks&quot;      // &lt;string name=&quot;wifi_saved_access_points_label&quot;&gt;&quot;已保存的网络&quot;&lt;/string&gt; 
                android:title=&quot;@string/wifi_saved_access_points_label&quot;
                android:fragment=&quot;com.android.settings.wifi.SavedAccessPointsWifiSettings&quot; /&gt;  // 已保存的网络显示的Fragment   SavedAccessPointsWifiSettings
    &lt;/PreferenceCategory&gt; 
&lt;/PreferenceScreen&gt;



R.xml.wifi_display_saved_access_points  // 已保存热点的布局文件

&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;PreferenceScreen xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:title=&quot;@string/wifi_display_settings_title&quot;&gt;  // &lt;string name=&quot;wifi_display_settings_title&quot; msgid=&quot;8740852850033480136&quot;&gt;&quot;投射&quot;&lt;/string&gt;
&lt;/PreferenceScreen&gt;




R.xml.wifi_configure_settings
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

&lt;PreferenceScreen
        xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
        xmlns:settings=&quot;http://schemas.android.com/apk/res/com.android.settings&quot;
        android:title=&quot;@string/wifi_configure_titlebar&quot;&gt;

    &lt;SwitchPreference
            android:key=&quot;enable_wifi_wakeup&quot; 
            android:title=&quot;@string/wifi_wakeup&quot; // &lt;string name=&quot;wifi_wakeup&quot; &gt;&quot;自动开启 WLAN&quot;&lt;/string&gt;
            android:icon=&quot;@drawable/ic_auto_wifi&quot;
            android:summary=&quot;@string/wifi_wakeup_summary&quot; /&gt;

    &lt;SwitchPreference
        android:key=&quot;use_open_wifi_automatically&quot;
        android:icon=&quot;@drawable/ic_open_wifi_autoconnect&quot; 
        android:title=&quot;@string/use_open_wifi_automatically_title&quot; // &lt;string name=&quot;use_open_wifi_automatically_title&quot; &gt;&quot;连接到开放网络&quot;&lt;/string&gt;
        android:summary=&quot;@string/use_open_wifi_automatically_summary&quot; /&gt; // &lt;string name=&quot;use_open_wifi_automatically_summary&quot;&gt;&quot;自动连接到高品质的公共网络&quot;&lt;/string&gt;

    &lt;SwitchPreference
            android:key=&quot;notify_open_networks&quot;
            android:title=&quot;@string/wifi_notify_open_networks&quot;  // &lt;string name=&quot;wifi_notify_open_networks&quot; msgid=&quot;76298880708051981&quot;&gt;&quot;打开网络通知&quot;&lt;/string&gt;
            android:icon=&quot;@drawable/ic_open_wifi_notifications&quot;
            android:summary=&quot;@string/wifi_notify_open_networks_summary&quot; /&gt; //&lt;string name=&quot;wifi_notify_open_networks_summary&quot; &gt;&quot;有可用的高品质公共网络时通知我&quot;&lt;/string&gt;

    &lt;SwitchPreference
        android:key=&quot;wifi_cellular_data_fallback&quot;
        android:title=&quot;@string/wifi_cellular_data_fallback_title&quot;
        android:summary=&quot;@string/wifi_cellular_data_fallback_summary&quot;/&gt;

    &lt;ListPreference
            android:key=&quot;sleep_policy&quot;   // 在安卓8.1中 WIFI的休眠策略被去除  new WifiSleepPolicyPreferenceController(context));类进行处理
            android:title=&quot;@string/wifi_setting_sleep_policy_title&quot;// &lt;string name=&quot;wifi_setting_sleep_policy_title&quot;&gt;&quot;在休眠状态下保持WLAN网络连接&quot;&lt;/string&gt;
            android:entries=&quot;@array/wifi_sleep_policy_entries&quot;
            android:entryValues=&quot;@array/wifi_sleep_policy_values&quot; /&gt;

    &lt;Preference
            android:key=&quot;install_credentials&quot;
            android:title=&quot;@string/wifi_install_credentials&quot;&gt; // &lt;string name=&quot;wifi_install_credentials&quot; &gt;&quot;安装证书&quot;&lt;/string&gt;
        &lt;intent android:action=&quot;android.credentials.INSTALL_AS_USER&quot;
                android:targetPackage=&quot;com.android.certinstaller&quot;
                android:targetClass=&quot;com.android.certinstaller.CertInstallerMain&quot;&gt;
            &lt;extra android:name=&quot;install_as_uid&quot; android:value=&quot;1010&quot;/&gt;
        &lt;/intent&gt;
    &lt;/Preference&gt;

    &lt;Preference
            android:key=&quot;wifi_calling_settings&quot;
            android:title=&quot;@string/wifi_calling_settings_title&quot;
            android:fragment=&quot;com.android.settings.WifiCallingSettings&quot;
            settings:keywords=&quot;@string/keywords_wifi_calling&quot;/&gt;

    &lt;Preference
            android:key=&quot;network_scorer_picker&quot;
            android:title=&quot;@string/network_scorer_picker_title&quot; // &lt;string name=&quot;network_scorer_picker_title&quot;&gt;&quot;网络评分服务提供方&quot;&lt;/string&gt;
            android:fragment=&quot;com.android.settings.network.NetworkScorerPicker&quot;/&gt;

    &lt;Preference
            android:key=&quot;wifi_direct&quot;    //  new WifiP2pPreferenceController(context, getLifecycle(), wifiManager)) 类进行处理
            android:title=&quot;@string/wifi_menu_p2p&quot;&gt; // &lt;string name=&quot;wifi_menu_p2p&quot;&gt;&quot;WLAN直连&quot;&lt;/string&gt;  WLAN直连指定了目标Activity类
        &lt;intent android:targetPackage=&quot;com.android.settings&quot;
                android:targetClass=&quot;com.android.settings.Settings$WifiP2pSettingsActivity&quot;/&gt;
    &lt;/Preference&gt;

    &lt;Preference
            android:key=&quot;wps_push_button&quot;    // new WpsPreferenceController( context, getLifecycle(), wifiManager, getFragmentManager()) 类进行处理
            android:title=&quot;@string/wifi_menu_wps_pbc&quot; /&gt;  // &lt;string name=&quot;wifi_menu_wps_pbc&quot;&gt;&quot;WPS按钮&quot;&lt;/string&gt;

    &lt;Preference
            android:key=&quot;wps_pin_entry&quot;   // new WpsPreferenceController( context, getLifecycle(), wifiManager, getFragmentManager()) 类进行处理
            android:title=&quot;@string/wifi_menu_wps_pin&quot; /&gt;  // &lt;string name=&quot;wifi_menu_wps_pin&quot;&gt;&quot;WPS PIN码输入&quot;&lt;/string&gt;

    &lt;Preference
            android:key=&quot;mac_address&quot;    // new WifiInfoPreferenceController(context, getLifecycle(), wifiManager)); 类进行处理
            android:title=&quot;@string/wifi_advanced_mac_address_title&quot;/&gt;  // &lt;string name=&quot;wifi_advanced_mac_address_title&quot; &gt;&quot;MAC地址&quot;&lt;/string&gt;

    &lt;Preference
            android:key=&quot;current_ip_address&quot;  // new WifiInfoPreferenceController(context, getLifecycle(), wifiManager)); 类进行处理
            android:title=&quot;@string/wifi_advanced_ip_address_title&quot;/&gt; //&lt;string name=&quot;wifi_advanced_ip_address_title&quot;&gt;&quot;IP 地址&quot;&lt;/string&gt;

&lt;/PreferenceScreen&gt;
</code></pre><h2 id="wifi-ua19-">WIFI UA19分析</h2>
<h3 id="wifi-ua19-">WIFI UA19 操作列</h3>
<p><img src="img/8.png" width = "25%" height="25%"/></p>
<ol>
<li><strong>UA编号</strong>   UA19</li><li><strong>UA说明</strong>  <strong>Wifi Preference 设置的 Preference点击事件</strong></li><li><strong>UA触发函数</strong>   packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 的布局文件 wifi_settings.xml 中 指定了 点击打开的Fragment SavedAccessPointsWifiSettings 具体的逻辑事件同 UA13<br>WifiSettings.java onPreferenceTreeClick 是它的触发函数   该Preference无长按事件<pre><code>   &lt;Preference
         android:key=&quot;saved_networks&quot;      // &lt;string name=&quot;wifi_saved_access_points_label&quot;&gt;&quot;已保存的网络&quot;&lt;/string&gt; 
         android:title=&quot;@string/wifi_saved_access_points_label&quot;
         android:fragment=&quot;com.android.settings.wifi.SavedAccessPointsWifiSettings&quot; /&gt;  // 已保存的网络显示的Fragment   SavedAccessPointsWifiSettings
</code></pre></li><li><strong>UA字符可选值</strong>    </li><li><strong>UA布局及ID</strong>    </li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>  </li><li><strong>数据库可选值 </strong>   </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>    </li><li><strong>UA触发函数所在类</strong>   </li></ol>
<hr>
<h3 id="wifi-ua19-">WIFI UA19 代码分析</h3>
<pre><code> /packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 
  @Override
    public boolean onPreferenceTreeClick(Preference preference) {
        // If the preference has a fragment set, open that
        if (preference.getFragment() != null) { 
//  如果当前 从 preference获取的 Fragment 不为 空  那么  调用   super.onPreferenceTreeClick(preference)  
// xml   文件 定义了 该 Fragment   SavedAccessPointsWifiSettings
            preference.setOnPreferenceClickListener(null);
            return super.onPreferenceTreeClick(preference);
        }



/packages/apps/Settings/src/com/android/settings/wifi/SavedAccessPointsWifiSettings.java


public class SavedAccessPointsWifiSettings extends SettingsPreferenceFragment implements Indexable, WifiDialog.WifiDialogListener {


    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        addPreferencesFromResource(R.xml.wifi_display_saved_access_points);  // 已保存热点的布局文件
        mUserBadgeCache = new AccessPointPreference.UserBadgeCache(getPackageManager());
         initPreferences();
    }



/packages/apps/Settings/src/com/android/settings/wifi/SavedAccessPointsWifiSettings.java
    private void initPreferences() {
        PreferenceScreen preferenceScreen = getPreferenceScreen();
        final Context context = getPrefContext();

        final List&lt;AccessPoint&gt; accessPoints = WifiSavedConfigUtils.getAllConfigs(context, mWifiManager); // 获得所有保存的热点的 AccessPoint
        Collections.sort(accessPoints, SAVED_NETWORK_COMPARATOR); // 热点集合进行排序
        preferenceScreen.removeAll();

        final int accessPointsSize = accessPoints.size();
        for (int i = 0; i &lt; accessPointsSize; ++i){
        // 新建LongPressAccessPointPreference  项Item  添加到  PreferenceScreen
            LongPressAccessPointPreference preference =new LongPressAccessPointPreference(accessPoints.get(i), context, mUserBadgeCache, true, this);
            preference.setIcon(null);  // 不设置图标
            preferenceScreen.addPreference(preference);  // 添加到  preferenceScreen
        }

        if(getPreferenceScreen().getPreferenceCount() &lt; 1) {
            Log.w(TAG, &quot;Saved networks activity loaded, but there are no saved networks!&quot;);
        }
    }
}


/packages/apps/Settings/src/com/android/settings/wifi/SavedAccessPointsWifiSettings.java
    @Override
    public boolean onPreferenceTreeClick(Preference preference) {  // 已保存网络里的Preference 的点击事件
        if (preference instanceof LongPressAccessPointPreference) {
            showDialog((LongPressAccessPointPreference) preference, false);
            return true;
        } else{
            return super.onPreferenceTreeClick(preference);
        }
    }



/packages/apps/Settings/src/com/android/settings/wifi/SavedAccessPointsWifiSettings.java
    private void showDialog(LongPressAccessPointPreference accessPoint, boolean edit) {
        if (mDialog != null) {
            removeDialog(WifiSettings.WIFI_DIALOG_ID);
            mDialog = null;
        }

        // Save the access point and edit mode
        mDlgAccessPoint = accessPoint.getAccessPoint();

        showDialog(WifiSettings.WIFI_DIALOG_ID);  // 显示提示框
    }


packages/apps/Settings/src/com/android/settings/SettingsPreferenceFragment.java    SavedAccessPointsWifiSettings.java的父父类
    protected void showDialog(int dialogId) {
        if (mDialogFragment != null) {
            Log.e(TAG, &quot;Old dialog fragment not null!&quot;);
        }
        mDialogFragment = new SettingsDialogFragment(this, dialogId);  // 创建 SettingsDialogFragment   并调用 show 方法 显示 Dialog对话框
        mDialogFragment.show(getChildFragmentManager(), Integer.toString(dialogId));
    }


        @Override  SettingsDialogFragment.java
        public Dialog onCreateDialog(Bundle savedInstanceState) {
            if (savedInstanceState != null) {
                mDialogId = savedInstanceState.getInt(KEY_DIALOG_ID, 0);
                mParentFragment = getParentFragment();
                int mParentFragmentId = savedInstanceState.getInt(KEY_PARENT_FRAGMENT_ID, -1);
                if (mParentFragment == null) {
                    mParentFragment = getFragmentManager().findFragmentById(mParentFragmentId);
                }
                if (!(mParentFragment instanceof DialogCreatable)) {
                    throw new IllegalArgumentException();
                }
                // This dialog fragment could be created from non-SettingsPreferenceFragment
                if (mParentFragment instanceof SettingsPreferenceFragment) {
                    // restore mDialogFragment in mParentFragment
                    ((SettingsPreferenceFragment) mParentFragment).mDialogFragment = this;
                }
            }
            return ((DialogCreatable) mParentFragment).onCreateDialog(mDialogId); // 调用子类的 onCreateDialog 方法
        }
        }



 /packages/apps/Settings/src/com/android/settings/wifi/SavedAccessPointsWifiSettings.java
     @Override
    public Dialog onCreateDialog(int dialogId) {
        switch (dialogId) {
            case WifiSettings.WIFI_DIALOG_ID:
                if (mDlgAccessPoint == null) { // For re-launch from saved state
                    mDlgAccessPoint = new AccessPoint(getActivity(), mAccessPointSavedState);
                    // Reset the saved access point data
                    mAccessPointSavedState = null;
                }
                mSelectedAccessPoint = mDlgAccessPoint;
                // 创建 WifiDialog  并继续创建  WifiConfigController  来显示对应的 弹框内容
                mDialog = new WifiDialog(getActivity(), this, mDlgAccessPoint,WifiConfigUiBase.MODE_VIEW, true /* hide the submit button */);
                return mDialog;

        }
        return super.onCreateDialog(dialogId);
    }
</code></pre><h3 id="wifi-ua19-">WIFI UA19 布局分析</h3>
<p>R.xml.wifi_settings.xml 布局文件</p>
<pre><code>R.xml.wifi_settings.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

&lt;PreferenceScreen
        xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
        xmlns:settings=&quot;http://schemas.android.com/apk/res/com.android.settings&quot;
        android:title=&quot;@string/wifi_settings&quot;  // values-zh-rCN/  &lt;string name=&quot;wifi_settings&quot; msgid=&quot;29722149822540994&quot;&gt;&quot;WLAN&quot;&lt;/string&gt;
        settings:keywords=&quot;@string/keywords_wifi&quot;&gt;

    &lt;PreferenceCategory android:key=&quot;connected_access_point&quot; /&gt;  // 当前已连接的热点显示的Preference 

    &lt;PreferenceCategory android:key=&quot;access_points&quot;/&gt;  // 当前手机扫描到的热点的列表

    &lt;PreferenceCategory android:key=&quot;additional_settings&quot;&gt; // 添加网络 Preference Item
        &lt;Preference
                android:key=&quot;configure_settings&quot;  // &lt;string name=&quot;wifi_configure_settings_preference_title&quot; &gt;&quot;WLAN 偏好设置&quot;&lt;/string&gt;   WLAN偏好设置选项
                android:title=&quot;@string/wifi_configure_settings_preference_title&quot;
                android:fragment=&quot;com.android.settings.wifi.ConfigureWifiSettings&quot; /&gt;  // 偏好设置选项显示的Fragment   ConfigureWifiSettings

        &lt;Preference
                android:key=&quot;saved_networks&quot;      // &lt;string name=&quot;wifi_saved_access_points_label&quot;&gt;&quot;已保存的网络&quot;&lt;/string&gt; 
                android:title=&quot;@string/wifi_saved_access_points_label&quot;
                android:fragment=&quot;com.android.settings.wifi.SavedAccessPointsWifiSettings&quot; /&gt;  // 已保存的网络显示的Fragment   SavedAccessPointsWifiSettings
    &lt;/PreferenceCategory&gt; 
&lt;/PreferenceScreen&gt;



R.xml.wifi_display_saved_access_points  // 已保存热点的布局文件

&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;PreferenceScreen xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:title=&quot;@string/wifi_display_settings_title&quot;&gt;  // &lt;string name=&quot;wifi_display_settings_title&quot; msgid=&quot;8740852850033480136&quot;&gt;&quot;投射&quot;&lt;/string&gt;
&lt;/PreferenceScreen&gt;
</code></pre><h2 id="wifi-ua20-ua15-">WIFI UA20分析 (同UA15)</h2>
<h3 id="wifi-ua20-">WIFI UA20 操作列</h3>
<p><img src="img/9.png" width = "25%" height="25%"/></p>
<ol>
<li><strong>UA编号</strong>   UA20</li><li><strong>UA说明</strong>  <strong>Wifi搜素到的热点 LongPressPreference 的点击事件弹出的对话框 WifiDialog</strong></li><li><p><strong>UA触发函数</strong>    packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java  onPreferenceTreeClick 点击事件执行了函数 showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_CONNECT);<br>弹出的对话框</p>
</li><li><p><strong>UA字符可选值</strong>    </p>
</li><li><strong>UA布局及ID</strong>    </li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>  </li><li><strong>数据库可选值 </strong>   </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>    packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java  onPreferenceTreeClick   showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_CONNECT);</li><li><strong>UA触发函数所在类</strong>   </li></ol>
<hr>
<h3 id="wifi-ua20-">WIFI UA20 代码分析</h3>
<pre><code>/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 
    @Override
    public boolean onPreferenceTreeClick(Preference preference) {
        // If the preference has a fragment set, open that
        if (preference.getFragment() != null) {
            preference.setOnPreferenceClickListener(null);
            return super.onPreferenceTreeClick(preference);  // 如果 preference设置了 fragment 则 跳转到该 fragment
        }

        if (preference instanceof LongPressAccessPointPreference) {
            mSelectedAccessPoint = ((LongPressAccessPointPreference) preference).getAccessPoint();
            if (mSelectedAccessPoint == null) {
                return false;
            }
            if (mSelectedAccessPoint.isActive()) {  // 如果当前 AccessPoint 是 Active 活动的 则让 父类处置
                return super.onPreferenceTreeClick(preference);
            }
            /**
             * Bypass dialog and connect to unsecured networks, or previously connected saved
             * networks, or Passpoint provided networks.
             */
            WifiConfiguration config = mSelectedAccessPoint.getConfig();
            if (mSelectedAccessPoint.getSecurity() == AccessPoint.SECURITY_NONE) { // 如果当前 AccessPoint 是不需要认证的 那么直接 连接它 通过 WifiConfiguration
                mSelectedAccessPoint.generateOpenNetworkConfig();
                connect(mSelectedAccessPoint.getConfig(), mSelectedAccessPoint.isSaved());
            } else if (mSelectedAccessPoint.isSaved() &amp;&amp; config != null
                    &amp;&amp; config.getNetworkSelectionStatus() != null
                    &amp;&amp; config.getNetworkSelectionStatus().getHasEverConnected()) {
                connect(config, true /* isSavedNetwork */);
            } else if (mSelectedAccessPoint.isPasspoint()) {  // 如果当前网络是 Passpoint类型的网络 那么 直接连接 
                // Access point provided by an installed Passpoint provider, connect using
                // the associated config.
                connect(config, true /* isSavedNetwork */);
            } else {
                showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_CONNECT);  // 否则就弹出对话框  请求用户进行认证输入 已达到连接的目的 UA20执行的函数
            }
        } else if (preference == mAddPreference) {
            onAddNetworkPressed(); // 如果点击的是  mAddPreference  添加网络那项 Preference  那么执行   onAddNetworkPressed() 执行添加网络的操作
        } else {
            return super.onPreferenceTreeClick(preference);
        }
        return true;
    }




/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
      private void showDialog(AccessPoint accessPoint, int dialogMode) {
        if (accessPoint != null) {
            WifiConfiguration config = accessPoint.getConfig();
            if (isEditabilityLockedDown(getActivity(), config) &amp;&amp; accessPoint.isActive()) {
                RestrictedLockUtils.sendShowAdminSupportDetailsIntent(getActivity(),RestrictedLockUtils.getDeviceOwner(getActivity()));
                return;
            }
        }

        if (mDialog != null) {
            removeDialog(WIFI_DIALOG_ID);
            mDialog = null;
        }

        // Save the access point and edit mode
        mDlgAccessPoint = accessPoint;    // 对话框 所显示的 AccessPoint
        mDialogMode = dialogMode;

        showDialog(WIFI_DIALOG_ID);  // 显示Diaglog 对话框
    }



/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 
    @Override
    public Dialog onCreateDialog(int dialogId) {
        switch (dialogId) {
            case WIFI_DIALOG_ID:
                AccessPoint ap = mDlgAccessPoint; // For manual launch
                if (ap == null) { // For re-launch from saved state
                    if (mAccessPointSavedState != null) {
                        ap = new AccessPoint(getActivity(), mAccessPointSavedState);
                        // For repeated orientation changes
                        mDlgAccessPoint = ap;
                        // Reset the saved access point data
                        mAccessPointSavedState = null;
                    }
                }
                // If it&#39;s null, fine, it&#39;s for Add Network
                mSelectedAccessPoint = ap;
                mDialog = new WifiDialog(getActivity(), this, ap, mDialogMode【WifiConfigUiBase.MODE_CONNECT】,/* no hide submit/connect */ false);  // 
                return mDialog;
                ......
             }





/packages/apps/Settings/src/com/android/settings/wifi/WifiDialog.java

private WifiConfigController mController;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        mView = getLayoutInflater().inflate(R.layout.wifi_dialog, null);
        setView(mView);
        setInverseBackgroundForced(true);
        mController = new WifiConfigController(this, mView, mAccessPoint 【NULL】, mMode 【WifiConfigUiBase.MODE_CONNECT】); // 依据 新建了 WifiConfigController  业务交由WifiConfigController实现
        super.onCreate(savedInstanceState);

        if (mHideSubmitButton) {
            mController.hideSubmitButton();
        } else {
            /* During creation, the submit button can be unavailable to determine
             * visibility. Right after creation, update button visibility */
            mController.enableSubmitIfAppropriate();
        }

        if (mAccessPoint == null) {
            mController.hideForgetButton();
        }
    }


/packages/apps/Settings/src/com/android/settings/wifi/WifiConfigController.java   // WifiConfigController 是对话框的控制对象  具体UA17中查看

          public WifiConfigController(WifiConfigUiBase parent, View view, AccessPoint accessPoint【null】,int mode 【WifiConfigUiBase.MODE_CONNECT】) {
        mConfigUi = parent;

        mView = view;
        mAccessPoint = accessPoint;
        mAccessPointSecurity = (accessPoint == null) ? AccessPoint.SECURITY_NONE : accessPoint.getSecurity();  // mAccessPointSecurity在此等于  AccessPoint.SECURITY_NONE
        mMode = mode;

        mTextViewChangedHandler = new Handler();

        .....


        }
</code></pre><h3 id="wifi-ua20-">WIFI UA20 对话框布局代码分析</h3>
<p><a href="file/wifi_dialog.xml">R.layout.wifi_dialog</a></p>
<pre><code>/packages/apps/Settings/src/com/android/settings/wifi/WifiDialog.java

 R.layout.wifi_dialog


             &lt;LinearLayout
                    android:layout_width=&quot;match_parent&quot;
                    android:layout_height=&quot;wrap_content&quot;
                    style=&quot;@style/wifi_item&quot; &gt;
                &lt;TextView
                        android:layout_width=&quot;wrap_content&quot;
                        android:layout_height=&quot;wrap_content&quot;
                        style=&quot;@style/wifi_item_label&quot;
                        android:text=&quot;@string/wifi_ssid&quot;   //  热点的名字
                        android:textDirection=&quot;locale&quot; /&gt;

                &lt;EditText android:id=&quot;@+id/ssid&quot;   // 输入热点密码的输入框  UA20对应的 弹出框输入 EditText
                        android:layout_width=&quot;match_parent&quot;
                        android:layout_height=&quot;wrap_content&quot;
                        style=&quot;@style/wifi_item_edit_content&quot;
                        android:hint=&quot;@string/wifi_ssid_hint&quot;
                        android:maxLength=&quot;32&quot;
                        android:singleLine=&quot;true&quot;
                        android:inputType=&quot;textNoSuggestions&quot; /&gt;
             &lt;/LinearLayout&gt;


                &lt;CheckBox android:id=&quot;@+id/show_password&quot;
                        android:layout_width=&quot;match_parent&quot;
                        android:layout_height=&quot;wrap_content&quot;
                        style=&quot;@style/wifi_item_content&quot;
                        android:textSize=&quot;14sp&quot;
                        android:text=&quot;@string/wifi_show_password&quot; /&gt;  // 是否明文显示密码 选框


                     &lt;Spinner android:id=&quot;@+id/ca_cert&quot;   // 证书下拉框
                            android:layout_width=&quot;match_parent&quot;
                            android:layout_height=&quot;wrap_content&quot;
                            style=&quot;@style/wifi_item_spinner&quot;
                            android:prompt=&quot;@string/wifi_eap_ca_cert&quot; /&gt;

                    &lt;TextView
                            android:layout_width=&quot;wrap_content&quot;
                            android:layout_height=&quot;wrap_content&quot;
                            style=&quot;@style/wifi_item_label&quot;
                            android:text=&quot;@string/wifi_eap_method&quot; /&gt;

                    &lt;Spinner android:id=&quot;@+id/method&quot;  // EAP 方法下拉框
                            android:layout_width=&quot;match_parent&quot;
                            android:layout_height=&quot;wrap_content&quot;
                            style=&quot;@style/wifi_item_spinner&quot;
                            android:prompt=&quot;@string/wifi_eap_method&quot;
                            android:entries=&quot;@array/wifi_eap_method&quot; /&gt;
                      &lt;Spinner android:id=&quot;@+id/phase2&quot;  // eap 阶段2 身份验证下拉框
                            android:layout_width=&quot;match_parent&quot;
                            android:layout_height=&quot;wrap_content&quot;
                            style=&quot;@style/wifi_item_spinner&quot;
                            android:prompt=&quot;@string/please_select_phase2&quot;
                            android:entries=&quot;@array/wifi_phase2_entries&quot; /&gt;



                 &lt;Spinner android:id=&quot;@+id/proxy_settings&quot;   // 代理设置 下拉框
                        android:layout_width=&quot;match_parent&quot;
                        android:layout_height=&quot;wrap_content&quot;
                        style=&quot;@style/wifi_item_spinner&quot;
                        android:prompt=&quot;@string/proxy_settings_title&quot;
                        android:entries=&quot;@array/wifi_proxy_settings&quot; /&gt;


                   &lt;Spinner android:id=&quot;@+id/ip_settings&quot;  // Ip代理设置下拉框
                        android:layout_width=&quot;match_parent&quot;
                        android:layout_height=&quot;wrap_content&quot;
                        style=&quot;@style/wifi_item_spinner&quot;
                        android:prompt=&quot;@string/wifi_ip_settings&quot;
                        android:entries=&quot;@array/wifi_ip_settings&quot; /&gt;
</code></pre><h2 id="wifi-ua21-ua14-">WIFI UA21分析 (同UA14)</h2>
<h3 id="wifi-ua21-">WIFI UA21 操作列</h3>
<p><img src="img/10.png" width = "25%" height="25%"/></p>
<ol>
<li><strong>UA编号</strong>   UA21   (同UA14)</li><li><strong>UA说明</strong>  <strong>Wifi搜素到的热点 LongPressPreference 的长按事件弹出的上下文菜单</strong></li><li><p><strong>UA触发函数</strong>    packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java  onPreferenceTreeClick 点击事件执行了函数 showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_CONNECT);<br>弹出的对话框</p>
</li><li><p><strong>UA字符可选值</strong>    </p>
</li><li><strong>UA布局及ID</strong>    </li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>  </li><li><strong>数据库可选值 </strong>   </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>    packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java  onPreferenceTreeClick   showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_CONNECT);</li><li><strong>UA触发函数所在类</strong>   </li></ol>
<hr>
<h3 id="wifi-ua21-">WIFI UA21 代码分析</h3>
<pre><code>/packages/apps/Settings/src/com/android/settings/wifi/LongPressAccessPointPreference.java
public class LongPressAccessPointPreference extends AccessPointPreference {

    @Override
    public void onBindViewHolder(final PreferenceViewHolder view) {
        super.onBindViewHolder(view);
        if (mFragment != null) {
            view.itemView.setOnCreateContextMenuListener(mFragment); // 长按事件的响应类
            view.itemView.setTag(this); // 设置tag 用于保存当前preference
            view.itemView.setLongClickable(true);  // 长按事件使能
        }
    }

  }








/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
    @Override
    public void onCreateContextMenu(ContextMenu menu, View view, ContextMenuInfo info) { // 长按 AccessPoint时触发的函数
            Preference preference = (Preference) view.getTag();

            if (preference instanceof LongPressAccessPointPreference) {

            //  private AccessPoint mSelectedAccessPoint;  用户长按的Prference 对应的  AccessPoint 
                mSelectedAccessPoint =((LongPressAccessPointPreference) preference).getAccessPoint();
                menu.setHeaderTitle(mSelectedAccessPoint.getSsid()); //  长按 显示的第一个项  为 热点的名字
                if (mSelectedAccessPoint.isConnectable()) {  // 如果当前网络热点有信号 的话 isConnectable() = true
                //   &lt;string name=&quot;wifi_menu_connect&quot; msgid=&quot;4996220309848349408&quot;&gt;&quot;连接到网络&quot;&lt;/string&gt;    显示  连接到网络
                    menu.add(Menu.NONE, MENU_ID_CONNECT, 0, R.string.wifi_menu_connect);
                }

                WifiConfiguration config = mSelectedAccessPoint.getConfig();
                // Some configs are ineditable
                if (isEditabilityLockedDown(getActivity(), config)) {  // 判断该热点对应的 WifiConfiguration 是否可修改
                    return;
                }

                if (mSelectedAccessPoint.isSaved() || mSelectedAccessPoint.isEphemeral()) { // 如果当前preference 对应的AccessPoint 是已保存过 或是 临时的话  显示
                    // Allow forgetting a network if either the network is saved or ephemerally
                    // connected. (In the latter case, &quot;forget&quot; blacklists the network so it won&#39;t
                    // be used again, ephemerally).
                    // &lt;string name=&quot;wifi_menu_forget&quot; msgid=&quot;8736964302477327114&quot;&gt;&quot;取消保存网络&quot;&lt;/string&gt;
                    menu.add(Menu.NONE, MENU_ID_FORGET, 0, R.string.wifi_menu_forget);
                }
                if (mSelectedAccessPoint.isSaved()) {
                //  &lt;string name=&quot;wifi_menu_modify&quot; msgid=&quot;2068554918652440105&quot;&gt;&quot;修改网络&quot;&lt;/string&gt;
                    menu.add(Menu.NONE, MENU_ID_MODIFY, 0, R.string.wifi_menu_modify);
                    NfcAdapter nfcAdapter = NfcAdapter.getDefaultAdapter(getActivity());
                    if (nfcAdapter != null &amp;&amp; nfcAdapter.isEnabled() &amp;&amp; mSelectedAccessPoint.getSecurity() != AccessPoint.SECURITY_NONE) {
                        // Only allow writing of NFC tags for password-protected networks.
                        // &lt;string name=&quot;wifi_menu_write_to_nfc&quot; msgid=&quot;7692881642188240324&quot;&gt;&quot;写入NFC标签&quot;&lt;/string&gt;  只在 NFC有效的条件下
                        menu.add(Menu.NONE, MENU_ID_WRITE_NFC, 0, R.string.wifi_menu_write_to_nfc);
                    }
                }
            }
    }

/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
   static boolean isEditabilityLockedDown(Context context, WifiConfiguration config) {
        return !canModifyNetwork(context, config); //canModifyNetwork 用于判断是否 WifiConfiguration 可修改    
    }


/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
    static boolean canModifyNetwork(Context context, WifiConfiguration config) {
        if (config == null) {
            return true;
        }
        final DevicePolicyManager dpm = (DevicePolicyManager) context.getSystemService( Context.DEVICE_POLICY_SERVICE);
        final PackageManager pm = context.getPackageManager();
        if (pm.hasSystemFeature(PackageManager.FEATURE_DEVICE_ADMIN) &amp;&amp; dpm == null) {
            return false;
        }

        boolean isConfigEligibleForLockdown = false;
        if (dpm != null) {
            final ComponentName deviceOwner = dpm.getDeviceOwnerComponentOnAnyUser();
            if (deviceOwner != null) {
                final int deviceOwnerUserId = dpm.getDeviceOwnerUserId();
                try {
                    final int deviceOwnerUid = pm.getPackageUidAsUser(deviceOwner.getPackageName(),deviceOwnerUserId);
                    isConfigEligibleForLockdown = deviceOwnerUid == config.creatorUid;
                } catch (NameNotFoundException e) {
                    // don&#39;t care
                }
            }
        }
        if (!isConfigEligibleForLockdown) {
            return true;
        }
//         public static final String WIFI_DEVICE_OWNER_CONFIGS_LOCKDOWN = &quot;wifi_device_owner_configs_lockdown&quot;; 用于判断是否允许用户修改wifi配置的数据库项  1-true  0 false
        final ContentResolver resolver = context.getContentResolver();
        final boolean isLockdownFeatureEnabled = Settings.Global.getInt(resolver,Settings.Global.WIFI_DEVICE_OWNER_CONFIGS_LOCKDOWN, 0) != 0;
        return !isLockdownFeatureEnabled;
    }



/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPoint.java
    public boolean isConnectable() {
        return getLevel() != -1 &amp;&amp; getDetailedState() == null;
    }    
    public int getLevel() {
        return WifiManager.calculateSignalLevel(mRssi, SIGNAL_LEVELS);
    }
    public DetailedState getDetailedState() {
        if (mNetworkInfo != null) {
            return mNetworkInfo.getDetailedState();
        }
        Log.w(TAG, &quot;NetworkInfo is null, cannot return detailed state&quot;);
        return null;
    }


/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPoint.java
public boolean isSaved() {
        return networkId != WifiConfiguration.INVALID_NETWORK_ID;
    }

/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPoint.java
    public boolean isEphemeral() {
        return mInfo != null &amp;&amp; mInfo.isEphemeral() &amp;&amp;
                mNetworkInfo != null &amp;&amp; mNetworkInfo.getState() != State.DISCONNECTED;
    }




/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
     @Override
    public boolean onContextItemSelected(MenuItem item) {
        if (mSelectedAccessPoint == null) {
            return super.onContextItemSelected(item);
        }
        switch (item.getItemId()) { // 用户选择 上下文按钮
            case MENU_ID_CONNECT: {  // 选择  连接到网络  UA20 执行到这里    连接到网络
                boolean isSavedNetwork = mSelectedAccessPoint.isSaved(); // 判断当前网络是否有 networkId
                if (isSavedNetwork) {
                    connect(mSelectedAccessPoint.getConfig(), isSavedNetwork); // 如果有执行 connect(final WifiConfiguration config, boolean isSavedNetwork) 方法
                // // 如果当前网络没有加密认证 则先生成 networkdId 再 connect(final WifiConfiguration config, boolean isSavedNetwork)
                } else if (mSelectedAccessPoint.getSecurity() == AccessPoint.SECURITY_NONE) { 
                    /** Bypass dialog for unsecured networks */
                    mSelectedAccessPoint.generateOpenNetworkConfig();  // 用于产生 WifiConfiguration 
                    connect(mSelectedAccessPoint.getConfig(), isSavedNetwork);
                } else {
                    showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_CONNECT); // 弹出 Dialog框 用于 用户输入 一些认证信息才能连接
                }
                return true;
            }
            case MENU_ID_FORGET: {   // 选择 取消保存网络
                forget();   
                return true;
            }
            case MENU_ID_MODIFY: {  // 选择 修改网络
                showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_MODIFY);
                return true;
            }
            case MENU_ID_WRITE_NFC:  // 选择 写入 NFC标签
                showDialog(WRITE_NFC_DIALOG_ID);
                return true;

        }
        return super.onContextItemSelected(item);
    }
</code></pre><h2 id="wifi-ua22-ua14-">WIFI UA22分析 (同UA14)</h2>
<h3 id="wifi-ua22-">WIFI UA22 操作列</h3>
<p><img src="img/11.png" width = "25%" height="25%"/></p>
<ol>
<li><strong>UA编号</strong>   UA22   (同UA14)</li><li><strong>UA说明</strong>  <strong>Wifi搜素到的热点 LongPressPreference 的长按事件弹出的上下文菜单中的 Forget 忘记当前已保存的网络菜单选项</strong></li><li><strong>UA触发函数</strong>  packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java  onPreferenceTreeClick   menu.add(Menu.NONE, MENU_ID_FORGET, 0, R.string.wifi_menu_forget);<br>packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java  forget();   </li><li><strong>UA字符可选值</strong>    </li><li><strong>UA布局及ID</strong>    </li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>  </li><li><strong>数据库可选值 </strong>   </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>    packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java  onPreferenceTreeClick   menu.add(Menu.NONE, MENU_ID_FORGET, 0, R.string.wifi_menu_forget);</li><li><strong>UA触发函数所在类</strong>     packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java  forget();   </li></ol>
<hr>
<h3 id="wifi-ua22-">WIFI UA22 代码分析</h3>
<pre><code>/packages/apps/Settings/src/com/android/settings/wifi/LongPressAccessPointPreference.java
public class LongPressAccessPointPreference extends AccessPointPreference {

    @Override
    public void onBindViewHolder(final PreferenceViewHolder view) {
        super.onBindViewHolder(view);
        if (mFragment != null) {
            view.itemView.setOnCreateContextMenuListener(mFragment); // 长按事件的响应类
            view.itemView.setTag(this); // 设置tag 用于保存当前preference
            view.itemView.setLongClickable(true);  // 长按事件使能
        }
    }

  }








/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
    @Override
    public void onCreateContextMenu(ContextMenu menu, View view, ContextMenuInfo info) { // 长按 AccessPoint时触发的函数
            Preference preference = (Preference) view.getTag();

            if (preference instanceof LongPressAccessPointPreference) {

            //  private AccessPoint mSelectedAccessPoint;  用户长按的Prference 对应的  AccessPoint 
                mSelectedAccessPoint =((LongPressAccessPointPreference) preference).getAccessPoint();
                menu.setHeaderTitle(mSelectedAccessPoint.getSsid()); //  长按 显示的第一个项  为 热点的名字
                if (mSelectedAccessPoint.isConnectable()) {  // 如果当前网络热点有信号 的话 isConnectable() = true
                //   &lt;string name=&quot;wifi_menu_connect&quot; msgid=&quot;4996220309848349408&quot;&gt;&quot;连接到网络&quot;&lt;/string&gt;    显示  连接到网络
                    menu.add(Menu.NONE, MENU_ID_CONNECT, 0, R.string.wifi_menu_connect);
                }

                WifiConfiguration config = mSelectedAccessPoint.getConfig();
                // Some configs are ineditable
                if (isEditabilityLockedDown(getActivity(), config)) {  // 判断该热点对应的 WifiConfiguration 是否可修改
                    return;
                }

                if (mSelectedAccessPoint.isSaved() || mSelectedAccessPoint.isEphemeral()) { // 如果当前preference 对应的AccessPoint 是已保存过 或是 临时的话  显示
                    // Allow forgetting a network if either the network is saved or ephemerally
                    // connected. (In the latter case, &quot;forget&quot; blacklists the network so it won&#39;t
                    // be used again, ephemerally).
                    // &lt;string name=&quot;wifi_menu_forget&quot; msgid=&quot;8736964302477327114&quot;&gt;&quot;取消保存网络&quot;&lt;/string&gt;
                    menu.add(Menu.NONE, MENU_ID_FORGET, 0, R.string.wifi_menu_forget);
                }
                if (mSelectedAccessPoint.isSaved()) {
                //  &lt;string name=&quot;wifi_menu_modify&quot; msgid=&quot;2068554918652440105&quot;&gt;&quot;修改网络&quot;&lt;/string&gt;
                    menu.add(Menu.NONE, MENU_ID_MODIFY, 0, R.string.wifi_menu_modify);
                    NfcAdapter nfcAdapter = NfcAdapter.getDefaultAdapter(getActivity());
                    if (nfcAdapter != null &amp;&amp; nfcAdapter.isEnabled() &amp;&amp; mSelectedAccessPoint.getSecurity() != AccessPoint.SECURITY_NONE) {
                        // Only allow writing of NFC tags for password-protected networks.
                        // &lt;string name=&quot;wifi_menu_write_to_nfc&quot; msgid=&quot;7692881642188240324&quot;&gt;&quot;写入NFC标签&quot;&lt;/string&gt;  只在 NFC有效的条件下
                        menu.add(Menu.NONE, MENU_ID_WRITE_NFC, 0, R.string.wifi_menu_write_to_nfc);
                    }
                }
            }
    }

/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
   static boolean isEditabilityLockedDown(Context context, WifiConfiguration config) {
        return !canModifyNetwork(context, config); //canModifyNetwork 用于判断是否 WifiConfiguration 可修改    
    }


/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
    static boolean canModifyNetwork(Context context, WifiConfiguration config) {
        if (config == null) {
            return true;
        }
        final DevicePolicyManager dpm = (DevicePolicyManager) context.getSystemService( Context.DEVICE_POLICY_SERVICE);
        final PackageManager pm = context.getPackageManager();
        if (pm.hasSystemFeature(PackageManager.FEATURE_DEVICE_ADMIN) &amp;&amp; dpm == null) {
            return false;
        }

        boolean isConfigEligibleForLockdown = false;
        if (dpm != null) {
            final ComponentName deviceOwner = dpm.getDeviceOwnerComponentOnAnyUser();
            if (deviceOwner != null) {
                final int deviceOwnerUserId = dpm.getDeviceOwnerUserId();
                try {
                    final int deviceOwnerUid = pm.getPackageUidAsUser(deviceOwner.getPackageName(),deviceOwnerUserId);
                    isConfigEligibleForLockdown = deviceOwnerUid == config.creatorUid;
                } catch (NameNotFoundException e) {
                    // don&#39;t care
                }
            }
        }
        if (!isConfigEligibleForLockdown) {
            return true;
        }
//         public static final String WIFI_DEVICE_OWNER_CONFIGS_LOCKDOWN = &quot;wifi_device_owner_configs_lockdown&quot;; 用于判断是否允许用户修改wifi配置的数据库项  1-true  0 false
        final ContentResolver resolver = context.getContentResolver();
        final boolean isLockdownFeatureEnabled = Settings.Global.getInt(resolver,Settings.Global.WIFI_DEVICE_OWNER_CONFIGS_LOCKDOWN, 0) != 0;
        return !isLockdownFeatureEnabled;
    }



/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPoint.java
    public boolean isConnectable() {
        return getLevel() != -1 &amp;&amp; getDetailedState() == null;
    }    
    public int getLevel() {
        return WifiManager.calculateSignalLevel(mRssi, SIGNAL_LEVELS);
    }
    public DetailedState getDetailedState() {
        if (mNetworkInfo != null) {
            return mNetworkInfo.getDetailedState();
        }
        Log.w(TAG, &quot;NetworkInfo is null, cannot return detailed state&quot;);
        return null;
    }


/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPoint.java
public boolean isSaved() {
        return networkId != WifiConfiguration.INVALID_NETWORK_ID;
    }

/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPoint.java
    public boolean isEphemeral() {
        return mInfo != null &amp;&amp; mInfo.isEphemeral() &amp;&amp;
                mNetworkInfo != null &amp;&amp; mNetworkInfo.getState() != State.DISCONNECTED;
    }




/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
     @Override
    public boolean onContextItemSelected(MenuItem item) {
        if (mSelectedAccessPoint == null) {
            return super.onContextItemSelected(item);
        }
        switch (item.getItemId()) { // 用户选择 上下文按钮
            case MENU_ID_CONNECT: {  // 选择  连接到网络  UA20 执行到这里    连接到网络
                boolean isSavedNetwork = mSelectedAccessPoint.isSaved(); // 判断当前网络是否有 networkId
                if (isSavedNetwork) {
                    connect(mSelectedAccessPoint.getConfig(), isSavedNetwork); // 如果有执行 connect(final WifiConfiguration config, boolean isSavedNetwork) 方法
                // // 如果当前网络没有加密认证 则先生成 networkdId 再 connect(final WifiConfiguration config, boolean isSavedNetwork)
                } else if (mSelectedAccessPoint.getSecurity() == AccessPoint.SECURITY_NONE) { 
                    /** Bypass dialog for unsecured networks */
                    mSelectedAccessPoint.generateOpenNetworkConfig();  // 用于产生 WifiConfiguration 
                    connect(mSelectedAccessPoint.getConfig(), isSavedNetwork);
                } else {
                    showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_CONNECT); // 弹出 Dialog框 用于 用户输入 一些认证信息才能连接
                }
                return true;
            }
            case MENU_ID_FORGET: {   // 选择 取消保存网络
                forget();      //  UA22 执行的 逻辑业务 
                return true;
            }
            case MENU_ID_MODIFY: {  // 选择 修改网络
                showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_MODIFY);
                return true;
            }
            case MENU_ID_WRITE_NFC:  // 选择 写入 NFC标签
                showDialog(WRITE_NFC_DIALOG_ID);
                return true;

        }
        return super.onContextItemSelected(item);
    }
</code></pre><h2 id="wifi-ua23-ua14-">WIFI UA23分析 (同UA14)</h2>
<h3 id="wifi-ua23-">WIFI UA23 操作列</h3>
<p><img src="img/11.png" width = "25%" height="25%"/><img src="img/28.png" width = "25%" height="25%"/></p>
<ol>
<li><strong>UA编号</strong>   UA23   (同UA14)</li><li><strong>UA说明</strong>  <strong>Wifi搜素到的热点 LongPressPreference 的长按事件弹出的上下文菜单中的 修改网络 的 菜单选项</strong></li><li><strong>UA触发函数</strong>  packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java  onPreferenceTreeClick    menu.add(Menu.NONE, MENU_ID_MODIFY, 0, R.string.wifi_menu_modify);<br>showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_MODIFY);  // 展示修改网络的Dialog  UA23 的业务函数 </li><li><strong>UA字符可选值</strong>    </li><li><strong>UA布局及ID</strong>    </li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>  </li><li><strong>数据库可选值 </strong>   </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>    packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java  onPreferenceTreeClick    menu.add(Menu.NONE, MENU_ID_MODIFY, 0, R.string.wifi_menu_modify);</li><li><strong>UA触发函数所在类</strong>    showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_MODIFY);  // 展示修改网络的Dialog  UA23 的业务函数  </li></ol>
<hr>
<h3 id="wifi-ua23-">WIFI UA23 代码分析</h3>
<pre><code>/packages/apps/Settings/src/com/android/settings/wifi/LongPressAccessPointPreference.java
public class LongPressAccessPointPreference extends AccessPointPreference {

    @Override
    public void onBindViewHolder(final PreferenceViewHolder view) {
        super.onBindViewHolder(view);
        if (mFragment != null) {
            view.itemView.setOnCreateContextMenuListener(mFragment); // 长按事件的响应类
            view.itemView.setTag(this); // 设置tag 用于保存当前preference
            view.itemView.setLongClickable(true);  // 长按事件使能
        }
    }

  }








/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
    @Override
    public void onCreateContextMenu(ContextMenu menu, View view, ContextMenuInfo info) { // 长按 AccessPoint时触发的函数
            Preference preference = (Preference) view.getTag();

            if (preference instanceof LongPressAccessPointPreference) {

            //  private AccessPoint mSelectedAccessPoint;  用户长按的Prference 对应的  AccessPoint 
                mSelectedAccessPoint =((LongPressAccessPointPreference) preference).getAccessPoint();
                menu.setHeaderTitle(mSelectedAccessPoint.getSsid()); //  长按 显示的第一个项  为 热点的名字
                if (mSelectedAccessPoint.isConnectable()) {  // 如果当前网络热点有信号 的话 isConnectable() = true
                //   &lt;string name=&quot;wifi_menu_connect&quot; msgid=&quot;4996220309848349408&quot;&gt;&quot;连接到网络&quot;&lt;/string&gt;    显示  连接到网络
                    menu.add(Menu.NONE, MENU_ID_CONNECT, 0, R.string.wifi_menu_connect);
                }

                WifiConfiguration config = mSelectedAccessPoint.getConfig();
                // Some configs are ineditable
                if (isEditabilityLockedDown(getActivity(), config)) {  // 判断该热点对应的 WifiConfiguration 是否可修改
                    return;
                }

                if (mSelectedAccessPoint.isSaved() || mSelectedAccessPoint.isEphemeral()) { // 如果当前preference 对应的AccessPoint 是已保存过 或是 临时的话  显示
                    // Allow forgetting a network if either the network is saved or ephemerally
                    // connected. (In the latter case, &quot;forget&quot; blacklists the network so it won&#39;t
                    // be used again, ephemerally).
                    // &lt;string name=&quot;wifi_menu_forget&quot; msgid=&quot;8736964302477327114&quot;&gt;&quot;取消保存网络&quot;&lt;/string&gt;
                    menu.add(Menu.NONE, MENU_ID_FORGET, 0, R.string.wifi_menu_forget);
                }
                if (mSelectedAccessPoint.isSaved()) {
                //  &lt;string name=&quot;wifi_menu_modify&quot; msgid=&quot;2068554918652440105&quot;&gt;&quot;修改网络&quot;&lt;/string&gt;
                    menu.add(Menu.NONE, MENU_ID_MODIFY, 0, R.string.wifi_menu_modify);
                    NfcAdapter nfcAdapter = NfcAdapter.getDefaultAdapter(getActivity());
                    if (nfcAdapter != null &amp;&amp; nfcAdapter.isEnabled() &amp;&amp; mSelectedAccessPoint.getSecurity() != AccessPoint.SECURITY_NONE) {
                        // Only allow writing of NFC tags for password-protected networks.
                        // &lt;string name=&quot;wifi_menu_write_to_nfc&quot; msgid=&quot;7692881642188240324&quot;&gt;&quot;写入NFC标签&quot;&lt;/string&gt;  只在 NFC有效的条件下
                        menu.add(Menu.NONE, MENU_ID_WRITE_NFC, 0, R.string.wifi_menu_write_to_nfc);
                    }
                }
            }
    }

/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
   static boolean isEditabilityLockedDown(Context context, WifiConfiguration config) {
        return !canModifyNetwork(context, config); //canModifyNetwork 用于判断是否 WifiConfiguration 可修改    
    }


/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
    static boolean canModifyNetwork(Context context, WifiConfiguration config) {
        if (config == null) {
            return true;
        }
        final DevicePolicyManager dpm = (DevicePolicyManager) context.getSystemService( Context.DEVICE_POLICY_SERVICE);
        final PackageManager pm = context.getPackageManager();
        if (pm.hasSystemFeature(PackageManager.FEATURE_DEVICE_ADMIN) &amp;&amp; dpm == null) {
            return false;
        }

        boolean isConfigEligibleForLockdown = false;
        if (dpm != null) {
            final ComponentName deviceOwner = dpm.getDeviceOwnerComponentOnAnyUser();
            if (deviceOwner != null) {
                final int deviceOwnerUserId = dpm.getDeviceOwnerUserId();
                try {
                    final int deviceOwnerUid = pm.getPackageUidAsUser(deviceOwner.getPackageName(),deviceOwnerUserId);
                    isConfigEligibleForLockdown = deviceOwnerUid == config.creatorUid;
                } catch (NameNotFoundException e) {
                    // don&#39;t care
                }
            }
        }
        if (!isConfigEligibleForLockdown) {
            return true;
        }
//         public static final String WIFI_DEVICE_OWNER_CONFIGS_LOCKDOWN = &quot;wifi_device_owner_configs_lockdown&quot;; 用于判断是否允许用户修改wifi配置的数据库项  1-true  0 false
        final ContentResolver resolver = context.getContentResolver();
        final boolean isLockdownFeatureEnabled = Settings.Global.getInt(resolver,Settings.Global.WIFI_DEVICE_OWNER_CONFIGS_LOCKDOWN, 0) != 0;
        return !isLockdownFeatureEnabled;
    }



/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPoint.java
    public boolean isConnectable() {
        return getLevel() != -1 &amp;&amp; getDetailedState() == null;
    }    
    public int getLevel() {
        return WifiManager.calculateSignalLevel(mRssi, SIGNAL_LEVELS);
    }
    public DetailedState getDetailedState() {
        if (mNetworkInfo != null) {
            return mNetworkInfo.getDetailedState();
        }
        Log.w(TAG, &quot;NetworkInfo is null, cannot return detailed state&quot;);
        return null;
    }


/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPoint.java
public boolean isSaved() {
        return networkId != WifiConfiguration.INVALID_NETWORK_ID;
    }

/frameworks/base/packages/SettingsLib/src/com/android/settingslib/wifi/AccessPoint.java
    public boolean isEphemeral() {
        return mInfo != null &amp;&amp; mInfo.isEphemeral() &amp;&amp;
                mNetworkInfo != null &amp;&amp; mNetworkInfo.getState() != State.DISCONNECTED;
    }




/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
     @Override
    public boolean onContextItemSelected(MenuItem item) {
        if (mSelectedAccessPoint == null) {
            return super.onContextItemSelected(item);
        }
        switch (item.getItemId()) { // 用户选择 上下文按钮
            case MENU_ID_CONNECT: {  // 选择  连接到网络  UA20 执行到这里    连接到网络
                boolean isSavedNetwork = mSelectedAccessPoint.isSaved(); // 判断当前网络是否有 networkId
                if (isSavedNetwork) {
                    connect(mSelectedAccessPoint.getConfig(), isSavedNetwork); // 如果有执行 connect(final WifiConfiguration config, boolean isSavedNetwork) 方法
                // // 如果当前网络没有加密认证 则先生成 networkdId 再 connect(final WifiConfiguration config, boolean isSavedNetwork)
                } else if (mSelectedAccessPoint.getSecurity() == AccessPoint.SECURITY_NONE) { 
                    /** Bypass dialog for unsecured networks */
                    mSelectedAccessPoint.generateOpenNetworkConfig();  // 用于产生 WifiConfiguration 
                    connect(mSelectedAccessPoint.getConfig(), isSavedNetwork);
                } else {
                    showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_CONNECT); // 弹出 Dialog框 用于 用户输入 一些认证信息才能连接
                }
                return true;
            }
            case MENU_ID_FORGET: {   // 选择 取消保存网络
                forget();      //  UA22 执行的 逻辑业务 
                return true;
            }
            case MENU_ID_MODIFY: {  // 选择 修改网络
                showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_MODIFY);  // 展示修改网络的Dialog  UA23 的业务函数
                return true;
            }
            case MENU_ID_WRITE_NFC:  // 选择 写入 NFC标签
                showDialog(WRITE_NFC_DIALOG_ID);
                return true;

        }
        return super.onContextItemSelected(item);
    }




   /packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
      private void showDialog(AccessPoint accessPoint, int dialogMode  【WifiConfigUiBase.MODE_MODIFY】) {
        if (accessPoint != null) {
            WifiConfiguration config = accessPoint.getConfig();
            if (isEditabilityLockedDown(getActivity(), config) &amp;&amp; accessPoint.isActive()) {
                RestrictedLockUtils.sendShowAdminSupportDetailsIntent(getActivity(),RestrictedLockUtils.getDeviceOwner(getActivity()));
                return;
            }
        }

        if (mDialog != null) {
            removeDialog(WIFI_DIALOG_ID);
            mDialog = null;
        }

        // Save the access point and edit mode
        mDlgAccessPoint = accessPoint;    // 对话框 所显示的 AccessPoint
        mDialogMode = dialogMode;

        showDialog(WIFI_DIALOG_ID);  // 显示Diaglog 对话框
    }



/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 
    @Override
    public Dialog onCreateDialog(int dialogId) {
        switch (dialogId) {
            case WIFI_DIALOG_ID:
                AccessPoint ap = mDlgAccessPoint; // For manual launch
                if (ap == null) { // For re-launch from saved state
                    if (mAccessPointSavedState != null) {
                        ap = new AccessPoint(getActivity(), mAccessPointSavedState);
                        // For repeated orientation changes
                        mDlgAccessPoint = ap;
                        // Reset the saved access point data
                        mAccessPointSavedState = null;
                    }
                }
                // If it&#39;s null, fine, it&#39;s for Add Network
                mSelectedAccessPoint = ap;
                mDialog = new WifiDialog(getActivity(), this, ap, mDialogMode【WifiConfigUiBase.MODE_MODIFY】,/* no hide submit/connect */ false);  // 
                return mDialog;
                ......
             }





/packages/apps/Settings/src/com/android/settings/wifi/WifiDialog.java

private WifiConfigController mController;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        mView = getLayoutInflater().inflate(R.layout.wifi_dialog, null);  //  对话框的布局文件
        setView(mView);
        setInverseBackgroundForced(true);
        mController = new WifiConfigController(this, mView, mAccessPoint 【NULL】, mMode 【WifiConfigUiBase.MODE_MODIFY】); // 依据 新建了 WifiConfigController  业务交由WifiConfigController实现
        super.onCreate(savedInstanceState);

        if (mHideSubmitButton) {
            mController.hideSubmitButton();
        } else {
            /* During creation, the submit button can be unavailable to determine
             * visibility. Right after creation, update button visibility */
            mController.enableSubmitIfAppropriate();
        }

        if (mAccessPoint == null) {
            mController.hideForgetButton();
        }
    }


/packages/apps/Settings/src/com/android/settings/wifi/WifiConfigController.java   // WifiConfigController 是对话框的控制对象  具体UA17中查看

          public WifiConfigController(WifiConfigUiBase parent, View view, AccessPoint accessPoint【null】,int mode 【WifiConfigUiBase.MODE_MODIFY】) {
        mConfigUi = parent;

        mView = view;
        mAccessPoint = accessPoint;
        mAccessPointSecurity = (accessPoint == null) ? AccessPoint.SECURITY_NONE : accessPoint.getSecurity();  // mAccessPointSecurity在此等于  AccessPoint.SECURITY_NONE
        mMode = mode;

        mTextViewChangedHandler = new Handler();

        .....


        }
</code></pre><h2 id="wifi-ua24-ua17-">WIFI UA24分析 (同UA17)</h2>
<h3 id="wifi-ua24-">WIFI UA24 操作列</h3>
<p><img src="img/12.png" width = "25%" height="25%"/></p>
<ol>
<li><strong>UA编号</strong>   UA24   (同UA17)</li><li><strong>UA说明</strong>  <strong>增加网络Preference点击后进入的增加网络页面中的 网络SSID输入框</strong></li><li><strong>UA触发函数</strong>  </li><li><strong>UA字符可选值</strong>    </li><li><strong>UA布局及ID</strong>    </li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>  </li><li><strong>数据库可选值 </strong>   </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>   </li><li><strong>UA触发函数所在类</strong>    </li></ol>
<hr>
<h3 id="wifi-ua24-">WIFI UA24 代码分析</h3>
<pre><code>

/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 

private Preference mAddPreference;
    @Override
    public void onCreate(Bundle icicle) {
        Context prefContext = getPrefContext();
        mAddPreference = new Preference(prefContext);
        mAddPreference.setIcon(R.drawable.ic_menu_add_inset);
        mAddPreference.setTitle(R.string.wifi_add_network);   // &lt;string name=&quot;wifi_add_network&quot; msgid=&quot;6234851776910938957&quot;&gt;&quot;添加网络&quot;&lt;/string&gt;
        mAccessPointsPreferenceCategory.addPreference(mAddPreference);
       }




    @Override
    public boolean onPreferenceTreeClick(Preference preference) {
        // If the preference has a fragment set, open that
        if (preference.getFragment() != null) {
            preference.setOnPreferenceClickListener(null);
            return super.onPreferenceTreeClick(preference);  // 如果 preference设置了 fragment 则 跳转到该 fragment
        }

        if (preference instanceof LongPressAccessPointPreference) {
            mSelectedAccessPoint = ((LongPressAccessPointPreference) preference).getAccessPoint();
            if (mSelectedAccessPoint == null) {
                return false;
            }
            if (mSelectedAccessPoint.isActive()) {  // 如果当前 AccessPoint 是 Active 活动的 则让 父类处置
                return super.onPreferenceTreeClick(preference);
            }
            /**
             * Bypass dialog and connect to unsecured networks, or previously connected saved
             * networks, or Passpoint provided networks.
             */
            WifiConfiguration config = mSelectedAccessPoint.getConfig();
            if (mSelectedAccessPoint.getSecurity() == AccessPoint.SECURITY_NONE) { // 如果当前 AccessPoint 是不需要认证的 那么直接 连接它 通过 WifiConfiguration
                mSelectedAccessPoint.generateOpenNetworkConfig();
                connect(mSelectedAccessPoint.getConfig(), mSelectedAccessPoint.isSaved());
            } else if (mSelectedAccessPoint.isSaved() &amp;&amp; config != null
                    &amp;&amp; config.getNetworkSelectionStatus() != null
                    &amp;&amp; config.getNetworkSelectionStatus().getHasEverConnected()) {
                connect(config, true /* isSavedNetwork */);
            } else if (mSelectedAccessPoint.isPasspoint()) {  // 如果当前网络是 Passpoint类型的网络 那么 直接连接 
                // Access point provided by an installed Passpoint provider, connect using
                // the associated config.
                connect(config, true /* isSavedNetwork */);
            } else {
                showDialog(mSelectedAccessPoint, WifiConfigUiBase.MODE_CONNECT);  // 否则就弹出对话框  请求用户进行认证输入 已达到连接的目的
            }
        } else if (preference == mAddPreference) {
            onAddNetworkPressed(); // 如果点击的是  mAddPreference  添加网络那项 Preference  那么执行   onAddNetworkPressed() 执行添加网络的操作
        } else {
            return super.onPreferenceTreeClick(preference);
        }
        return true;
    }




/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 


void onAddNetworkPressed() {
        mMetricsFeatureProvider.action(getActivity(), MetricsEvent.ACTION_WIFI_ADD_NETWORK);
        // No exact access point is selected.
        mSelectedAccessPoint = null;
        showDialog(null, WifiConfigUiBase.MODE_CONNECT); // 显示 添加网络的Dialog    此处 mSelectedAccessPoint 为空
    }





/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 
    @Override
    public Dialog onCreateDialog(int dialogId) {
        switch (dialogId) {
            case WIFI_DIALOG_ID:
                AccessPoint ap = mDlgAccessPoint; // For manual launch
                if (ap == null) { // For re-launch from saved state
                    if (mAccessPointSavedState != null) {
                        ap = new AccessPoint(getActivity(), mAccessPointSavedState);
                        // For repeated orientation changes
                        mDlgAccessPoint = ap;
                        // Reset the saved access point data
                        mAccessPointSavedState = null;
                    }
                }
                // If it&#39;s null, fine, it&#39;s for Add Network
                mSelectedAccessPoint = ap;
                mDialog = new WifiDialog(getActivity(), this, ap【NULL】, mDialogMode【WifiConfigUiBase.MODE_MODIFY】,/* no hide submit/connect */ false);  // 
                return mDialog;
                ......
             }



/packages/apps/Settings/src/com/android/settings/wifi/WifiDialog.java   
private WifiConfigController mController;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        mView = getLayoutInflater().inflate(R.layout.wifi_dialog, null);  //  对话框的布局文件
        setView(mView);
        setInverseBackgroundForced(true);
        mController = new WifiConfigController(this, mView, mAccessPoint 【NULL】, mMode 【WifiConfigUiBase.MODE_MODIFY】); // 依据 新建了 WifiConfigController  业务交由WifiConfigController实现
        super.onCreate(savedInstanceState);

        if (mHideSubmitButton) {
            mController.hideSubmitButton();
        } else {
            /* During creation, the submit button can be unavailable to determine
             * visibility. Right after creation, update button visibility */
            mController.enableSubmitIfAppropriate();
        }

        if (mAccessPoint == null) {
            mController.hideForgetButton();
        }
    }


/packages/apps/Settings/src/com/android/settings/wifi/WifiConfigController.java   // WifiConfigController 是对话框的控制对象  具体UA17中查看

          public WifiConfigController(WifiConfigUiBase parent, View view, AccessPoint accessPoint【null】,int mode 【WifiConfigUiBase.MODE_MODIFY】) {
        mConfigUi = parent;

        mView = view;
        mAccessPoint = accessPoint;
        mAccessPointSecurity = (accessPoint == null) ? AccessPoint.SECURITY_NONE : accessPoint.getSecurity();  // mAccessPointSecurity在此等于  AccessPoint.SECURITY_NONE
        mMode = mode;

        mTextViewChangedHandler = new Handler();

        .....

        if (mAccessPoint == null) { // new network  // 当前的 AccessPoint为空 说明是 需要 新增 网络
            mConfigUi.setTitle(R.string.wifi_add_network);  // &lt;string name=&quot;wifi_add_network&quot; msgid=&quot;6234851776910938957&quot;&gt;&quot;添加网络&quot;&lt;/string&gt;

            mSsidView = (TextView) mView.findViewById(R.id.ssid);
            mSsidView.addTextChangedListener(this);
            mSecuritySpinner = ((Spinner) mView.findViewById(R.id.security)); 【安全性】
            mSecuritySpinner.setOnItemSelectedListener(this);
            mView.findViewById(R.id.type).setVisibility(View.VISIBLE);

            showIpConfigFields();
            showProxyFields();
            mView.findViewById(R.id.wifi_advanced_toggle).setVisibility(View.VISIBLE);
            ((CheckBox) mView.findViewById(R.id.wifi_advanced_togglebox)).setOnCheckedChangeListener(this); 【高级选项】
            mConfigUi.setSubmitButton(res.getString(R.string.wifi_save));  // &lt;string name=&quot;wifi_save&quot; msgid=&quot;3331121567988522826&quot;&gt;&quot;保存&quot;&lt;/string&gt;
        }
        .....

        }
</code></pre><h3 id="ua24-">UA24  布局分析</h3>
<p><img src="img/12.png" width = "25%" height="25%"/><br><a href="file/wifi_dialog.xml">R.layout.wifi_dialog</a></p>
<pre><code>/packages/apps/Settings/src/com/android/settings/wifi/WifiDialog.java

 R.layout.wifi_dialog

........
&lt;EditText android:id=&quot;@+id/ssid&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        style=&quot;@style/wifi_item_edit_content&quot;
        android:hint=&quot;@string/wifi_ssid_hint&quot;  // &lt;string name=&quot;wifi_ssid_hint&quot; msgid=&quot;897593601067321355&quot;&gt;&quot;输入SSID&quot;&lt;/string&gt;
        android:maxLength=&quot;32&quot;
        android:singleLine=&quot;true&quot;
        android:inputType=&quot;textNoSuggestions&quot; /&gt;
........
</code></pre><h2 id="wifi-ua25-ua25-">WIFI UA25分析 (接 UA25的代码分析)</h2>
<h3 id="wifi-ua25-">WIFI UA25 操作列</h3>
<p><img src="img/12.png" width = "25%" height="25%"/></p>
<ol>
<li><strong>UA编号</strong>   UA25   (同UA14)</li><li><strong>UA说明</strong>  <strong>增加网络Preference点击后进入的增加网络页面中的  确认保存按钮</strong></li><li><strong>UA触发函数</strong>  </li><li><strong>UA字符可选值</strong>    </li><li><strong>UA布局及ID</strong>    </li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>  </li><li><strong>数据库可选值 </strong>   </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>   </li><li><strong>UA触发函数所在类</strong>    </li></ol>
<hr>
<h3 id="wifi-ua25-">WIFI UA25 代码分析</h3>
<pre><code>
/packages/apps/Settings/src/com/android/settings/wifi/WifiConfigController.java   // WifiConfigController 是对话框的控制对象  具体UA17中查看
private final WifiConfigUiBase mConfigUi;

          public WifiConfigController(WifiConfigUiBase parent, View view, AccessPoint accessPoint【null】,int mode 【WifiConfigUiBase.MODE_MODIFY】) {
        mConfigUi = parent;

        mView = view;
        mAccessPoint = accessPoint;
        mAccessPointSecurity = (accessPoint == null) ? AccessPoint.SECURITY_NONE : accessPoint.getSecurity();  // mAccessPointSecurity在此等于  AccessPoint.SECURITY_NONE
        mMode = mode;

        mTextViewChangedHandler = new Handler();

        .....

        if (mAccessPoint == null) { // new network  // 当前的 AccessPoint为空 说明是 需要 新增 网络
            mConfigUi.setTitle(R.string.wifi_add_network);  // &lt;string name=&quot;wifi_add_network&quot; msgid=&quot;6234851776910938957&quot;&gt;&quot;添加网络&quot;&lt;/string&gt;

            mSsidView = (TextView) mView.findViewById(R.id.ssid);
            mSsidView.addTextChangedListener(this);
            mSecuritySpinner = ((Spinner) mView.findViewById(R.id.security)); 【安全性】
            mSecuritySpinner.setOnItemSelectedListener(this);
            mView.findViewById(R.id.type).setVisibility(View.VISIBLE);

            showIpConfigFields();
            showProxyFields();
            mView.findViewById(R.id.wifi_advanced_toggle).setVisibility(View.VISIBLE);
            ((CheckBox) mView.findViewById(R.id.wifi_advanced_togglebox)).setOnCheckedChangeListener(this); 【高级选项】
            mConfigUi.setSubmitButton(res.getString(R.string.wifi_save));  // &lt;string name=&quot;wifi_save&quot; msgid=&quot;3331121567988522826&quot;&gt;&quot;保存&quot;&lt;/string&gt;
        }
        .....

        }




 /packages/apps/Settings/src/com/android/settings/wifi/WifiDialog.java
       @Override
    public void onClick(DialogInterface dialogInterface, int id) {
        if (mListener != null) {
            switch (id) {
                case BUTTON_SUBMIT:
                    mListener.onSubmit(this); //  提交后 UA25 执行到这里
                    break;
                case BUTTON_FORGET:
                    if (WifiSettings.isEditabilityLockedDown(
                            getContext(), mAccessPoint.getConfig())) {
                        RestrictedLockUtils.sendShowAdminSupportDetailsIntent(getContext(),
                                RestrictedLockUtils.getDeviceOwner(getContext()));
                        return;
                    }
                    mListener.onForget(this);
                    break;
            }
        }
    }

 /packages/apps/Settings/src/com/android/settings/wifi/WifiDialog.java 
 private WifiConfigController mController;
    @Override
    public WifiConfigController getController() {
        return mController;
    }



/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
     @Override
    public void onForget(WifiDialog dialog) {
        forget();
    }



/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
    @Override
    public void onSubmit(WifiDialog dialog) {
        if (mDialog != null) {
            submit(mDialog.getController());
        }
    }




/packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java
    /* package */ void submit(WifiConfigController configController) {

        final WifiConfiguration config = configController.getConfig();

        if (config == null) {  // 如果配置为空  那么尝试 连接它
            if (mSelectedAccessPoint != null &amp;&amp; mSelectedAccessPoint.isSaved()) { 
            connect(mSelectedAccessPoint.getConfig(), true /* isSavedNetwork */);
            }
        } else if (configController.getMode() == WifiConfigUiBase.MODE_MODIFY) {
            mWifiManager.save(config, mSaveListener);  // 如果 config 配置不为空  并且是保存模式  那么就 执行  mWifiManager.save  ▲6 分析UA后分析 WIFIManager
        } else {
            mWifiManager.save(config, mSaveListener);
            if (mSelectedAccessPoint != null) { // Not an &quot;Add network&quot;
                connect(config, false /* isSavedNetwork */);    //  尝试 连接
            }
        }

        mWifiTracker.resumeScanning();
    }
</code></pre><h2 id="wifi-ua26-ua19-">WIFI UA26分析 (同 UA19的代码分析)</h2>
<h3 id="wifi-ua26-">WIFI UA26 操作列</h3>
<p><img src="img/13.png" width = "25%" height="25%"/></p>
<ol>
<li><strong>UA编号</strong>   UA26   (同UA19)</li><li><strong>UA说明</strong>  <strong>已保存网络页面中的 Preference Item的点击事件  无 长按事件</strong></li><li><strong>UA触发函数</strong>  SavedAccessPointsWifiSettings 中的   onPreferenceTreeClick 函数</li><li><strong>UA字符可选值</strong>    </li><li><strong>UA布局及ID</strong>    </li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>  </li><li><strong>数据库可选值 </strong>   </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>   </li><li><strong>UA触发函数所在类</strong>    </li></ol>
<hr>
<h3 id="wifi-ua26-">WIFI UA26 代码分析</h3>
<pre><code>
 /packages/apps/Settings/src/com/android/settings/wifi/WifiSettings.java 
  @Override
    public boolean onPreferenceTreeClick(Preference preference) {
        // If the preference has a fragment set, open that
        if (preference.getFragment() != null) { 
//  如果当前 从 preference获取的 Fragment 不为 空  那么  调用   super.onPreferenceTreeClick(preference)  
// xml   文件 定义了 该 Fragment   SavedAccessPointsWifiSettings
            preference.setOnPreferenceClickListener(null);
            return super.onPreferenceTreeClick(preference);
        }



/packages/apps/Settings/src/com/android/settings/wifi/SavedAccessPointsWifiSettings.java


public class SavedAccessPointsWifiSettings extends SettingsPreferenceFragment implements Indexable, WifiDialog.WifiDialogListener {


    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        addPreferencesFromResource(R.xml.wifi_display_saved_access_points);  // 已保存热点的布局文件
        mUserBadgeCache = new AccessPointPreference.UserBadgeCache(getPackageManager());
         initPreferences();
    }



/packages/apps/Settings/src/com/android/settings/wifi/SavedAccessPointsWifiSettings.java
    private void initPreferences() {
        PreferenceScreen preferenceScreen = getPreferenceScreen();
        final Context context = getPrefContext();

        final List&lt;AccessPoint&gt; accessPoints = WifiSavedConfigUtils.getAllConfigs(context, mWifiManager); // 获得所有保存的热点的 AccessPoint
        Collections.sort(accessPoints, SAVED_NETWORK_COMPARATOR); // 热点集合进行排序
        preferenceScreen.removeAll();

        final int accessPointsSize = accessPoints.size();
        for (int i = 0; i &lt; accessPointsSize; ++i){
        // 新建LongPressAccessPointPreference  项Item  添加到  PreferenceScreen
            LongPressAccessPointPreference preference =new LongPressAccessPointPreference(accessPoints.get(i), context, mUserBadgeCache, true, this);
            preference.setIcon(null);  // 不设置图标
            preferenceScreen.addPreference(preference);  // 添加到  preferenceScreen
        }

        if(getPreferenceScreen().getPreferenceCount() &lt; 1) {
            Log.w(TAG, &quot;Saved networks activity loaded, but there are no saved networks!&quot;);
        }
    }
}


/packages/apps/Settings/src/com/android/settings/wifi/SavedAccessPointsWifiSettings.java
    @Override
    public boolean onPreferenceTreeClick(Preference preference) {  // 已保存网络里的Preference 的点击事件
        if (preference instanceof LongPressAccessPointPreference) {
            showDialog((LongPressAccessPointPreference) preference, false);
            return true;
        } else{
            return super.onPreferenceTreeClick(preference);
        }
    }



/packages/apps/Settings/src/com/android/settings/wifi/SavedAccessPointsWifiSettings.java
    private void showDialog(LongPressAccessPointPreference accessPoint, boolean edit) {
        if (mDialog != null) {
            removeDialog(WifiSettings.WIFI_DIALOG_ID);
            mDialog = null;
        }

        // Save the access point and edit mode
        mDlgAccessPoint = accessPoint.getAccessPoint();

        showDialog(WifiSettings.WIFI_DIALOG_ID);  // 显示提示框
    }


    @Override
    public Dialog onCreateDialog(int dialogId) {
        switch (dialogId) {
            case WifiSettings.WIFI_DIALOG_ID:
                if (mDlgAccessPoint == null) { // For re-launch from saved state
                    mDlgAccessPoint = new AccessPoint(getActivity(), mAccessPointSavedState);
                    // Reset the saved access point data
                    mAccessPointSavedState = null;
                }
                mSelectedAccessPoint = mDlgAccessPoint;

                mDialog = new WifiDialog(getActivity(), this, mDlgAccessPoint, WifiConfigUiBase.MODE_VIEW, true /* hide the submit button */); // 显示的模式是 WifiConfigUiBase.MODE_VIEW
                return mDialog;

        }
        return super.onCreateDialog(dialogId);
    }




/packages/apps/Settings/src/com/android/settings/wifi/WifiDialog.java   
private WifiConfigController mController;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        mView = getLayoutInflater().inflate(R.layout.wifi_dialog, null);  //  对话框的布局文件
        setView(mView);
        setInverseBackgroundForced(true);
        mController = new WifiConfigController(this, mView, mAccessPoint 【NULL】, mMode 【WifiConfigUiBase.MODE_VIEW 】); // 依据 新建了 WifiConfigController  业务交由WifiConfigController实现
        super.onCreate(savedInstanceState);

        if (mHideSubmitButton) {
            mController.hideSubmitButton();
        } else {
            /* During creation, the submit button can be unavailable to determine
             * visibility. Right after creation, update button visibility */
            mController.enableSubmitIfAppropriate();
        }

        if (mAccessPoint == null) {
            mController.hideForgetButton();
        }
    }



/packages/apps/Settings/src/com/android/settings/wifi/WifiConfigController.java
    public WifiConfigController(WifiConfigUiBase parent, View view, AccessPoint accessPoint,int mode) {




         mConfigUi.setForgetButton(res.getString(R.string.wifi_forget)); 【取消保存】
        mConfigUi.setCancelButton(res.getString(R.string.wifi_cancel));


WifiConfiguration getConfig() {  // 模式MODE_VIEW 下 返回的WifiConfiguration 设置为空
        if (mMode == WifiConfigUiBase.MODE_VIEW) {
            return null;
        }
}

&lt;string name=&quot;wifi_cancel&quot; msgid=&quot;6763568902542968964&quot;&gt;&quot;取消&quot;&lt;/string&gt;
&lt;string name=&quot;wifi_forget&quot; msgid=&quot;8168174695608386644&quot;&gt;&quot;取消保存&quot;&lt;/string&gt;
</code></pre><h2 id="wifi-ua34-">WIFI UA34分析</h2>
<h3 id="wifi-ua34-">WIFI UA34 操作列   《系统》&gt;《开发者选项》&gt;《无线显示认证》</h3>
<p><img src="img/18.png" width = "25%" height="25%"/></p>
<ol>
<li><strong>UA编号</strong>   UA34  </li><li><strong>UA说明</strong>  <strong>《系统》&gt;《开发者选项》&gt;《无线显示认证》的switch开关</strong></li><li><strong>UA触发函数</strong>  </li><li><strong>UA字符可选值</strong>    </li><li><strong>UA布局及ID</strong>    </li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>   wifi_display_certification_on</li><li><strong>数据库可选值 </strong>     0   1</li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>   </li><li><strong>UA触发函数所在类</strong>    </li></ol>
<hr>
<pre><code>
D:\gitrank\articles-master&gt;adb shell dumpsys window | findstr mCurrentFocus
  mCurrentFocus=Window{e2b2e4a u0 com.android.settings/com.android.settings.SubSettings}



    &lt;plurals name=&quot;show_dev_countdown&quot; formatted=&quot;false&quot; msgid=&quot;7201398282729229649&quot;&gt;
      &lt;item quantity=&quot;other&quot;&gt;现在只需再执行 &lt;xliff:g id=&quot;STEP_COUNT_1&quot;&gt;%1$d&lt;/xliff:g&gt; 步操作即可进入开发者模式。&lt;/item&gt;
      &lt;item quantity=&quot;one&quot;&gt;现在只需再执行 &lt;xliff:g id=&quot;STEP_COUNT_0&quot;&gt;%1$d&lt;/xliff:g&gt; 步操作即可进入开发者模式。&lt;/item&gt;
    &lt;/plurals&gt;

&lt;string name=&quot;show_dev_already&quot; msgid=&quot;2151632240145446227&quot;&gt;&quot;您已处于开发者模式，无需进行此操作。&quot;&lt;/string&gt;
 &lt;string name=&quot;status_operator&quot; msgid=&quot;2274875196954742087&quot;&gt;&quot;网络&quot;&lt;/string&gt;


/packages/apps/Settings/src/com/android/settings/deviceinfo/BuildNumberPreferenceController.java


    @Override
    public boolean handlePreferenceTreeClick(Preference preference) {
mDevHitToast = Toast.makeText(mContext,mContext.getResources().getQuantityString(R.plurals.show_dev_countdown, mDevHitCountdown,mDevHitCountdown),Toast.LENGTH_SHORT);
mDevHitToast.show();  // 显示Toast   还差多少步进入开发者模式


mDevHitToast = Toast.makeText(mContext, R.string.show_dev_already,Toast.LENGTH_LONG);
mDevHitToast.show();
mMetricsFeatureProvider.action( mContext, MetricsEvent.ACTION_SETTINGS_BUILD_NUMBER_PREF, Pair.create(MetricsEvent.FIELD_SETTINGS_BUILD_NUMBER_DEVELOPER_MODE_ENABLED, 1));
 }

....

}



/packages/apps/Settings/src/com/android/settings/development/DevelopmentSettings.java


    private VerifyAppsOverUsbPreferenceController mVerifyAppsOverUsbController;
    private SwitchPreference mWifiDisplayCertification; // 无线显示认证
    private SwitchPreference mWifiVerboseLogging;
    private SwitchPreference mWifiAggressiveHandover;


    private static final String WIFI_DISPLAY_CERTIFICATION_KEY = &quot;wifi_display_certification&quot;;   // 无线显示认证
    private static final String WIFI_VERBOSE_LOGGING_KEY = &quot;wifi_verbose_logging&quot;;   // 启用 wiif详细日志记录功能
    private static final String WIFI_AGGRESSIVE_HANDOVER_KEY = &quot;wifi_aggressive_handover&quot;;  // 主动从WLAN网络切换到移动数据网络
    private static final String WIFI_ALLOW_SCAN_WITH_TRAFFIC_KEY = &quot;wifi_allow_scan_with_traffic&quot;;  //  始终允许WLAN漫游扫描




    mWifiDisplayCertification = findAndInitSwitchPref(WIFI_DISPLAY_CERTIFICATION_KEY);





    private void updateWifiDisplayCertificationOptions() {
        updateSwitchPreference(mWifiDisplayCertification, Settings.Global.getInt( getActivity().getContentResolver(),Settings.Global.WIFI_DISPLAY_CERTIFICATION_ON, 0) != 0);
    }

    private void writeWifiDisplayCertificationOptions() {
    // 设置数据库中 wifi_display_certification_on 这个Item的值    默认值为0
        Settings.Global.putInt(getActivity().getContentResolver(),Settings.Global.WIFI_DISPLAY_CERTIFICATION_ON【&quot;wifi_display_certification_on&quot;】,mWifiDisplayCertification.isChecked() ? 1 : 0);
    }



    @Override
    public boolean onPreferenceTreeClick(Preference preference) {

    else if (preference == mWifiDisplayCertification) {
            writeWifiDisplayCertificationOptions();
        }


    /frameworks/base/core/java/android/provider/Settings.java
       public static final String WIFI_DISPLAY_CERTIFICATION_ON =&quot;wifi_display_certification_on&quot;;
</code></pre><h3 id="wifi-ua34-">WIFI UA34 代码分析</h3>
<h2 id="wifi-ua35-">WIFI UA35分析</h2>
<h3 id="wifi-ua35-wiif-">WIFI UA35 操作列   《系统》&gt;《开发者选项》&gt;《启用 wiif详细日志记录功能》</h3>
<p><img src="img/18.png" width = "25%" height="25%"/></p>
<ol>
<li><strong>UA编号</strong>   UA35  </li><li><strong>UA说明</strong>  <strong>《系统》&gt;《开发者选项》&gt;《启用 wiif详细日志记录功能》的switch开关</strong></li><li><strong>UA触发函数</strong>   WifiManager.enableVerboseLogging 函数</li><li><strong>UA字符可选值</strong>    </li><li><strong>UA布局及ID</strong>    </li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>  </li><li><strong>数据库可选值 </strong>   </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>   </li><li><strong>UA触发函数所在类</strong>    </li></ol>
<hr>
<h3 id="wifi-ua35-">WIFI UA35 代码分析</h3>
<pre><code>
/packages/apps/Settings/src/com/android/settings/development/DevelopmentSettings.java


    private VerifyAppsOverUsbPreferenceController mVerifyAppsOverUsbController;
    private SwitchPreference mWifiDisplayCertification; // 无线显示认证
    private SwitchPreference mWifiVerboseLogging; // 启用 wiif详细日志记录功能
    private SwitchPreference mWifiAggressiveHandover;


    private static final String WIFI_DISPLAY_CERTIFICATION_KEY = &quot;wifi_display_certification&quot;;   // 无线显示认证
    private static final String WIFI_VERBOSE_LOGGING_KEY = &quot;wifi_verbose_logging&quot;;   // 启用 wiif详细日志记录功能
    private static final String WIFI_AGGRESSIVE_HANDOVER_KEY = &quot;wifi_aggressive_handover&quot;;  // 主动从WLAN网络切换到移动数据网络
    private static final String WIFI_ALLOW_SCAN_WITH_TRAFFIC_KEY = &quot;wifi_allow_scan_with_traffic&quot;;  //  始终允许WLAN漫游扫描




      mWifiVerboseLogging  = findAndInitSwitchPref(WIFI_VERBOSE_LOGGING_KEY);




    private void updateWifiVerboseLoggingOptions() {
        boolean enabled = mWifiManager.getVerboseLoggingLevel() &gt; 0;
        updateSwitchPreference(mWifiVerboseLogging, enabled);
    }

    private void writeWifiVerboseLoggingOptions() {
        mWifiManager.enableVerboseLogging(mWifiVerboseLogging.isChecked() ? 1 : 0);  // 设置 Wifimanager 中的值
    }


/frameworks/base/wifi/java/android/net/wifi/WifiManager.java    // ▲8  UA分析完后 在 Framework分析
    public void enableVerboseLogging (int verbose) {
        try {
            mService.enableVerboseLogging(verbose);
        } catch (Exception e) {
            //ignore any failure here
            Log.e(TAG, &quot;enableVerboseLogging &quot; + e.toString());
        }
    }


    @Override
    public boolean onPreferenceTreeClick(Preference preference) {

else if (preference == mWifiVerboseLogging) {
            writeWifiVerboseLoggingOptions();
        }
</code></pre><h2 id="wifi-ua36-">WIFI UA36分析</h2>
<h3 id="wifi-ua36-wlan-">WIFI UA36 操作列   《系统》&gt;《开发者选项》&gt;《主动从WLAN网络切换到移动数据网络》</h3>
<p><img src="img/18.png" width = "25%" height="25%"/></p>
<ol>
<li><strong>UA编号</strong>   UA35  </li><li><strong>UA说明</strong>  <strong>《系统》&gt;《开发者选项》&gt;《主动从WLAN网络切换到移动数据网络》的switch开关</strong></li><li><strong>UA触发函数</strong>   WifiManager.enableAggressiveHandover</li><li><strong>UA字符可选值</strong>    </li><li><strong>UA布局及ID</strong>    </li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>  </li><li><strong>数据库可选值 </strong>   </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>   </li><li><strong>UA触发函数所在类</strong>    </li></ol>
<hr>
<h3 id="wifi-ua36-">WIFI UA36 代码分析</h3>
<pre><code>
/packages/apps/Settings/src/com/android/settings/development/DevelopmentSettings.java


    private VerifyAppsOverUsbPreferenceController mVerifyAppsOverUsbController;
    private SwitchPreference mWifiDisplayCertification; // 无线显示认证
    private SwitchPreference mWifiVerboseLogging; // 启用 wiif详细日志记录功能
    private SwitchPreference mWifiAggressiveHandover; // 主动从WLAN网络切换到移动数据网络


    private static final String WIFI_DISPLAY_CERTIFICATION_KEY = &quot;wifi_display_certification&quot;;   // 无线显示认证
    private static final String WIFI_VERBOSE_LOGGING_KEY = &quot;wifi_verbose_logging&quot;;   // 启用 wiif详细日志记录功能
    private static final String WIFI_AGGRESSIVE_HANDOVER_KEY = &quot;wifi_aggressive_handover&quot;;  // 主动从WLAN网络切换到移动数据网络
    private static final String WIFI_ALLOW_SCAN_WITH_TRAFFIC_KEY = &quot;wifi_allow_scan_with_traffic&quot;;  //  始终允许WLAN漫游扫描




      mWifiAggressiveHandover  = findAndInitSwitchPref(WIFI_AGGRESSIVE_HANDOVER_KEY);



    private void updateWifiAggressiveHandoverOptions() {
        boolean enabled = mWifiManager.getAggressiveHandover() &gt; 0;
        updateSwitchPreference(mWifiAggressiveHandover, enabled);
    }

    private void writeWifiAggressiveHandoverOptions() {
        mWifiManager.enableAggressiveHandover(mWifiAggressiveHandover.isChecked() ? 1 : 0);  //  调用 WIFIManager的enableAggressiveHandover 方法 ▲9  UA分析完后 在 Framework分析
    }


/frameworks/base/wifi/java/android/net/wifi/WifiManager.java    // ▲8  UA分析完后 在 Framework分析
    public void enableVerboseLogging (int verbose) {
        try {
            mService.enableVerboseLogging(verbose);
        } catch (Exception e) {
            //ignore any failure here
            Log.e(TAG, &quot;enableVerboseLogging &quot; + e.toString());
        }
    }


    @Override
    public boolean onPreferenceTreeClick(Preference preference) {

else if (preference == mWifiVerboseLogging) {
            writeWifiVerboseLoggingOptions();
        }
</code></pre><h2 id="wifi-ua37-">WIFI UA37分析</h2>
<h3 id="wifi-ua37-wlan-">WIFI UA37 操作列   《系统》&gt;《开发者选项》&gt;《始终允许WLAN漫游扫描》</h3>
<p><img src="img/18.png" width = "25%" height="25%"/></p>
<ol>
<li><strong>UA编号</strong>   UA35  </li><li><strong>UA说明</strong>  <strong>《系统》&gt;《开发者选项》&gt;《始终允许WLAN漫游扫描》的switch开关</strong></li><li><strong>UA触发函数</strong>  </li><li><strong>UA字符可选值</strong>    </li><li><strong>UA布局及ID</strong>    </li><li><strong>代码Key</strong>     </li><li><strong>代码可选值  </strong></li><li><strong>数据库Key </strong>  </li><li><strong>数据库可选值 </strong>   </li><li><strong>SP的Key</strong>  </li><li><strong>SP可选值</strong>  </li><li><strong>UA操作后UI显示类</strong>   </li><li><strong>UA触发函数所在类</strong>    </li></ol>
<hr>
<h3 id="wifi-ua37-">WIFI UA37 代码分析</h3>
<pre><code>
/packages/apps/Settings/src/com/android/settings/development/DevelopmentSettings.java


    private SwitchPreference mWifiDisplayCertification; // 无线显示认证
    private SwitchPreference mWifiVerboseLogging; // 启用 wiif详细日志记录功能
    private SwitchPreference mWifiAggressiveHandover; // 主动从WLAN网络切换到移动数据网络
    private SwitchPreference mWifiAllowScansWithTraffic;    //  始终允许WLAN漫游扫描

    private static final String WIFI_DISPLAY_CERTIFICATION_KEY = &quot;wifi_display_certification&quot;;   // 无线显示认证
    private static final String WIFI_VERBOSE_LOGGING_KEY = &quot;wifi_verbose_logging&quot;;   // 启用 wiif详细日志记录功能
    private static final String WIFI_AGGRESSIVE_HANDOVER_KEY = &quot;wifi_aggressive_handover&quot;;  // 主动从WLAN网络切换到移动数据网络
    private static final String WIFI_ALLOW_SCAN_WITH_TRAFFIC_KEY = &quot;wifi_allow_scan_with_traffic&quot;;  //  始终允许WLAN漫游扫描




mWifiAllowScansWithTraffic = findAndInitSwitchPref(WIFI_ALLOW_SCAN_WITH_TRAFFIC_KEY);


    private void updateWifiAllowScansWithTrafficOptions() {
        boolean enabled = mWifiManager.getAllowScansWithTraffic() &gt; 0;
        updateSwitchPreference(mWifiAllowScansWithTraffic, enabled);
    }

    private void writeWifiAllowScansWithTrafficOptions() {
        mWifiManager.setAllowScansWithTraffic(mWifiAllowScansWithTraffic.isChecked() ? 1 : 0);  //  调用 WIFIManager的 setAllowScansWithTraffic 方法 ▲10  UA分析完后 在 Framework分析
    }



    @Override
    public boolean onPreferenceTreeClick(Preference preference) {

else if (preference == mWifiAllowScansWithTraffic) {
            writeWifiAllowScansWithTrafficOptions();
        }
</code></pre>
</body>
</html>
<!-- This document was created with MarkdownPad, the Markdown editor for Windows (http://markdownpad.com) -->
